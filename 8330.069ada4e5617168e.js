"use strict";var Xe=Object.defineProperty,Ke=Object.defineProperties,$e=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,qe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,We=(de,ie,p)=>ie in de?Xe(de,ie,{enumerable:!0,configurable:!0,writable:!0,value:p}):de[ie]=p,Ve=(de,ie)=>{for(var p in ie||(ie={}))qe.call(ie,p)&&We(de,p,ie[p]);if(Be)for(var p of Be(ie))ke.call(ie,p)&&We(de,p,ie[p]);return de},De=(de,ie)=>Ke(de,$e(ie));(self.webpackChunkesri4_pwa=self.webpackChunkesri4_pwa||[]).push([[8330],{7848:(de,ie,p)=>{p.d(ie,{ym:()=>y,RF:()=>X,vY:()=>J,J9:()=>S,U1:()=>z,Ie:()=>V,G6:()=>Q});var F=p(62208),L=p(91179);const Y=(o,a,u)=>[a,u],se=(o,a,u)=>[a,u,o[2]],Z=(o,a,u)=>[a,u,o[2],o[3]];function J(o){return o?{originPosition:"upper-left"===o.originPosition?"upperLeft":"lower-left"===o.originPosition?"lowerLeft":o.originPosition,scale:o.tolerance?[o.tolerance,o.tolerance]:[1,1],translate:(0,F.pC)(o.extent)?[o.extent.xmin,o.extent.ymax]:[0,0]}:null}function T({scale:o,translate:a},u){return Math.round((u-a[0])/o[0])}function M({scale:o,translate:a},u){return Math.round((a[1]-u)/o[1])}function D(o,a,u){const g=[];let v,U,$,j;for(let ye=0;ye<u.length;ye++){const le=u[ye];ye>0?($=T(o,le[0]),j=M(o,le[1]),$===v&&j===U||(g.push(a(le,$-v,j-U)),v=$,U=j)):(v=T(o,le[0]),U=M(o,le[1]),g.push(a(le,v,U)))}return g.length>0?g:null}function ne({scale:o,translate:a},u){return u*o[0]+a[0]}function ee({scale:o,translate:a},u){return a[1]-u*o[1]}function Se(o,a,u){const g=new Array(u.length);if(!u.length)return g;const[v,U]=o.scale;let $=ne(o,u[0][0]),j=ee(o,u[0][1]);g[0]=a(u[0],$,j);for(let ye=1;ye<u.length;ye++){const le=u[ye];$+=le[0]*v,j-=le[1]*U,g[ye]=a(le,$,j)}return g}function _e(o,a,u){const g=new Array(u.length);for(let v=0;v<u.length;v++)g[v]=Se(o,a,u[v]);return g}function X(o,a,u,g,v){return a.x=T(o,u.x),a.y=M(o,u.y),a!==u&&(g&&(a.z=u.z),v&&(a.m=u.m)),a}function y(o,a){return o&&a?(0,L.wp)(a)?X(o,{},a,!1,!1):(0,L.l9)(a)?function b(o,a,u,g,v){const U=function ce(o,a,u,g){const v=[],U=u?g?Z:se:g?se:Y;for(let $=0;$<a.length;$++){const j=D(o,U,a[$]);j&&j.length>=2&&v.push(j)}return v.length?v:null}(o,u.paths,g,v);return U?(a.paths=U,a):null}(o,{},a,!1,!1):(0,L.oU)(a)?function re(o,a,u,g,v){const U=function fe(o,a,u,g){const v=[],U=u?g?Z:se:g?se:Y;for(let $=0;$<a.length;$++){const j=D(o,U,a[$]);j&&j.length>=3&&v.push(j)}return v.length?v:null}(o,u.rings,g,v);return U?(a.rings=U,a):null}(o,{},a,!1,!1):(0,L.aW)(a)?function W(o,a,u,g,v){return a.points=function oe(o,a,u,g){return D(o,u?g?Z:se:g?se:Y,a)}(o,u.points,g,v),a}(o,{},a,!1,!1):(0,L.YX)(a)?function R(o,a,u,g,v){return a.xmin=T(o,u.xmin),a.ymin=M(o,u.ymin),a.xmax=T(o,u.xmax),a.ymax=M(o,u.ymax),a!==u&&(g&&(a.zmin=u.zmin,a.zmax=u.zmax),v&&(a.mmin=u.mmin,a.mmax=u.mmax)),a}(o,{},a,!1,!1):null:null}function S(o,a,u,g,v){return(0,F.pC)(u)&&(a.points=function Ce(o,a,u,g){return Se(o,u?g?Z:se:g?se:Y,a)}(o,u.points,g,v)),a}function z(o,a,u,g,v){return(0,F.Wi)(u)||(a.x=ne(o,u.x),a.y=ee(o,u.y),a!==u&&(g&&(a.z=u.z),v&&(a.m=u.m))),a}function V(o,a,u,g,v){return(0,F.pC)(u)&&(a.rings=function ge(o,a,u,g){return _e(o,u?g?Z:se:g?se:Y,a)}(o,u.rings,g,v)),a}function Q(o,a,u,g,v){return(0,F.pC)(u)&&(a.paths=function me(o,a,u,g){return _e(o,u?g?Z:se:g?se:Y,a)}(o,u.paths,g,v)),a}},38330:(de,ie,p)=>{p.d(ie,{Z:()=>Le});var F=p(15861),L=p(26584),ae=p(58817),Y=p(62208),se=p(1036),Z=p(16730),J=p(5548),H=p(65401),T=p(32442),M=p(91179),D=p(13924),B=p(37053),oe=p(78498),fe=p(10410);const ne=new class ce{constructor(t,i){this._cache=new oe.Z(t),this._invalidCache=new oe.Z(i)}get(t,i){const e=`${i.uid}:${t}`,r=this._cache.get(e);if(r)return r;if(void 0!==this._invalidCache.get(e))return null;try{const s=fe.WhereClause.create(t,i);return this._cache.put(e,s),s}catch(s){return this._invalidCache.put(e,null),null}}}(50,500),ee="feature-store:unsupported-query",_e=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function me(N,t){return N?ne.get(N,t):null}function ge(N,t,i,e=!0){const r=[];for(const s of t)if("*"!==s&&!N.has(s))if(e){const l=xe(s);try{const f=me(l,N);if(!f)throw new L.Z(ee,"invalid SQL expression",{where:l});if(!f.isStandardized)throw new L.Z(ee,"expression is not standard",{clause:f});ge(N,f.fieldNames,"expression contains missing fields")}catch(f){const m=f&&f.details;if(m&&(m.clause||m.where))throw f;m&&m.missingFields?r.push(...m.missingFields):r.push(s)}}else r.push(s);if(r.length)throw new L.Z(ee,i,{missingFields:r})}function xe(N){return N.split(" as ")[0]}function ve(N,t){const i=t.get(N);return!!i&&!_e.has(i.type)}var pe=p(82959),E=p(87757),R=p(27105),W=p(15176),X=p(7848),re=p(82054),b=p(63930);class y{constructor(t,i,e){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues,this.fieldsIndex=e,this.featureAdapter=i;const r=t.outFields;if(r&&-1===r.indexOf("*")){this.outFields=r;let s=0;for(const l of r){const f=xe(l),m=this.fieldsIndex.get(f),h=m?null:me(f,e),x=m?m.name:l.split(" as ")[1]||"FIELD_EXP_"+s++;this._fieldDataCache.set(l,{alias:x,clause:h})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach(i=>this.getAttributes(i)),this._returnDistinctMap.size):t.length}getAttributes(t){const i=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(i)}getFieldValue(t,i,e){const r=e?e.name:i;let s=null;return this._fieldDataCache.has(r)?s=this._fieldDataCache.get(r).clause:e||(s=me(i,this.fieldsIndex),this._fieldDataCache.set(r,{alias:r,clause:s})),e?this.featureAdapter.getAttribute(t,r):s.calculateValue(t,this.featureAdapter)}getNormalizedValue(t,i){const e=i.normalizationType,r=i.normalizationTotal;let s=this.getFieldValue(t,i.field,i.fieldInfo);if(e&&Number.isFinite(s)){const l=this.getFieldValue(t,i.normalizationField,i.normalizationFieldInfo);s=(0,b.fk)(s,e,l,r)}return s}getExpressionValue(t,i,e){const r={attributes:this.featureAdapter.getAttributes(t)},s=e.createExecContext(r,i.viewInfo);return e.executeFunction(i.compiledFunc,s)}validateItem(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:me(i,this.fieldsIndex)}),this._fieldDataCache.get(i).clause.testFeature(t,this.featureAdapter)}validateItems(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:me(i,this.fieldsIndex)}),this._fieldDataCache.get(i).clause.testSet(t,this.featureAdapter)}_processAttributesForOutFields(t){const i=this.outFields;if(!i||!i.length)return this.featureAdapter.getAttributes(t);const e={};for(const r of i){const{alias:s,clause:l}=this._fieldDataCache.get(r);e[s]=l?l.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,s)}return e}_processAttributesForDistinctValues(t){if((0,Y.Wi)(t)||!this.returnDistinctValues)return t;const i=this.outFields,e=[];if(i)for(const l of i){const{alias:f}=this._fieldDataCache.get(l);e.push(t[f])}else for(const l in t)e.push(t[l]);const r=`${(i||["*"]).join(",")}=${e.join(",")}`;let s=this._returnDistinctMap.get(r)||0;return this._returnDistinctMap.set(r,++s),s>1?null:t}}var u,N,_=p(76530),S=p(6185),z=p(36630),V=p(46679);class Q{constructor(t,i,e){this.items=t,this.queryGeometry=i,this.definitionExpression=e.definitionExpression,this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.fieldsIndex=e.fieldsIndex,this.timeInfo=e.timeInfo,this.featureAdapter=e.featureAdapter,this.aggregateAdapter=e.aggregateAdapter}get size(){return this.items.length}createQueryResponseForCount(t){const i=new y(t,this.featureAdapter,this.fieldsIndex);if(!t.outStatistics)return i.countDistinctValues(this.items);const{groupByFieldsForStatistics:e,having:r}=t;if(!(null==e?void 0:e.length))return 1;const s=new Map,l=new Map,f=new Set,m=t.outStatistics;for(const h of m){const{statisticType:x}=h,I="exceedslimit"!==x?h.onStatisticField:void 0;if(!l.has(I)){const O=[];for(const P of e){const C=this._getAttributeValues(i,P,s);O.push(C)}l.set(I,this._calculateUniqueValues(O,i.returnDistinctValues))}const A=l.get(I);for(const O in A){const{data:P,items:C}=A[O],K=P.join(",");r&&!i.validateItems(C,r)||f.add(K)}}return f.size}createQueryResponse(t){var i=this;return(0,F.Z)(function*(){let e;return e=t.outStatistics?t.outStatistics.some(r=>"exceedslimit"===r.statisticType)?i._createExceedsLimitQueryResponse(t):yield i._createStatisticsQueryResponse(t):i._createFeatureQueryResponse(t),t.returnQueryGeometry&&(e.queryGeometry=(0,B.JY)(t.outSR)&&!(0,B.fS)(i.queryGeometry.spatialReference,t.outSR)?(0,S.S2)(Ve({spatialReference:t.outSR},(0,pe.iV)(i.queryGeometry,i.queryGeometry.spatialReference,t.outSR))):(0,S.S2)(Ve({spatialReference:t.outSR},i.queryGeometry))),e})()}createSnappingResponse(t,i){const e=this.featureAdapter,r=function a(N,t){return N?t?4:3:t?3:2}(this.hasZ,this.hasM),{x:s,y:l}=t.point,f="number"==typeof t.distance?t.distance:t.distance.x,m="number"==typeof t.distance?t.distance:t.distance.y,h={candidates:[]},x="esriGeometryPolygon"===this.geometryType,I=this._getPointCreator(t.point,this.spatialReference,i);for(const A of this.items){const O=e.getGeometry(A);if((0,Y.Wi)(O))continue;const{coords:P,lengths:C}=O;if(t.types&u.EDGE){let K=0;for(let G=0;G<C.length;G++){const te=C[G];for(let q=0;q<te;q++,K+=r){const ue=P[K],k=P[K+1];if(q!==te-1){const w=P[K+r],he=P[K+r+1],{x:Te,y:Ge}=o(s,l,ue,k,w,he),Oe=(s-Te)/f,Re=(l-Ge)/m,Ee=Oe*Oe+Re*Re;Ee<=1&&h.candidates.push({type:"edge",objectId:e.getObjectId(A),distance:Math.sqrt(Ee),target:I(Te,Ge),start:I(ue,k),end:I(w,he)})}}}}if(t.types&u.VERTEX){const K=x?P.length-r:P.length;for(let G=0;G<K;G+=r){const te=P[G],q=P[G+1],ue=(s-te)/f,k=(l-q)/m,w=ue*ue+k*k;w<=1&&h.candidates.push({type:"vertex",objectId:e.getObjectId(A),distance:Math.sqrt(w),target:I(te,q)})}}}return h.candidates.sort((A,O)=>A.distance-O.distance),h}_getPointCreator(t,i,e){const r=(0,Y.pC)(e)&&!(0,B.fS)(i,e)?s=>(0,pe.iV)(s,i,e):s=>s;return null!=t.z&&null!=t.m?(s,l)=>r({x:s,y:l,z:t.z,m:t.m}):null!=t.z?(s,l)=>r({x:s,y:l,z:t.z}):null!=t.m?(s,l)=>r({x:s,y:l,m:t.m}):(s,l)=>r({x:s,y:l})}executeAttributesQuery(t){const i=me(t.where,this.fieldsIndex);if(!i)return Promise.resolve(this);if(i.isStandardized){let e=0;const r=[];for(const l of this.items)i.testFeature(l,this.featureAdapter)&&(r[e++]=l);const s=new Q(r,this.queryGeometry,this);return s.definitionExpression=t.where,Promise.resolve(s)}return Promise.reject(new TypeError("Where clause is not standardized"))}executeAggregateIdsQuery(t){if(!t.aggregateIds||!t.aggregateIds.length||(0,Y.Wi)(this.aggregateAdapter))return Promise.resolve(this);const i=new Set;for(const r of t.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach(s=>i.add(s));const e=this.featureAdapter.getObjectId;return Promise.resolve(new Q(this.items.filter(r=>i.has(e(r))),this.queryGeometry,this))}executeObjectIdsQuery(t){if(!t.objectIds||!t.objectIds.length)return Promise.resolve(this);const i=new Set(t.objectIds),e=this.featureAdapter.getObjectId;return Promise.resolve(new Q(this.items.filter(r=>i.has(e(r))),this.queryGeometry,this))}executeTimeQuery(t){const i=(0,_.y)(this.timeInfo,t.timeExtent,this.featureAdapter);if(!(0,Y.pC)(i))return Promise.resolve(this);const e=this.items.filter(i);return Promise.resolve(new Q(e,this.queryGeometry,this))}filterLatest(){const{trackIdField:t,startTimeField:i,endTimeField:e}=this.timeInfo,r=e||i,s=new Map,l=this.featureAdapter.getAttribute;for(const m of this.items){const h=l(m,t),x=l(m,r),I=s.get(h);(!I||x>l(I,r))&&s.set(h,m)}const f=Array.from(s.values());return Promise.resolve(new Q(f,this.queryGeometry,this))}project(t){var i=this;return(0,F.Z)(function*(){if(!t||(0,B.fS)(i.spatialReference,t))return i;const e=i.featureAdapter,r=(yield(0,pe.oj)(i.items.map(s=>(0,S.Op)(i.geometryType,i.hasZ,i.hasM,e.getGeometry(s))),i.spatialReference,t)).map((s,l)=>e.cloneWithGeometry(i.items[l],(0,re.GH)(s,i.hasZ,i.hasM)));return new Q(r,i.queryGeometry,{definitionExpression:i.definitionExpression,geometryType:i.geometryType,hasM:i.hasM,hasZ:i.hasZ,objectIdField:i.objectIdField,spatialReference:t,fieldsIndex:i.fieldsIndex,timeInfo:i.timeInfo,featureAdapter:i.featureAdapter})})()}createSummaryStatisticsResponse(t,i){var e=this;return(0,F.Z)(function*(){const{field:r,valueExpression:s,normalizationField:l,normalizationType:f,normalizationTotal:m,minValue:h,maxValue:x,scale:I}=i,A=e.fieldsIndex.isDateField(r),O=yield e._getDataValues(t,{field:r,valueExpression:s,normalizationField:l,normalizationType:f,normalizationTotal:m,scale:I}),P=(0,b.S5)({normalizationType:f,normalizationField:l,minValue:h,maxValue:x}),C=e.fieldsIndex.get(r),K={value:.5,fieldType:null==C?void 0:C.type},G=(0,z.qN)(C)?(0,b.H0)({values:O,supportsNullCount:P,percentileParams:K}):(0,b.i5)({values:O,minValue:h,maxValue:x,useSampleStdDev:!f,supportsNullCount:P,percentileParams:K});return(0,b.F_)(G,A)})()}createUniqueValuesResponse(t,i){var e=this;return(0,F.Z)(function*(){const{field:r,valueExpression:s,domain:l,returnAllCodedValues:f,scale:m}=i,h=yield e._getDataValues(t,{field:r,valueExpression:s,scale:m}),x=(0,b.eT)(h);return(0,b.Qm)(x,l,f)})()}createClassBreaksResponse(t,i){var e=this;return(0,F.Z)(function*(){const{field:r,valueExpression:s,normalizationField:l,normalizationType:f,normalizationTotal:m,classificationMethod:h,standardDeviationInterval:x,minValue:I,maxValue:A,numClasses:O,scale:P}=i,C=yield e._getDataValues(t,{field:r,valueExpression:s,normalizationField:l,normalizationType:f,normalizationTotal:m,scale:P}),K=(0,b.G2)(C,{field:r,normalizationField:l,normalizationType:f,normalizationTotal:m,classificationMethod:h,standardDeviationInterval:x,minValue:I,maxValue:A,numClasses:O});return(0,b.DL)(K,h)})()}createHistogramResponse(t,i){var e=this;return(0,F.Z)(function*(){const{field:r,valueExpression:s,normalizationField:l,normalizationType:f,normalizationTotal:m,classificationMethod:h,standardDeviationInterval:x,minValue:I,maxValue:A,numBins:O,scale:P}=i,C=yield e._getDataValues(t,{field:r,valueExpression:s,normalizationField:l,normalizationType:f,normalizationTotal:m,scale:P});return(0,b.oF)(C,{field:r,normalizationField:l,normalizationType:f,normalizationTotal:m,classificationMethod:h,standardDeviationInterval:x,minValue:I,maxValue:A,numBins:O})})()}_sortFeatures(t,i,e){if(t.length>1&&i&&i.length)for(const r of i.reverse()){const s=r.split(" "),l=s[0],f=this.fieldsIndex.get(l),m=s[1]&&"desc"===s[1].toLowerCase(),h=(0,b.Lq)(null==f?void 0:f.type,m);t.sort((x,I)=>{const A=e(x,l,f),O=e(I,l,f);return h(A,O)})}}_createFeatureQueryResponse(t){const i=this.items,{geometryType:e,hasM:r,hasZ:s,objectIdField:l,spatialReference:f}=this,{outFields:m,outSR:h,quantizationParameters:x,resultRecordCount:I,resultOffset:A,returnZ:O,returnM:P}=t,C=null!=I&&i.length>(A||0)+I,K=m&&(m.includes("*")?[...this.fieldsIndex.fields]:m.map(G=>this.fieldsIndex.get(G)));return{exceededTransferLimit:C,features:this._createFeatures(t,i),fields:K,geometryType:e,hasM:r&&P,hasZ:s&&O,objectIdFieldName:l,spatialReference:(0,S.S2)(h||f),transform:x&&(0,X.vY)(x)||null}}_createFeatures(t,i){const e=new y(t,this.featureAdapter,this.fieldsIndex),{hasM:r,hasZ:s}=this,{orderByFields:l,quantizationParameters:f,returnGeometry:m,returnCentroid:h,maxAllowableOffset:x,resultOffset:I,resultRecordCount:A,returnZ:O=!1,returnM:P=!1}=t,C=s&&O,K=r&&P;let G=[],te=0;const q=[...i];if(this._sortFeatures(q,l,(k,w,he)=>e.getFieldValue(k,w,he)),m||h){const k=(0,X.vY)(f);if(m&&!h)for(const w of q)G[te++]={attributes:e.getAttributes(w),geometry:(0,S.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(w),x,k,C,K)};else if(!m&&h)for(const w of q)G[te++]={attributes:e.getAttributes(w),centroid:(0,S.EG)(this,this.featureAdapter.getCentroid(w,this),k)};else for(const w of q)G[te++]={attributes:e.getAttributes(w),centroid:(0,S.EG)(this,this.featureAdapter.getCentroid(w,this),k),geometry:(0,S.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(w),x,k,C,K)}}else for(const k of q){const w=e.getAttributes(k);w&&(G[te++]={attributes:w})}const ue=I||0;return null!=A&&(G=G.slice(ue,Math.min(G.length,ue+A))),G}_createExceedsLimitQueryResponse(t){let i=!1,e=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(const l of t.outStatistics)if("exceedslimit"===l.statisticType){e=null!=l.maxPointCount?l.maxPointCount:Number.POSITIVE_INFINITY,r=null!=l.maxRecordCount?l.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=l.maxVertexCount?l.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)i=this.items.length>e;else if(this.items.length>r)i=!0;else{const l=this.hasZ?this.hasM?4:3:this.hasM?3:2,f=this.featureAdapter;i=this.items.reduce((m,h)=>{const x=f.getGeometry(h);return m+((0,Y.pC)(x)&&x.coords.length||0)},0)/l>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(i)}}]}}_createStatisticsQueryResponse(t){var i=this;return(0,F.Z)(function*(){const e={attributes:{}},r=[],s=new Map,l=new Map,f=new Map,m=new Map,h=new y(t,i.featureAdapter,i.fieldsIndex),x=t.outStatistics,{groupByFieldsForStatistics:I,having:A,orderByFields:O}=t,P=I&&I.length,C=!!P,K=C&&I[0],G=C&&!i.fieldsIndex.get(K);for(const q of x){const{outStatisticFieldName:ue,statisticType:k}=q,w=q,he="exceedslimit"!==k?q.onStatisticField:void 0,Te="percentile_disc"===k||"percentile_cont"===k,Ge="EnvelopeAggregate"===k||"CentroidAggregate"===k||"ConvexHullAggregate"===k,Oe=C&&1===P&&(he===K||G)&&"count"===k;if(C){if(!f.has(he)){const Ee=[];for(const be of I){const Ze=i._getAttributeValues(h,be,s);Ee.push(Ze)}f.set(he,i._calculateUniqueValues(Ee,h.returnDistinctValues))}const Re=f.get(he);for(const Ee in Re){const{count:be,data:Ze,items:we,itemPositions:He}=Re[Ee],Ue=Ze.join(",");if(!A||h.validateItems(we,A)){const Me=m.get(Ue)||{attributes:{}};if(Ge){Me.aggregateGeometries||(Me.aggregateGeometries={});const{aggregateGeometries:Ae,outStatisticFieldName:ze}=yield i._getAggregateGeometry(w,we);Me.aggregateGeometries[ze]=Ae}else{let Ae=null;if(Oe)Ae=be;else{const ze=i._getAttributeValues(h,he,s),je=He.map(Je=>ze[Je]);Ae=Te&&"statisticParameters"in w?i._getPercentileValue(w,je):i._getStatisticValue(w,je,null,h.returnDistinctValues)}Me.attributes[ue]=Ae}I.forEach((Ae,ze)=>Me.attributes[i.fieldsIndex.get(Ae)?Ae:`EXPR_${ze+1}`]=Ze[ze]),m.set(Ue,Me)}}}else if(Ge){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:Re,outStatisticFieldName:Ee}=yield i._getAggregateGeometry(w,i.items);e.aggregateGeometries[Ee]=Re}else{const Re=i._getAttributeValues(h,he,s);e.attributes[ue]=Te&&"statisticParameters"in w?i._getPercentileValue(w,Re):i._getStatisticValue(w,Re,l,h.returnDistinctValues)}r.push({name:ue,alias:ue,type:"esriFieldTypeDouble"})}const te=C?Array.from(m.values()):[e];return i._sortFeatures(te,O,(q,ue)=>q.attributes[ue]),{fields:r,features:te}})()}_getAggregateGeometry(t,i){var e=this;return(0,F.Z)(function*(){const r=yield Promise.all([p.e(4918),p.e(8592)]).then(p.bind(p,32825)),{statisticType:s,outStatisticFieldName:l}=t,{featureAdapter:f,spatialReference:m,geometryType:h,hasZ:x,hasM:I}=e,A=i.map(C=>(0,S.Op)(h,x,I,f.getGeometry(C))),O=r.convexHull(m,A,!0)[0],P={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===s){const C=O?(0,W._w)(O):(0,W.aO)(r.union(m,A));P.aggregateGeometries=De(Ve({},C),{spatialReference:m}),P.outStatisticFieldName=l||"extent"}else if("CentroidAggregate"===s){const C=O?(0,R.tO)(O):(0,R.$G)((0,W.aO)(r.union(m,A)));P.aggregateGeometries={x:C[0],y:C[1],spatialReference:m},P.outStatisticFieldName=l||"centroid"}else"ConvexHullAggregate"===s&&(P.aggregateGeometries=O,P.outStatisticFieldName=l||"convexHull");return P})()}_getStatisticValue(t,i,e,r){const{onStatisticField:s,statisticType:l}=t;let f=null;return f=null!=e&&e.has(s)?e.get(s):(0,z.qN)(this.fieldsIndex.get(s))?(0,b.H0)({values:i,returnDistinct:r}):(0,b.i5)({values:i,minValue:null,maxValue:null,useSampleStdDev:!0}),e&&e.set(s,f),f["var"===l?"variance":l]}_getPercentileValue(t,i){const{onStatisticField:e,statisticParameters:r,statisticType:s}=t,{value:l,orderBy:f}=r,m=this.fieldsIndex.get(e);return(0,b.XL)(i,{value:l,orderBy:f,fieldType:null==m?void 0:m.type,isDiscrete:"percentile_disc"===s})}_getAttributeValues(t,i,e){if(e.has(i))return e.get(i);const r=this.fieldsIndex.get(i),s=this.items.map(l=>t.getFieldValue(l,i,r));return e.set(i,s),s}_getAttributeNormalizedValues(t,i){return this.items.map(e=>t.getNormalizedValue(e,{field:i.field,fieldInfo:this.fieldsIndex.get(i.field),normalizationField:i.normalizationField,normalizationFieldInfo:this.fieldsIndex.get(i.normalizationField),normalizationType:i.normalizationType,normalizationTotal:i.normalizationTotal}))}_getAttributeExpressionValues(t,i,e){var r=this;return(0,F.Z)(function*(){const{arcadeUtils:s}=yield(0,V.LC)(),l=s.createFunction(i),f=e&&s.getViewInfo(e);return r.items.map(m=>t.getExpressionValue(m,{compiledFunc:l,viewInfo:f},s))})()}_calculateUniqueValues(t,i){const e={},r=this.items,s=r.length;for(let l=0;l<s;l++){const f=r[l],m=[];for(const x of t)m.push(x[l]);const h=m.join(",");i?null==e[h]&&(e[h]={count:1,data:m,items:[f],itemPositions:[l]}):null==e[h]?e[h]={count:1,data:m,items:[f],itemPositions:[l]}:(e[h].count++,e[h].items.push(f),e[h].itemPositions.push(l))}return e}_getDataValues(t,i){var e=this;return(0,F.Z)(function*(){const r=new y(t,e.featureAdapter,e.fieldsIndex),{valueExpression:s,field:l,normalizationField:f,normalizationType:m,normalizationTotal:h,scale:x}=i;return s?e._getAttributeExpressionValues(r,s,s?{viewingMode:"map",scale:x,spatialReference:t.outSR||e.spatialReference}:null):e._getAttributeNormalizedValues(r,{field:l,normalizationField:f,normalizationType:m,normalizationTotal:h})})()}}function o(N,t,i,e,r,s){const l=r-i,f=s-e,x=Math.min(1,Math.max(0,((N-i)*l+(t-e)*f)/(l*l+f*f)));return{x:i+l*x,y:e+f*x}}(N=u||(u={}))[N.NONE=0]="NONE",N[N.EDGE=1]="EDGE",N[N.VERTEX=2]="VERTEX";var g=p(53023),v=p(60466),U=p(74447);const j="feature-store:unsupported-query",le=new Set,Qe=new se.WJ(2e6);let Ne=0;class Le{constructor(t){this.capabilities={query:E.g},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new se.Xq(Ne+++"$$",Qe)),this.fieldsIndex=new v.Z(t.fields),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}destroy(){this._frameTask=(0,Y.hw)(this._frameTask),this.clearCache(),(0,Y.SC)(this._geometryQueryCache),this._changeHandle=(0,Y.hw)(this._changeHandle),(0,Y.SC)(this.fieldsIndex)}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){const t=this.featureStore.fullBounds;return t?{xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:(0,S.S2)(this.spatialReference)}:null}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=(0,_.R)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}executeQuery(t={},i){var e=this;return(0,F.Z)(function*(){let r,s=(0,ae.d9)(t);try{s=yield e._schedule(()=>(0,S.Up)(s,e.definitionExpression,e.spatialReference),i),s=yield e._reschedule(()=>e._checkQuerySupport(s),i),r=yield e._reschedule(()=>e._executeGeometryQuery(s,i),i),r=yield e._reschedule(()=>r.executeAggregateIdsQuery(s),i),r=yield e._reschedule(()=>r.executeObjectIdsQuery(s),i),r=yield e._reschedule(()=>r.executeTimeQuery(s),i),r=yield e._reschedule(()=>r.executeAttributesQuery(s),i)}catch(l){if(l!==S.vF)throw l;r=new Q([],null,e)}return r.createQueryResponse(s)})()}executeQueryForCount(t={},i){var e=this;return(0,F.Z)(function*(){let r=(0,ae.d9)(t);r.returnGeometry=!1,r.returnCentroid=!1,r.outSR=null;try{r=yield e._schedule(()=>(0,S.Up)(r,e.definitionExpression,e.spatialReference),i),r=yield e._reschedule(()=>e._checkQuerySupport(r),i);let s=yield e._reschedule(()=>e._executeGeometryQuery(r,i),i);return s=yield e._reschedule(()=>s.executeAggregateIdsQuery(r),i),s=yield e._reschedule(()=>s.executeObjectIdsQuery(r),i),s=yield e._reschedule(()=>s.executeTimeQuery(r),i),s=yield e._reschedule(()=>s.executeAttributesQuery(r),i),s.createQueryResponseForCount(r)}catch(s){if(s!==S.vF)throw s;return 0}})()}executeQueryForExtent(t={},i){var e=this;return(0,F.Z)(function*(){let r,s=(0,ae.d9)(t);const l=s.outSR;try{s=yield e._schedule(()=>(0,S.Up)(s,e.definitionExpression,e.spatialReference),i),s=yield e._reschedule(()=>e._checkQuerySupport(s),i),s.returnGeometry=!0,s.returnCentroid=!1,s.outSR=null,r=yield e._reschedule(()=>e._executeGeometryQuery(s,i),i),r=yield e._reschedule(()=>r.executeAggregateIdsQuery(s),i),r=yield e._reschedule(()=>r.executeObjectIdsQuery(s),i),r=yield e._reschedule(()=>r.executeTimeQuery(s),i),r=yield e._reschedule(()=>r.executeAttributesQuery(s),i);const f=r.size;if(!f)return{count:f,extent:null};(0,J.t8)(Fe,J.Gv),e.featureStore.forEachBounds(r.items,x=>(0,J.TC)(Fe,x),Ye);const m={xmin:Fe[0],ymin:Fe[1],xmax:Fe[3],ymax:Fe[4],spatialReference:(0,S.S2)(e.spatialReference)};e.hasZ&&isFinite(Fe[2])&&isFinite(Fe[5])&&(m.zmin=Fe[2],m.zmax=Fe[5]);const h=(0,pe.iV)(m,r.spatialReference,l);if(h.spatialReference=(0,S.S2)(l||e.spatialReference),h.xmax-h.xmin==0){const x=(0,Z.c9)(h.spatialReference);h.xmin-=x,h.xmax+=x}if(h.ymax-h.ymin==0){const x=(0,Z.c9)(h.spatialReference);h.ymin-=x,h.ymax+=x}if(e.hasZ&&null!=h.zmin&&null!=h.zmax&&h.zmax-h.zmin==0){const x=(0,Z.c9)(h.spatialReference);h.zmin-=x,h.zmax+=x}return{count:f,extent:h}}catch(f){if(f===S.vF)return{count:0,extent:null};throw f}})()}executeQueryForIds(t={},i){var e=this;return(0,F.Z)(function*(){return e.executeQueryForIdSet(t,i).then(r=>Array.from(r))})()}executeQueryForIdSet(t={},i){var e=this;return(0,F.Z)(function*(){let r,s=(0,ae.d9)(t);s.returnGeometry=!1,s.returnCentroid=!1,s.outSR=null;try{s=yield e._schedule(()=>(0,S.Up)(s,e.definitionExpression,e.spatialReference),i),s=yield e._reschedule(()=>e._checkQuerySupport(s),i),r=yield e._reschedule(()=>e._executeGeometryQuery(s,i),i),r=yield e._reschedule(()=>r.executeAggregateIdsQuery(s),i),r=yield e._reschedule(()=>r.executeObjectIdsQuery(s),i),r=yield e._reschedule(()=>r.executeTimeQuery(s),i),r=yield e._reschedule(()=>r.executeAttributesQuery(s),i);const l=r.items,f=new Set;return yield e._reschedule(()=>{for(const m of l)f.add(r.featureAdapter.getObjectId(m))},i),f}catch(l){if(l===S.vF)return new Set;throw l}})()}executeQueryForSnapping(t,i){var e=this;return(0,F.Z)(function*(){const{point:r,distance:s,types:l}=t;if(l===u.NONE)return{candidates:[]};const f=yield e._reschedule(()=>e._checkQuerySupport(t.query),i),m=!(0,B.fS)(r.spatialReference,e.spatialReference);m&&(yield(0,pe._W)(r.spatialReference,e.spatialReference));const h="number"==typeof s?s:s.x,x="number"==typeof s?s:s.y,I={xmin:r.x-h,xmax:r.x+h,ymin:r.y-x,ymax:r.y+x,spatialReference:r.spatialReference},A=m?(0,pe.iV)(I,e.spatialReference):I;if(!A)return{candidates:[]};const O=(yield(0,D.aX)((0,M.im)(r),null,{signal:i}))[0],P=(yield(0,D.aX)((0,M.im)(A),null,{signal:i}))[0];if((0,Y.Wi)(O)||(0,Y.Wi)(P))return{candidates:[]};let C=new Q(e._searchFeatures(e._getQueryBBoxes(P.toJSON())),null,e);C=yield e._reschedule(()=>C.executeObjectIdsQuery(f),i),C=yield e._reschedule(()=>C.executeTimeQuery(f),i),C=yield e._reschedule(()=>C.executeAttributesQuery(f),i);const K=O.toJSON(),G=m?(0,pe.iV)(K,e.spatialReference):K,te=m?Math.max(A.xmax-A.xmin,A.ymax-A.ymin)/2:s;return C.createSnappingResponse(De(Ve({},t),{point:G,distance:te}),r.spatialReference)})()}executeQueryForLatestObservations(t={},i){var e=this;return(0,F.Z)(function*(){if(!e.timeInfo||!e.timeInfo.trackIdField)throw new L.Z(j,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:e.timeInfo});let r,s=(0,ae.d9)(t);try{s=yield e._schedule(()=>(0,S.Up)(s,e.definitionExpression,e.spatialReference),i),s=yield e._reschedule(()=>e._checkQuerySupport(s),i),r=yield e._reschedule(()=>e._executeGeometryQuery(s,i),i),r=yield e._reschedule(()=>r.executeAggregateIdsQuery(s),i),r=yield e._reschedule(()=>r.executeObjectIdsQuery(s),i),r=yield e._reschedule(()=>r.executeTimeQuery(s),i),r=yield e._reschedule(()=>r.executeAttributesQuery(s),i),r=yield e._reschedule(()=>r.filterLatest(),i)}catch(l){if(l!==S.vF)throw l;r=new Q([],null,e)}return r.createQueryResponse(s)})()}executeQueryForSummaryStatistics(t={},i,e){var r=this;return(0,F.Z)(function*(){const{field:s,normalizationField:l,valueExpression:f}=i;return(yield r._getQueryEngineResultForStats(t,{field:s,normalizationField:l,valueExpression:f},e)).createSummaryStatisticsResponse(t,i)})()}executeQueryForUniqueValues(t={},i,e){var r=this;return(0,F.Z)(function*(){const{field:s,valueExpression:l}=i;return(yield r._getQueryEngineResultForStats(t,{field:s,valueExpression:l},e)).createUniqueValuesResponse(t,i)})()}executeQueryForClassBreaks(t={},i,e){var r=this;return(0,F.Z)(function*(){const{field:s,normalizationField:l,valueExpression:f}=i;return(yield r._getQueryEngineResultForStats(t,{field:s,normalizationField:l,valueExpression:f},e)).createClassBreaksResponse(t,i)})()}executeQueryForHistogram(t={},i,e){var r=this;return(0,F.Z)(function*(){const{field:s,normalizationField:l,valueExpression:f}=i;return(yield r._getQueryEngineResultForStats(t,{field:s,normalizationField:l,valueExpression:f},e)).createHistogramResponse(t,i)})()}_schedule(t,i){var e=this;return(0,F.Z)(function*(){return(0,Y.pC)(e._frameTask)?e._frameTask.schedule(t,i):t(U.G5)})()}_reschedule(t,i){var e=this;return(0,F.Z)(function*(){return(0,Y.pC)(e._frameTask)?e._frameTask.reschedule(t,i):t(U.G5)})()}_getAll(){if(!this._allItems){const t=[];this.featureStore.forEach(i=>t.push(i)),this._allItems=new Q(t,null,this)}return this._allItems}_executeGeometryQuery(t,i){var e=this;return(0,F.Z)(function*(){const{geometry:r,outSR:s,spatialRel:l,returnGeometry:f,returnCentroid:m}=t,h=f||m,x=(0,B.JY)(s)&&!(0,B.fS)(e.spatialReference,s),I=e._geometryQueryCache?x&&h?JSON.stringify({geometry:r,spatialRelationship:l,outSpatialReference:s}):JSON.stringify({geometry:r,spatialRelationship:l}):null;if(I){const G=e._geometryQueryCache.get(I);if(!(0,Y.o8)(G))return G}const A=function(){var G=(0,F.Z)(function*(te){if(x&&h){const q=yield te.project(s);return I&&e._geometryQueryCache.put(I,q,q.size||1),q}return I&&e._geometryQueryCache.put(I,te,te.size||1),te});return function(q){return G.apply(this,arguments)}}();if(!r)return A(e._getAll());const O=e.featureAdapter;if("esriSpatialRelDisjoint"===l){const G=e._searchFeatures(e._getQueryBBoxes(r));if(!G.length)return A(e._getAll());let te,q;const ue=new Set;for(const w of G)ue.add(O.getObjectId(w));return yield e._reschedule(()=>{let w=0;te=new Array(ue.size),e.featureStore.forEach(he=>te[w++]=he),q=ue},i),A(yield e._reschedule((0,F.Z)(function*(){const w=yield(0,g.cW)(l,r,e.geometryType,e.hasZ,e.hasM);return new Q(yield e._runSpatialFilter(te,Te=>!q.has(O.getObjectId(Te))||w(O.getGeometry(Te)),i),r,e)}),i))}const P=e._searchFeatures(e._getQueryBBoxes(r));if(!P.length){const G=new Q([],r,e);return I&&e._geometryQueryCache.put(I,G,G.size||1),G}if(e._canExecuteSoloPass(r,t))return A(new Q(P,r,e));const C=yield(0,g.cW)(l,r,e.geometryType,e.hasZ,e.hasM),K=yield e._runSpatialFilter(P,G=>C(O.getGeometry(G)),i);return A(new Q(K,r,e))})()}_runSpatialFilter(t,i,e){var r=this;return(0,F.Z)(function*(){if(!i)return t;if((0,Y.Wi)(r._frameTask))return t.filter(m=>i(m));let s=0;const l=new Array,f=function(){var m=(0,F.Z)(function*(h){for(;s<t.length;){const x=t[s++];i(x)&&(l.push(x),h.madeProgress()),h.done&&(yield r._reschedule(I=>f(I),e))}});return function(x){return m.apply(this,arguments)}}();return r._reschedule(m=>f(m),e).then(()=>l)})()}_canExecuteSoloPass(t,i){const{geometryType:e}=this,{spatialRel:r}=i;return(0,g.hN)(t)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===e&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r||"esriSpatialRelWithin"===r))}_getQueryBBoxes(t){if((0,g.hN)(t)){if((0,M.YX)(t))return[(0,H.al)(t.xmin,t.ymin,t.xmax,t.ymax)];if((0,M.oU)(t))return t.rings.map(i=>(0,H.al)(Math.min(i[0][0],i[2][0]),Math.min(i[0][1],i[2][1]),Math.max(i[0][0],i[2][0]),Math.max(i[0][1],i[2][1])))}return[(0,T.$P)((0,H.Ue)(),t)]}_searchFeatures(t){for(const r of t)this.featureStore.forEachInBounds(r,s=>{le.add(s)});const i=new Array(le.size);let e=0;return le.forEach(r=>i[e++]=r),le.clear(),i}_checkStatisticsSupport(t,i){var e=this;return(0,F.Z)(function*(){if(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)throw new L.Z(j,"Unsupported query options",{query:t});return Promise.all([e._checkAttributesQuerySupport(t),e._checkStatisticsParamsSupport(i),(0,g.P0)(t,e.geometryType,e.spatialReference),(0,pe._W)(e.spatialReference,t.outSR)]).then(()=>t)})()}_checkStatisticsParamsSupport(t){var i=this;return(0,F.Z)(function*(){let e=[];if(t.valueExpression){const{arcadeUtils:r}=yield(0,V.LC)();e=r.extractFieldNames(t.valueExpression)}if(t.field&&e.push(t.field),t.normalizationField&&e.push(t.normalizationField),!e.length)throw new L.Z(j,"params should have at least a field or valueExpression",{params:t});ge(i.fieldsIndex,e,"params contains missing fields")})()}_checkQuerySupport(t){var i=this;return(0,F.Z)(function*(){if(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)throw new L.Z(j,"Unsupported query options",{query:t});return Promise.all([i._checkAttributesQuerySupport(t),i._checkStatisticsQuerySupport(t),(0,g.P0)(t,i.geometryType,i.spatialReference),(0,pe._W)(i.spatialReference,t.outSR)]).then(()=>t)})()}_checkAttributesQuerySupport(t){const{outFields:i,orderByFields:e,returnDistinctValues:r,outStatistics:s}=t,l=s?s.map(f=>f.outStatisticFieldName&&f.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(e&&e.length>0){const f=" asc",m=" desc",h=e.map(x=>{const I=x.toLowerCase();return I.indexOf(f)>-1?I.split(f)[0]:I.indexOf(m)>-1?I.split(m)[0]:x}).filter(x=>-1===l.indexOf(x));ge(this.fieldsIndex,h,"orderByFields contains missing fields")}if(i&&i.length>0)ge(this.fieldsIndex,i,"outFields contains missing fields");else if(r)throw new L.Z(j,"outFields should be specified for returnDistinctValues",{query:t});!function Pe(N,t){if(!t)return!0;const i=ne.get(t,N);if(!i)throw new L.Z(ee,"invalid SQL expression",{where:t});if(!i.isStandardized)throw new L.Z(ee,"where clause is not standard",{where:t});ge(N,i.fieldNames,"where clause contains missing fields")}(this.fieldsIndex,t.where)}_checkStatisticsQuerySupport(t){var i=this;return(0,F.Z)(function*(){const{outStatistics:e,groupByFieldsForStatistics:r,having:s}=t,l=r&&r.length,f=e&&e.length;if(s){if(!l||!f)throw new L.Z(j,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});!function Ce(N,t,i){if(!t)return!0;const e=ne.get(t,N);if(!e)throw new L.Z(ee,"invalid SQL expression",{having:t});if(!e.isAggregate)throw new L.Z(ee,"having does not contain a valid aggregate function",{having:t});if(ge(N,e.fieldNames,"having contains missing fields"),!e.getExpressions().every(s=>{const{aggregateType:l,field:f}=s,m=N.has(f)&&N.get(f).name;return i.some(h=>{const{onStatisticField:x,statisticType:I}=h;return(N.has(x)&&N.get(x).name)===m&&I.toLowerCase().trim()===l})}))throw new L.Z(ee,"expressions in having should also exist in outStatistics",{having:t})}(i.fieldsIndex,s,e)}if(f){if(!function $(N){return N.every(t=>"exceedslimit"!==t.statisticType)}(e))return;const m=e.map(h=>h.onStatisticField).filter(Boolean);ge(i.fieldsIndex,m,"onStatisticFields contains missing fields"),l&&ge(i.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields");for(const h of e){const{onStatisticField:x,statisticType:I}=h;if("percentile_disc"!==I&&"percentile_cont"!==I||!("statisticParameters"in h)){if("count"!==I&&x&&ve(x,i.fieldsIndex))throw new L.Z(j,"outStatistics contains non-numeric fields",{definition:h,query:t})}else{const{statisticParameters:A}=h;if(!A)throw new L.Z(j,"statisticParamters should be set for percentile type",{definition:h,query:t})}}}})()}_getQueryEngineResultForStats(t={},i,e){var r=this;return(0,F.Z)(function*(){let s;t=(0,ae.d9)(t);try{t=yield r._schedule(()=>(0,S.Up)(t,r.definitionExpression,r.spatialReference),e),t=yield r._reschedule(()=>r._checkStatisticsSupport(t,i),e),s=yield r._reschedule(()=>r._executeGeometryQuery(t,e),e),s=yield r._reschedule(()=>s.executeAggregateIdsQuery(t),e),s=yield r._reschedule(()=>s.executeObjectIdsQuery(t),e),s=yield r._reschedule(()=>s.executeTimeQuery(t),e),s=yield r._reschedule(()=>s.executeAttributesQuery(t),e)}catch(l){if(l!==S.vF)throw l;s=new Q([],null,r)}return s})()}}const Ye=(0,J.Ue)(),Fe=(0,J.Ue)()},87757:(de,ie,p)=>{p.d(ie,{g:()=>F});const F={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},53023:(de,ie,p)=>{p.d(ie,{hN:()=>pe,P0:()=>Ie,cW:()=>xe});var F=p(15861),L=p(26584),ae=p(33190),Y=p(11519),Z=p(91179),J=p(37053);function H(E,R){return E?R?4:3:R?3:2}function D(E,R,W,X,re){if(!E)return!1;const b=H(R,W),{coords:y,lengths:_}=E;let S=!1,z=0;for(const V of _)S=B(S,y,b,z,V,X,re),z+=V*b;return S}function B(E,R,W,X,re,b,y){let _=E,S=X;for(let z=X,V=X+re*W;z<V;z+=W){S=z+W,S===V&&(S=X);const Q=R[z],o=R[z+1],a=R[S],u=R[S+1];(o<y&&u>=y||u<y&&o>=y)&&Q+(y-o)/(u-o)*(a-Q)<b&&(_=!_)}return _}var oe=p(82054),fe=p(88071),ce=p(82959),ne=p(6185);const ee="feature-store:unsupported-query",Se={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},_e_spatialRelationship={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},_e_queryGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_e_layerGeometry={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function Pe(E){return!0===_e_spatialRelationship[E]}function Ce(E){return!0===_e_queryGeometry[(0,Z.Ji)(E)]}function me(E){return!0===_e_layerGeometry[E]}function xe(E,R,W,X,re){if((0,Z.oU)(R)&&"esriGeometryPoint"===W&&("esriSpatialRelIntersects"===E||"esriSpatialRelContains"===E)){const b=(0,oe.Uy)(new fe.Z,R,!1,!1);return Promise.resolve(y=>function T(E,R,W,X){return D(E,R,W,X.coords[0],X.coords[1])}(b,!1,!1,y))}if((0,Z.oU)(R)&&"esriGeometryMultipoint"===W){const b=(0,oe.Uy)(new fe.Z,R,!1,!1);if("esriSpatialRelContains"===E)return Promise.resolve(y=>function M(E,R,W,X,re,b){const y=H(re,b),{coords:_,lengths:S}=X;if(!S)return!1;for(let z=0,V=0;z<S.length;z++,V+=y)if(!D(E,R,W,_[V],_[V+1]))return!1;return!0}(b,!1,!1,y,X,re))}if((0,Z.YX)(R)&&"esriGeometryPoint"===W&&("esriSpatialRelIntersects"===E||"esriSpatialRelContains"===E))return Promise.resolve(b=>(0,ae.aV)(R,(0,ne.Op)(W,X,re,b)));if((0,Z.YX)(R)&&"esriGeometryMultipoint"===W&&"esriSpatialRelContains"===E)return Promise.resolve(b=>(0,ae.lQ)(R,(0,ne.Op)(W,X,re,b)));if((0,Z.YX)(R)&&"esriSpatialRelIntersects"===E){const b=function se(E){return"mesh"===E?Y.h_:(0,Y.IY)(E)}(W);return Promise.resolve(y=>b(R,(0,ne.Op)(W,X,re,y)))}return function ge(){return Promise.all([p.e(4918),p.e(8592)]).then(p.bind(p,32825))}().then(b=>{const y=b[Se[E]].bind(null,R.spatialReference,R);return _=>y((0,ne.Op)(W,X,re,_))})}function Ie(E,R,W){return ve.apply(this,arguments)}function ve(){return(ve=(0,F.Z)(function*(E,R,W){const{spatialRel:X,geometry:re}=E;if(re){if(!Pe(X))throw new L.Z(ee,"Unsupported query spatial relationship",{query:E});if((0,J.JY)(re.spatialReference)&&(0,J.JY)(W)){if(!Ce(re))throw new L.Z(ee,"Unsupported query geometry type",{query:E});if(!me(R))throw new L.Z(ee,"Unsupported layer geometry type",{query:E});if(E.outSR)return(0,ce._W)(E.geometry&&E.geometry.spatialReference,E.outSR)}}})).apply(this,arguments)}function pe(E){if((0,Z.YX)(E))return!0;if((0,Z.oU)(E)){for(const R of E.rings)if(5!==R.length||R[0][0]!==R[1][0]||R[0][0]!==R[4][0]||R[2][0]!==R[3][0]||R[0][1]!==R[3][1]||R[0][1]!==R[4][1]||R[1][1]!==R[2][1])return!1;return!0}return!1}},76530:(de,ie,p)=>{function F(Z,J){if(!Z)return null;const H=J.featureAdapter,{startTimeField:T,endTimeField:M}=Z;let D=Number.POSITIVE_INFINITY,B=Number.NEGATIVE_INFINITY;if(T&&M)J.forEach(oe=>{const fe=H.getAttribute(oe,T),ce=H.getAttribute(oe,M);null==fe||isNaN(fe)||(D=Math.min(D,fe)),null==ce||isNaN(ce)||(B=Math.max(B,ce))});else{const oe=T||M;J.forEach(fe=>{const ce=H.getAttribute(fe,oe);null==ce||isNaN(ce)||(D=Math.min(D,ce),B=Math.max(B,ce))})}return{start:D,end:B}}function L(Z,J,H){if(!J||!Z)return null;const{startTimeField:T,endTimeField:M}=Z;if(!T&&!M)return null;const{start:D,end:B}=J;return null===D&&null===B?null:void 0===D&&void 0===B?()=>!1:T&&M?function ae(Z,J,H,T,M){return null!=T&&null!=M?D=>{const B=Z.getAttribute(D,J),oe=Z.getAttribute(D,H);return(null==B||B<=M)&&(null==oe||oe>=T)}:null!=T?D=>{const B=Z.getAttribute(D,H);return null==B||B>=T}:null!=M?D=>{const B=Z.getAttribute(D,J);return null==B||B<=M}:void 0}(H,T,M,D,B):function Y(Z,J,H,T){return null!=H&&null!=T&&H===T?M=>Z.getAttribute(M,J)===H:null!=H&&null!=T?M=>{const D=Z.getAttribute(M,J);return D>=H&&D<=T}:null!=H?M=>Z.getAttribute(M,J)>=H:null!=T?M=>Z.getAttribute(M,J)<=T:void 0}(H,T||M,D,B)}p.d(ie,{R:()=>F,y:()=>L})},6185:(de,ie,p)=>{p.d(ie,{vF:()=>oe,S2:()=>X,Op:()=>Pe,Up:()=>Ce,j6:()=>Ie,EG:()=>Se});var F=p(15861),L=p(2076),ae=p(62208),Y=p(16730),se=p(15176),Z=p(91179),J=p(13924),H=p(37053),T=p(82054),M=p(88071),D=p(82959);const B=new L.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),oe=Object.freeze({}),fe=new M.Z,ce=new M.Z,ne=new M.Z,ee={esriGeometryPoint:T.fQ,esriGeometryPolyline:T.J6,esriGeometryPolygon:T.eG,esriGeometryMultipoint:T.Iv};function Se(y,_,S,z=y.hasZ,V=y.hasM){if((0,ae.Wi)(_))return null;const Q=y.hasZ&&z,o=y.hasM&&V;if(S){const a=(0,T.Nh)(ne,_,y.hasZ,y.hasM,"esriGeometryPoint",S,z,V);return(0,T.fQ)(a,Q,o)}return(0,T.fQ)(_,Q,o)}function Pe(y,_,S,z,V,Q,o=_,a=S){const u=_&&o,g=S&&a,v=(0,ae.pC)(z)?"coords"in z?z:z.geometry:null;if((0,ae.Wi)(v))return null;if(V){let U=(0,T.zj)(ce,v,_,S,y,V,o,a);return Q&&(U=(0,T.Nh)(ne,U,u,g,y,Q)),ee[y](U,u,g)}if(Q){const U=(0,T.Nh)(ne,v,_,S,y,Q,o,a);return ee[y](U,u,g)}return(0,T.hY)(fe,v,_,S,o,a),ee[y](fe,u,g)}function Ce(y,_,S){return me.apply(this,arguments)}function me(){return(me=(0,F.Z)(function*(y,_,S){const{outFields:z,orderByFields:V,groupByFieldsForStatistics:Q,outStatistics:o}=y;if(z)for(let a=0;a<z.length;a++)z[a]=z[a].trim();if(V)for(let a=0;a<V.length;a++)V[a]=V[a].trim();if(Q)for(let a=0;a<Q.length;a++)Q[a]=Q[a].trim();if(o)for(let a=0;a<o.length;a++)o[a].onStatisticField&&(o[a].onStatisticField=o[a].onStatisticField.trim());return y.geometry&&!y.outSR&&(y.outSR=y.geometry.spatialReference),Ie(y,_,S)})).apply(this,arguments)}function Ie(y,_,S){return ve.apply(this,arguments)}function ve(){return(ve=(0,F.Z)(function*(y,_,S){if(!y)return null;let{where:z}=y;if(y.where=z=z&&z.trim(),(!z||/^1 *= *1$/.test(z)||_&&_===z)&&(y.where=null),!y.geometry)return y;let V=yield pe(y);if(y.distance=0,y.units=null,"esriSpatialRelEnvelopeIntersects"===y.spatialRel){const{spatialReference:u}=y.geometry;V=(0,se.aO)(V),V.spatialReference=u}y.geometry=V,yield(0,D._W)(V.spatialReference,S);const Q=(yield(0,J.aX)((0,Z.im)(V)))[0];if((0,ae.Wi)(Q))throw oe;const o=Q.toJSON(),a=yield(0,D.iV)(o,o.spatialReference,S);if(!a)throw oe;return a.spatialReference=S,y.geometry=a,y})).apply(this,arguments)}function pe(y){return E.apply(this,arguments)}function E(){return(E=(0,F.Z)(function*(y){const{geometry:_,distance:S,units:z}=y;if(null==S||"vertexAttributes"in _)return _;const V=_.spatialReference,Q=z?B.fromJSON(z):(0,Y.qE)(V),o=V&&((0,H.sT)(V)||(0,H.sS)(V))?_:yield(0,D._W)(V,H.Zn).then(()=>(0,D.iV)(_,H.Zn));return(yield R())(o.spatialReference,o,S,Q)})).apply(this,arguments)}function R(){return W.apply(this,arguments)}function W(){return(W=(0,F.Z)(function*(){return(yield Promise.all([p.e(4918),p.e(8592)]).then(p.bind(p,32825))).geodesicBuffer})).apply(this,arguments)}function X(y){return y&&re in y?JSON.parse(JSON.stringify(y,b)):y}const re="_geVersion",b=(y,_)=>y!==re?_:void 0}}]);