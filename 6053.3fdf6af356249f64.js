"use strict";var J=Object.defineProperty,M=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable,F=(n,r,e)=>r in n?J(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e,L=(n,r)=>{for(var e in r||(r={}))K.call(r,e)&&F(n,e,r[e]);if(M)for(var e of M(r))X.call(r,e)&&F(n,e,r[e]);return n};(self.webpackChunkesri4_pwa=self.webpackChunkesri4_pwa||[]).push([[6053],{6053:(n,r,e)=>{e.r(r),e.d(r,{default:()=>O});var U=e(15861),h=e(17626),R=e(63290),Z=e(10699),W=e(32917),l=e(77712),I=(e(85931),e(8314),e(90912),e(76898)),j=e(2004),D=e(91757),z=e(37384),G=e(67802),H=e(45611),N=e(94421),v=e(26584),Q=e(13812),T=e(51920);const A=a=>{let t=class extends a{initialize(){this.exportImageParameters=new T.j({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var s;return null==(s=this.exportImageParameters)||s.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}fetchPopupFeatures(s){const{layer:i}=this;if(!s)return Promise.reject(new v.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:m}=i;if(!m)return Promise.reject(new v.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:m}));const y=this.createFetchPopupFeaturesQuery(s);if(!y)return Promise.resolve([]);const{extent:o,width:p,height:d,x:g,y:x}=y;if(!(o&&p&&d))throw new v.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:o,width:p,height:d});const c=i.fetchFeatureInfo(o,p,d,g,x);return Promise.resolve(c?[c]:[])}};return(0,h._)([(0,l.Cb)()],t.prototype,"exportImageParameters",void 0),(0,h._)([(0,l.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,h._)([(0,l.Cb)()],t.prototype,"layer",void 0),(0,h._)([(0,l.Cb)(Q.qG)],t.prototype,"timeExtent",void 0),t=(0,h._)([(0,I.j)("esri.layers.mixins.WMSLayerView")],t),t},B=R.Z.getLogger("esri.views.2d.layers.WMSLayerView2D");let u=class extends(A((0,N.y)((0,z.y)(H.Z)))){constructor(){super(...arguments),this.container=new D.c}supportsSpatialReference(a){return this.layer.serviceSupportsSpatialReference(a)}update(a){this.strategy.update(a).catch(t=>{(0,Z.D_)(t)||B.error(t)})}attach(){const{layer:a,container:t}=this,{imageMaxHeight:s,imageMaxWidth:i}=a;this.strategy=new G.Z({container:t,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:s,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add((0,W.YP)(()=>this.exportImageVersion,()=>this.requestUpdate()),"exportImageVersion")}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.strategy=null,this.container.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(a){const{view:t,container:s}=this,{x:i,y:m}=a,{spatialReference:y}=t;let o=null,p=0,d=0;if(s.children.some(Y=>{const{width:w,height:S,resolution:E,x:f,y:P}=Y,V=f+E*w,C=P-E*S;return i>=f&&i<=V&&m<=P&&m>=C&&(o=new j.Z({xmin:f,ymin:C,xmax:V,ymax:P,spatialReference:y}),p=w,d=S,!0)}),!o)return null;const g=o.width/p,x=Math.round((i-o.xmin)/g),c=Math.round((o.ymax-m)/g);return{extent:o,width:p,height:d,x,y:c}}doRefresh(){var a=this;return(0,U.Z)(function*(){a.requestUpdate()})()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(a,t,s,i){return this.layer.fetchImage(a,t,s,L({timeExtent:this.timeExtent},i))}};(0,h._)([(0,l.Cb)()],u.prototype,"strategy",void 0),(0,h._)([(0,l.Cb)()],u.prototype,"updating",void 0),u=(0,h._)([(0,I.j)("esri.views.2d.layers.WMSLayerView2D")],u);const O=u}}]);