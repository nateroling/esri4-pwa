"use strict";var Ut=Object.defineProperty,jt=Object.defineProperties,Gt=Object.getOwnPropertyDescriptors,et=Object.getOwnPropertySymbols,$t=Object.prototype.hasOwnProperty,Vt=Object.prototype.propertyIsEnumerable,tt=(re,W,v)=>W in re?Ut(re,W,{enumerable:!0,configurable:!0,writable:!0,value:v}):re[W]=v,H=(re,W)=>{for(var v in W||(W={}))$t.call(W,v)&&tt(re,v,W[v]);if(et)for(var v of et(W))Vt.call(W,v)&&tt(re,v,W[v]);return re},Y=(re,W)=>jt(re,Gt(W));(self.webpackChunkesri4_pwa=self.webpackChunkesri4_pwa||[]).push([[3490],{23490:(re,W,v)=>{v.r(W),v.d(W,{default:()=>Jt});var F=v(15861),I=v(17626),rt=v(73281),Re=v(90885),A=v(26584),S=v(62208),nt=v(99959),ye=v(10699),R=v(77712),it=(v(85931),v(8314),v(90912)),at=v(55342),st=v(68653),ae=v(76898),ot=v(63602),lt=v(552),ut=v(50107),Ne=(v(29132),v(84792)),Je=v(63290),Te=v(83960),ct=v(37053),We=v(38305),ke=v(13812),Ue=v(25982),ft=v(9548),fe=v(2584),Ee=v(80355),ge=v(8341),dt=v(54805),mt=v(37084),j=v(2004),X=v(65234);const je=Je.Z.getLogger("esri.layers.mixins.ImageryTileMixin"),ht=r=>{let e=class extends r{constructor(){super(...arguments),this._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},this.bandIds=null,this.copyright=null,this.fullExtent=null,this.interpolation="nearest",this.multidimensionalDefinition=null,this.raster=null,this.rasterInfo=null,this.sourceJSON=null,this.spatialReference=null,this.tileInfo=null,this.symbolizer=null}set url(t){this._set("url",(0,We.Nm)(t,je))}set renderer(t){this._set("renderer",t),this.updateRenderer()}convertVectorFieldData(t,n){var i=this;return(0,F.Z)(function*(){if((0,S.Wi)(t))return null;const s=i._rasterJobHandler.instance,a=i.rasterInfo.dataType;return s?s.convertVectorFieldData({pixelBlock:t,dataType:a},n):(0,Ee.KC)(t,a)})()}createStreamlinesMesh(t,n){var i=this;return(0,F.Z)(function*(){const s=i._rasterJobHandler.instance;return s?s.createStreamlinesMesh(t,n):(0,mt.z_)(t.rendererSettings,t.flowData,(0,S.pC)(n.signal)?n.signal:(new AbortController).signal)})()}normalizeRasterFetchOptions(t){const{multidimensionalInfo:n}=this.rasterInfo;if((0,S.Wi)(n))return t;let i=t.multidimensionalDefinition||this.multidimensionalDefinition;!(0,S.Wi)(i)&&i.length||(i=this._getDefaultSlice());const s=t.timeExtent||this.timeExtent;if((0,S.pC)(i)&&(0,S.pC)(s)&&((0,S.pC)(s.start)||(0,S.pC)(s.end))){var a,o;i=i.map(g=>g.clone());const l=null==(a=n.variables.find(({name:g})=>g===i[0].variableName))||null==(o=a.dimensions)?void 0:o.find(({name:g})=>"StdTime"===g),u=i.find(({dimensionName:g})=>"StdTime"===g);if(!l||!u)return Y(H({},t),{multidimensionalDefinition:null});const{start:c,end:f}=s,d=(0,S.Wi)(c)?null:c.getTime(),m=(0,S.Wi)(f)?null:f.getTime(),p=null!=d?d:m,y=null!=m?m:d;if((0,S.pC)(l.values)){const g=l.values.filter(h=>{if(Array.isArray(h)){if(p===y)return h[0]<=p&&h[1]>=p;const b=h[0]>=p&&h[1]<=y||h[0]<p&&h[1]>y;return h[0]<=p&&h[1]>p||h[0]<y&&h[1]>=y||b}return p===y?h===p:h>=p&&h<=y});if(g.length){const h=g.sort((x,b)=>{var P,D,T,w;return p===y?(null!=(T=x[0])?T:x)-(null!=(w=b[0])?w:b):Math.abs((null!=(P=x[1])?P:x)-y)-Math.abs((null!=(D=b[1])?D:b)-y)})[0];u.values=[h]}else i=null}else if(l.hasRegularIntervals&&l.extent){const[g,h]=l.extent;p>h||y<g?i=null:u.values=p===y?[p]:[Math.max(g,p),Math.min(h,y)]}}return Y(H({},t),{multidimensionalDefinition:i})}updateRenderer(){var t=this;return(0,F.Z)(function*(){if(!t.loaded||JSON.stringify(t._cachedRendererJson)===JSON.stringify(t.renderer))return;const n=t._rasterJobHandler.instance;n&&(t.symbolizer.rendererJSON=(0,ge.ol)(t.renderer.toJSON()),t.symbolizer.bind(),yield n.updateSymbolizer(t.symbolizer),t._cachedRendererJson=t.renderer.toJSON())})()}applyRenderer(t,n){var i=this;return(0,F.Z)(function*(){const s=t&&t.pixelBlock;if(!((0,S.pC)(s)&&s.pixels&&s.pixels.length>0))return null;let a;yield i.updateRenderer();const o=i._rasterJobHandler.instance,{bandIds:l}=i;return a=o?yield o.symbolize(Y(H({},t),{simpleStretchParams:n,bandIds:l})):i.symbolizer.symbolize(Y(H({},t),{simpleStretchParams:n,bandIds:l})),a})()}getTileUrl(t,n,i){return"RasterTileServer"===this.raster.datasetFormat?`${this.url}/tile/${t}/${n}/${i}`:""}getCompatibleTileInfo(t,n,i=!1){if(!this.loaded||(0,S.Wi)(n))return null;if(i&&t.equals(this.spatialReference))return this.tileInfo;const s=(0,ct.C5)(t);return fe.Z.create({size:256,spatialReference:t,origin:s?{x:s.origin[0],y:s.origin[1]}:{x:n.xmin,y:n.ymax}})}getCompatibleFullExtent(t){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(t)||(this._compatibleFullExtent=this.raster.computeExtent(t)),this._compatibleFullExtent):null}fetchTile(t,n,i,s={}){var a=this;return(0,F.Z)(function*(){if(s.requestAsImageElement){const o=a.getTileUrl(t,n,i);return(0,Ne.default)(o,{responseType:"image",query:H(H({},a.refreshParameters),a.raster.ioConfig.customFetchParameters),signal:s.signal}).then(l=>l.data)}return(0,S.pC)(a.rasterInfo.multidimensionalInfo)&&(s=a.normalizeRasterFetchOptions(s),(0,S.Wi)(s.multidimensionalDefinition))?{extent:a.raster.getTileExtentFromTileInfo(t,n,i,s.tileInfo||a.rasterInfo.storageInfo.tileInfo),pixelBlock:null}:(yield a._initJobHandler(),"raster-shaded-relief"===a.renderer.type&&(s=Y(H({},s),{buffer:{cols:1,rows:1}})),a.raster.fetchTile(t,n,i,s))})()}fetchPixels(t,n,i,s={}){var a=this;return(0,F.Z)(function*(){return(0,S.pC)(a.rasterInfo.multidimensionalInfo)&&(s=a.normalizeRasterFetchOptions(s),(0,S.Wi)(s.multidimensionalDefinition))?{extent:t,pixelBlock:null}:(yield a._initJobHandler(),a.raster.fetchPixels(t,n,i,s))})()}identify(t,n={}){var i=this;return(0,F.Z)(function*(){return(0,S.pC)(i.rasterInfo.multidimensionalInfo)&&(n=i.normalizeRasterFetchOptions(n),(0,S.Wi)(n.multidimensionalDefinition))?{location:t,value:null}:i.raster.identify(t,n)})()}increaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount++}decreaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}hasStandardTime(){var t;const n=this.rasterInfo.multidimensionalInfo;if(!(0,S.pC)(n)||"standard-time"!==this.rasterInfo.dataType)return!1;const i=null==(t=this.multidimensionalDefinition[0])?void 0:t.variableName;return n.variables.some(s=>s.name===i&&s.dimensions.some(a=>"StdTime"===a.name))}getStandardTimeValue(t){return new Date(24*(t-25569)*3600*1e3).toString()}_configDefaultSettings(){this._configDefaultInterpolation(),this.multidimensionalDefinition||(this.multidimensionalDefinition=this._getDefaultSlice()),this._configDefaultRenderer()}_initJobHandler(){if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;const t=new ft.Z;return this._rasterJobHandler.connectionPromise=t.initialize().then(()=>{this._rasterJobHandler.instance=t,this.raster.rasterJobHandler=t,this.renderer&&this.updateRenderer()}).catch(()=>null),this._rasterJobHandler.connectionPromise}_shutdownJobHandler(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null}_configDefaultInterpolation(){if(null==this.interpolation){var t;const n=(0,ge.In)(this.rasterInfo,this.raster.tileType,null==(t=this.sourceJSON)?void 0:t.defaultResamplingMethod);this._set("interpolation",n)}}_getDefaultSlice(){const{multidimensionalInfo:t}=this.raster.rasterInfo;if(!(0,S.pC)(t))return null;const n=t.variables[0];return n.dimensions.map(i=>{var s,a;return new Ue.Z({variableName:n.name,dimensionName:i.name,values:[null!=(s=null==(a=i.values)?void 0:a[0])?s:i.extent[0]],isSlice:!0})})}_configDefaultRenderer(){const t=this.raster.rasterInfo;var n;this.bandIds||(this.bandIds=(0,ge.YD)(t)),this.renderer||(this.renderer=(0,ge.Ob)(t,{bandIds:this.bandIds,variableName:(0,S.pC)(this.multidimensionalDefinition)?null==(n=this.multidimensionalDefinition[0])?void 0:n.variableName:null})),this.symbolizer?(this.symbolizer.rendererJSON=(0,ge.ol)(this.renderer.toJSON()),this.symbolizer.rasterInfo=t):this.symbolizer=new dt.Z({rendererJSON:this.renderer.toJSON(),rasterInfo:t});const i=this.symbolizer.bind();i.success||je.warn("imagery-tile-mixin",i.error||"The given renderer is not supported by the layer.")}};return(0,I._)([(0,R.Cb)()],e.prototype,"_cachedRendererJson",void 0),(0,I._)([(0,R.Cb)()],e.prototype,"_compatibleFullExtent",void 0),(0,I._)([(0,R.Cb)()],e.prototype,"_rasterJobHandler",void 0),(0,I._)([(0,R.Cb)()],e.prototype,"bandIds",void 0),(0,I._)([(0,R.Cb)({json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),(0,I._)([(0,R.Cb)({type:j.Z,json:{read:!1}}),(0,Te.B)("rasterInfo.extent")],e.prototype,"fullExtent",void 0),(0,I._)([(0,R.Cb)()],e.prototype,"interpolation",void 0),(0,I._)([(0,R.Cb)()],e.prototype,"ioConfig",void 0),(0,I._)([(0,R.Cb)({type:[Ue.Z]})],e.prototype,"multidimensionalDefinition",void 0),(0,I._)([(0,R.Cb)()],e.prototype,"raster",void 0),(0,I._)([(0,R.Cb)({readOnly:!0}),(0,Te.B)("raster.rasterInfo")],e.prototype,"rasterInfo",void 0),(0,I._)([(0,R.Cb)()],e.prototype,"sourceJSON",void 0),(0,I._)([(0,R.Cb)({type:X.Z,json:{read:!1}}),(0,Te.B)("rasterInfo.spatialReference")],e.prototype,"spatialReference",void 0),(0,I._)([(0,R.Cb)({type:fe.Z,json:{read:!1}}),(0,Te.B)("rasterInfo.storageInfo.tileInfo")],e.prototype,"tileInfo",void 0),(0,I._)([(0,R.Cb)(ke.HQ)],e.prototype,"url",null),(0,I._)([(0,R.Cb)({types:Re.dr})],e.prototype,"renderer",null),(0,I._)([(0,R.Cb)()],e.prototype,"symbolizer",void 0),e=(0,I._)([(0,ae.j)("esri.layers.ImageryTileMixin")],e),e};var pt=v(49286),yt=v(6647),gt=v(30346),xt=v(99555),vt=v(97941),xe=v(36255),It=v(2939),de=v(79645),ve=v(27497),bt=v(86810),Ct=v(60330),se=v(61068),Ge=v(8614),q=v(77692),z=v(28594),G=v(49672);let K=class extends((0,Ct.v)(bt.wq)){constructor(){super(...arguments),this.rasterJobHandler=null,this.datasetName=null,this.datasetFormat=null,this.rasterInfo=null,this.ioConfig={sampling:"closest"}}init(){var r=this;return(0,F.Z)(function*(){const e=(0,z.zD)();r.addResolvingPromise(e),yield r.when()})()}normalizeCtorArgs(r){return r&&r.ioConfig&&(r=Y(H({},r),{ioConfig:H({resolution:null,bandIds:null,sampling:"closest",tileInfo:fe.Z.create()},r.ioConfig)})),r}get _isGlobalWrappableSource(){const{rasterInfo:r}=this,e=(0,z.ut)(r.spatialReference);return(0,S.pC)(e)&&r.extent.width>=e/2}set url(r){this._set("url",(0,We.Nm)(r,Je.Z.getLogger(this.declaredClass)))}open(r){return(0,F.Z)(function*(){throw new A.Z("BaseRaster:open-not-implemented","open() is not implemented")})()}fetchTile(r,e,t,n={}){var i=this;return(0,F.Z)(function*(){const s=n.tileInfo||i.rasterInfo.storageInfo.tileInfo,a=i.getTileExtentFromTileInfo(r,e,t,s);return i.fetchPixels(a,s.size[0],s.size[1],n)})()}identify(r,e={}){var t=this;return(0,F.Z)(function*(){e=t._getRequestOptionsWithSliceId(e);const{spatialReference:n,extent:i}=t.rasterInfo,{datumTransformation:s}=e;let a=(0,z.nF)(r,n,s);if(!i.intersects(a))return{location:a,value:null};if((0,S.pC)(t.rasterInfo.transform)){const P=t.rasterInfo.transform.inverseTransform(a);if(!t.rasterInfo.nativeExtent.intersects(P))return{location:P,value:null};a=P}let o=0;if(e.srcResolution)o=(0,z.kr)(e.srcResolution,t.rasterInfo,t.ioConfig.sampling).pyramidLevel;else if(o=yield t.computeBestPyramidLevelForLocation(r,e),null==o)return{location:a,value:null};const l=t.identifyPixelLocation(a,o,null);if(null===l)return{location:a,value:null};const{row:u,col:c,rowOffset:f,colOffset:d}=l,m=(0,se.Rq)(t.url,e.sliceId),p=`${o}/${u}/${c}`;let y=(0,se.Qg)(m,null,p);(0,S.Wi)(y)&&(y=t.fetchRawTile(o,u,c,e),(0,se.gX)(m,null,p,y));const g=yield y;if((0,S.Wi)(g)||!g.pixels||0===g.pixels.length)return{location:a,value:null};const h=f*t.rasterInfo.storageInfo.blockHeight+d,x=!g.mask||g.mask[h]?g.pixels.map(P=>P[h]):null,b=t.rasterInfo.dataType;return("vector-magdir"===b||"vector-uv"===b)&&(null==x?void 0:x.length)>1?{location:a,value:x,magdirValue:"vector-magdir"===b?[x[0],x[1]]:(0,Ee.Tg)([x[0],x[1]]),pyramidLevel:o}:{location:a,value:x,pyramidLevel:o}})()}fetchPixels(r,e,t,n={}){var i=this;return(0,F.Z)(function*(){if(r=(0,z.kZ)(r),(n=i._getRequestOptionsWithSliceId(n)).requestRawData)return i._fetchPixels(r,e,t,n);const s=(0,z.ut)(r.spatialReference),a=(0,z.Hq)(r);if((0,S.Wi)(s)||0===a||1===a&&i._isGlobalWrappableSource)return i._fetchPixels(r,e,t,n);if(a>=3)return{extent:r,pixelBlock:null};const o=[],{xmin:l,xmax:u}=r,c=Math.round(s/(u-l)*e),f=c-Math.round((s/2-l)/(u-l)*e);let d=0;const m=[];for(let h=0;h<=a;h++){const x=new j.Z({xmin:0===h?l:-s/2,xmax:h===a?u-s*h:s/2,ymin:r.ymin,ymax:r.ymax,spatialReference:r.spatialReference}),b=0===h?c-f:h===a?e-d:c;d+=b,m.push(b);const P=n.disableWrapAround&&h>0?null:i._fetchPixels(x,b,t,n);o.push(P)}const p=(yield Promise.all(o)).map(h=>null==h?void 0:h.pixelBlock);let y=null;const g={width:e,height:t};return y=i.rasterJobHandler?(yield i.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:p,srcMosaicSize:g,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:m},n)).pixelBlock:(0,q.us)(p,g,{blockWidths:m}),{extent:r,srcExtent:(0,z.tB)(r,i.rasterInfo.spatialReference,n.datumTransformation),pixelBlock:y}})()}fetchRawPixels(r,e,t,n={}){var i=this;return(0,F.Z)(function*(){e={x:Math.floor(e.x),y:Math.floor(e.y)};const s=yield i._fetchRawTiles(r,e,t,n),{nativeExtent:a,nativePixelSize:o,storageInfo:l}=i.rasterInfo,u=2**r,c=o.x*u,f=o.y*u,d=new j.Z({xmin:a.xmin+c*e.x,xmax:a.xmin+c*(e.x+t.width-1),ymin:a.ymax-f*(e.y+t.height-1),ymax:a.ymax-f*e.y,spatialReference:a.spatialReference});if(!s)return{extent:d,srcExtent:d,pixelBlock:null};const{pixelBlocks:m}=s;if(1===m.length&&(0,S.pC)(m[0])&&m[0].width===t.width&&m[0].height===t.height)return{extent:d,srcExtent:d,pixelBlock:s.pixelBlocks[0]};const p=r>0?l.pyramidBlockWidth:l.blockWidth,y=r>0?l.pyramidBlockHeight:l.blockHeight,g={width:Math.ceil(t.width/p)*p,height:Math.ceil(t.height/y)*y},h={x:e.x%p,y:e.y%y};let x;return x=i.rasterJobHandler?(yield i.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:m,srcMosaicSize:t,destDimension:t,clipOffset:h,clipSize:t,coefs:null,sampleSpacing:null,interpolation:n.interpolation,alignmentInfo:null,blockWidths:null},n)).pixelBlock:(0,q.us)(m,g,{clipOffset:h,clipSize:t}),{extent:d,srcExtent:d,pixelBlock:x}})()}fetchRawTile(r,e,t,n){throw new A.Z("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}computeExtent(r){return(0,z.tB)(this.rasterInfo.extent,r)}decodePixelBlock(r,e){return!this.rasterJobHandler||e.useCanvas?(0,Ge.J)(r,e):this.rasterJobHandler.decode({data:r,options:e})}request(r,e,t){var n=this;return(0,F.Z)(function*(){var i,s;const{customFetchParameters:a}=n.ioConfig,{range:o,query:l,headers:u}=e;t=null!=(i=null!=(s=t)?s:e.retryCount)?i:n.ioConfig.retryCount;const c=o?{Range:`bytes=${o.from}-${o.to}`}:null;try{return yield(0,Ne.default)(r,Y(H({},e),{query:H(H({},l),a),headers:H(H({},u),c)}))}catch(f){if(t>0)return t--,n.request(r,e,t);throw f}})()}getSliceIndex(r){const{multidimensionalInfo:e}=this.rasterInfo;if(!(0,S.pC)(e)||!(0,S.pC)(r)||0===r.length)return null;let t=0;const n=r[0].variableName;for(let i=0;i<e.variables.length;i++){const s=e.variables[i],a=s.dimensions;if(s.name!==n){t+=a.map(u=>this._getDimensionValuesCount(u)).reduce((u,c)=>u+c);break}const o=a.map(u=>this._getDimensionValuesCount(u)),l=a.length;for(let u=0;u<l;u++){const c=r.find(m=>m.dimensionName===a[u].name);if(null==c)return null;const f=Array.isArray(c.values[0])?c.values[0][0]:c.values[0],d=this._getIndexFromDimensions(f,a[u]);if(-1===d)return null;o.shift(),t+=u===l-1?d:d*o.reduce((m,p)=>m+p)}}return t}getTileExtentFromTileInfo(r,e,t,n){const i=n.lodAt(r);return this.getTileExtent({x:i.resolution,y:i.resolution},e,t,n.origin,n.spatialReference,n.size)}updateTileInfo(){const{storageInfo:r,spatialReference:e,extent:t,pixelSize:n}=this.rasterInfo;if(!r.tileInfo){const i=[],s=r.maximumPyramidLevel||0;let a=Math.max(n.x,n.y),o=1/.0254*96*a;for(let u=0;u<=s;u++)i.push({level:s-u,resolution:a,scale:o}),a*=2,o*=2;const l=new G.Z({x:t.xmin,y:t.ymax,spatialReference:e});r.tileInfo=new fe.Z({origin:l,size:[r.blockWidth,r.blockHeight],spatialReference:e,lods:i}),r.isVirtualTileInfo=!0}}createRemoteDatasetStorageInfo(r,e=512,t=512,n){const{width:i,height:s,nativeExtent:a,pixelSize:o,spatialReference:l}=r,u=new G.Z({x:a.xmin,y:a.ymax,spatialReference:l});null==n&&(n=Math.max(0,Math.round(Math.log(Math.max(i,s))/Math.LN2-8)));const c=this.computeBlockBoundary(a,512,512,{x:a.xmin,y:a.ymax},[o],n);r.storageInfo=new ve.Z({blockWidth:e,blockHeight:t,pyramidBlockWidth:e,pyramidBlockHeight:t,origin:u,firstPyramidLevel:1,maximumPyramidLevel:n,blockBoundary:c})}computeBestPyramidLevelForLocation(r,e={}){return(0,F.Z)(function*(){return 0})()}computeBlockBoundary(r,e,t,n,i,s=0,a=2){if(1===i.length&&s>0){i=[...i];let{x:c,y:f}=i[0];for(let d=0;d<s;d++)c*=a,f*=a,i.push({x:c,y:f})}const o=[],{x:l,y:u}=n;for(let c=0;c<i.length;c++){const{x:f,y:d}=i[c];o.push({minCol:Math.floor((r.xmin-l+.1*f)/e/f),maxCol:Math.floor((r.xmax-l-.1*f)/e/f),minRow:Math.floor((u-r.ymax+.1*d)/t/d),maxRow:Math.floor((u-r.ymin-.1*d)/t/d)})}return o}getPyramidPixelSize(r){const{nativePixelSize:e}=this.rasterInfo,{pyramidResolutions:t,pyramidScalingFactor:n}=this.rasterInfo.storageInfo;if(0===r)return e;if((0,S.pC)(t)&&t.length)return t[r-1];const i=n**r;return{x:e.x*i,y:e.y*i}}identifyPixelLocation(r,e,t){const{spatialReference:n,nativeExtent:i}=this.rasterInfo,{blockWidth:s,blockHeight:a,maximumPyramidLevel:o,origin:l}=this.rasterInfo.storageInfo,u=(0,z.nF)(r,n,t);if(!i.intersects(u)||e<0||e>o)return null;const c=this.getPyramidPixelSize(e),{x:f,y:d}=c,m=(l.y-u.y)/d/a,p=(u.x-l.x)/f/s,y=Math.min(a-1,Math.floor((m-Math.floor(m))*a)),g=Math.min(s-1,Math.floor((p-Math.floor(p))*s));return{pyramidLevel:e,row:Math.floor(m),col:Math.floor(p),rowOffset:y,colOffset:g,srcLocation:u}}getTileExtent(r,e,t,n,i,s){const[a,o]=s,l=n.x+t*a*r.x,c=n.y-e*o*r.y;return new j.Z({xmin:l,xmax:l+a*r.x,ymin:c-o*r.y,ymax:c,spatialReference:i})}getBlockWidthHeight(r){return{blockWidth:r>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:r>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}isBlockOutside(r,e,t){const n=this.rasterInfo.storageInfo.blockBoundary[r];return!n||n.maxRow<e||n.maxCol<t||n.minRow>e||n.minCol>t}_fetchPixels(r,e,t,n={}){var i=this;return(0,F.Z)(function*(){let s=(0,z.Hq)(r);if(s>=2)return{extent:r,pixelBlock:null};const a=i._getSourceDataInfo(r,e,t,n),{pyramidLevel:o,pyramidResolution:l,srcResolution:u,srcExtent:c,srcWidth:f,srcHeight:d}=a;if(0===f||0===d)return{extent:r,srcExtent:c,pixelBlock:null};const m=(0,S.Wg)(i.rasterInfo.transform),p="gcs-shift"===(null==m?void 0:m.type),y=(0,S.pC)((0,z.ut)(r.spatialReference));!p&&y||(s=(0,z.Hq)(a.srcExtent,p));const g=i.rasterInfo.storageInfo,h={x:Math.floor((c.xmin-g.origin.x)/l.x+.1),y:Math.floor((g.origin.y-c.ymax)/l.y+.1)},x=yield i._fetchRawTiles(o,h,{width:f,height:d,wrapCount:s},n);if(!x)return{extent:r,srcExtent:c,pixelBlock:null};const b=o>0?g.pyramidBlockWidth:g.blockWidth,P=o>0?g.pyramidBlockHeight:g.blockHeight,D=b===f&&P===d&&h.x%b==0&&h.y%P==0,T=new G.Z({x:(r.xmax-r.xmin)/e,y:(r.ymax-r.ymin)/t,spatialReference:r.spatialReference}),w=!r.spatialReference.equals(i.rasterInfo.spatialReference),{datumTransformation:C}=n;if(!w&&D&&1===x.pixelBlocks.length&&b===e&&P===t&&u.x===T.x&&u.y===T.y)return{extent:r,srcExtent:c,pixelBlock:x.pixelBlocks[0]};const O=y&&(0,S.pC)((0,z.ut)(c.spatialReference)),M=n.requestProjectedLocalDirections&&i.rasterInfo.dataType.startsWith("vector");M&&!i.rasterJobHandler&&(yield(0,z.zD)());const B=i.rasterJobHandler?yield i.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:r,srcBufferExtent:x.extent,pixelSize:T.toJSON(),datumTransformation:C,rasterTransform:m,hasWrapAround:s>0||O,isAdaptive:!1!==i.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:M},n):(0,z.Qp)({projectedExtent:r,srcBufferExtent:x.extent,pixelSize:T,datumTransformation:C,rasterTransform:m,hasWrapAround:s>0||O,isAdaptive:!1,includeGCSGrid:M});let E;const k=!n.requestRawData,ie={rows:B.spacing[0],cols:B.spacing[1]},U=(0,S.Wg)(i._getRasterTileAlignmentInfo(o,x.extent.xmin)),{pixelBlocks:V,mosaicSize:_,isPartiallyFilled:Z}=x;let J=null;if(i.rasterJobHandler)({pixelBlock:E,localNorthDirections:J}=yield i.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:V,srcMosaicSize:_,destDimension:k?{width:e,height:t}:null,coefs:k?B.coefficients:null,sampleSpacing:k?ie:null,projectDirections:M,gcsGrid:M?B.gcsGrid:null,isUV:"vector-uv"===i.rasterInfo.dataType,interpolation:n.interpolation,alignmentInfo:U,blockWidths:null},n));else{const N=(0,q.us)(V,_,{alignmentInfo:U});E=k?(0,q.Uk)(N,{width:e,height:t},B.coefficients,ie,n.interpolation):N,M&&B.gcsGrid&&(J=(0,q.Qh)({width:e,height:t},B.gcsGrid),E=(0,Ee.xQ)(E,i.rasterInfo.dataType,J))}return n.requestRawData||M?{srcExtent:c,pixelBlock:E,transformGrid:B,localNorthDirections:J,extent:r,isPartiallyFilled:Z}:{srcExtent:c,extent:r,pixelBlock:E}})()}_fetchRawTiles(r,e,t,n){var i=this;return(0,F.Z)(function*(){const{origin:s,blockBoundary:a}=i.rasterInfo.storageInfo,{blockWidth:o,blockHeight:l}=i.getBlockWidthHeight(r);let{x:u,y:c}=e,{width:f,height:d,wrapCount:m}=t;const p=i._getRasterTileAlignmentInfo(r,0);n.buffer&&(u-=n.buffer.cols,c-=n.buffer.rows,f+=2*n.buffer.cols,d+=2*n.buffer.rows);let y=0,g=0,h=0;m&&(0,S.pC)(p)&&(({worldColumnCountFromOrigin:g,originColumnOffset:h,rightPadding:y}=p),g*p.blockWidth-y>=u+f&&(y=0));const x=Math.floor(u/o),b=Math.floor(c/l),P=Math.floor((u+f+y-1)/o),D=Math.floor((c+d+y-1)/l),T=a[r];if(!T)return null;const{minRow:w,minCol:C,maxCol:O,maxRow:M}=T;if(0===m&&(D<w||P<C||b>M||x>O))return null;const B=new Array;let E=!1;const k=null==i.ioConfig.allowPartialFill?n.allowPartialFill:i.ioConfig.allowPartialFill;for(let N=b;N<=D;N++)for(let te=x;te<=P;te++){let Ze=te;if(!n.disableWrapAround&&m&&(0,S.pC)(p)&&g<=te&&(Ze=te-g-h),N>=w&&Ze>=C&&M>=N&&O>=Ze){const qe=i._fetchRawTile(r,N,Ze,n);B.push(k?new Promise(Ke=>{qe.then(Wt=>Ke(Wt)).catch(()=>{E=!0,Ke(null)})}):qe)}else B.push(null)}if(0===B.length)return null;const ie=yield Promise.all(B),U={height:(D-b+1)*l,width:(P-x+1)*o},{spatialReference:V}=i.rasterInfo,_=i.getPyramidPixelSize(r),{x:Z,y:J}=_;return{extent:new j.Z({xmin:s.x+x*o*Z,xmax:s.x+(P+1)*o*Z,ymin:s.y-(D+1)*l*J,ymax:s.y-b*l*J,spatialReference:V}),pixelBlocks:ie,mosaicSize:U,isPartiallyFilled:E}})()}_fetchRawTile(r,e,t,n){const i=this.rasterInfo.storageInfo.blockBoundary[r];if(!i)return Promise.resolve(null);const{minRow:s,minCol:a,maxCol:o,maxRow:l}=i;if(e<s||t<a||e>l||t>o)return Promise.resolve(null);const u=(0,se.Rq)(this.url,n.sliceId),c=`${r}/${e}/${t}`;let f=(0,se.Qg)(u,n.registryId,c);if((0,S.Wi)(f)){const d=new AbortController;f=this.fetchRawTile(r,e,t,Y(H({},n),{signal:d.signal})),(0,se.gX)(u,n.registryId,c,f,d),f.catch(()=>(0,se.Gc)(u,n.registryId,c))}return n.signal&&(0,ye.fu)(n,()=>{(0,se.OE)(u,n.registryId,c)}),f}_getIndexFromDimensions(r,e){const{extent:t,interval:n,unit:i,values:s}=e;if(null!=s&&s.length)return Array.isArray(s[0])?s.findIndex(u=>u[0]<=r&&u[1]>=r):s.indexOf(r);if(r>t[1])return-1;const a=t[0];let o=-1;if("ISO8601"===i){var l;switch((null==(l=e.intervalUnit)?void 0:l.toLowerCase())||"seconds"){case"seconds":o=Math.round((r-a)/1e3/n);break;case"minutes":o=Math.round((r-a)/6e4/n);break;case"hours":o=Math.round((r-a)/36e5/n);break;case"days":o=Math.round((r-a)/864e5/n);break;case"years":o=Math.round((new Date(r).getUTCFullYear()-new Date(a).getUTCFullYear())/n);break;case"decades":o=Math.round((new Date(r).getUTCFullYear()-new Date(a).getUTCFullYear())/10/n)}return o}return Math.round((r-a)/n)}_getDimensionValuesCount(r){const{extent:e,interval:t,unit:n,values:i}=r;let s=(null==i?void 0:i.length)||0;if(s)return s;const a=e[0];if(0===s&&"ISO8601"===n){var o;switch((null==(o=r.intervalUnit)?void 0:o.toLowerCase())||"seconds"){case"seconds":s=Math.round((e[1]-e[0])/1e3/t);break;case"minutes":s=Math.round((e[1]-e[0])/6e4/t);break;case"hours":s=Math.round((e[1]-e[0])/36e5/t);break;case"days":s=Math.round((e[1]-e[0])/864e5/t);break;case"years":s=Math.round((new Date(e[1]).getUTCFullYear()-new Date(a).getUTCFullYear())/t);break;case"decades":s=Math.round((new Date(e[1]).getUTCFullYear()-new Date(a).getUTCFullYear())/10/t)}return s}return Math.round((e[1]-e[0])/t)}_getRasterTileAlignmentInfo(r,e){return null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=(0,z.P_)(this.rasterInfo)),(0,S.pC)(this._rasterTileAlighmentInfo.pyramidsInfo)?H({startX:e,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform},this._rasterTileAlighmentInfo.pyramidsInfo[r]):null}_getSourceDataInfo(r,e,t,n={}){const i={datumTransformation:n.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0};n.srcResolution&&(i.srcResolution=n.srcResolution,this._updateSourceDataInfo(r,i));const s=this.rasterInfo.storageInfo.maximumPyramidLevel||0,{srcWidth:a,srcHeight:o,pyramidLevel:l}=i,u=a/e,c=o/t,f=l<s&&u*c>=16;if(f||l===s&&(u>8||c>8)||0===a||0===o){const d=new G.Z({x:(r.xmax-r.xmin)/e,y:(r.ymax-r.ymin)/t,spatialReference:r.spatialReference});let m=(0,z.VO)(d,this.rasterInfo.spatialReference,r,i.datumTransformation);const p=!m||n.srcResolution&&m.x+m.y<n.srcResolution.x+n.srcResolution.y;if(f&&n.srcResolution&&p){const y=Math.round(Math.log(Math.max(u,c))/Math.LN2)-1;if(s-l+3>=y){const g=2**y;m={x:n.srcResolution.x*g,y:n.srcResolution.y*g}}}m&&(i.srcResolution=m,this._updateSourceDataInfo(r,i))}return(i.srcWidth/e>8||i.srcHeight/t>8)&&(i.srcWidth=0,i.srcHeight=0),i}_updateSourceDataInfo(r,e){e.srcWidth=0,e.srcHeight=0;const t=this.rasterInfo.spatialReference,{srcResolution:n,datumTransformation:i}=e,{pyramidLevel:s,pyramidResolution:a,excessiveReading:o}=(0,z.kr)(n,this.rasterInfo,this.ioConfig.sampling);if(o)return;let l=e.srcExtent||(0,z.tB)(r,t,i);if(null==l)return;const u=(0,S.Wg)(this.rasterInfo.transform);u&&(l=u.inverseTransform(l)),e.srcExtent=l;const c=Math.ceil((l.xmax-l.xmin)/a.x-.1),f=Math.ceil((l.ymax-l.ymin)/a.y-.1);e.pyramidLevel=s,e.pyramidResolution=a,e.srcWidth=c,e.srcHeight=f}_getRequestOptionsWithSliceId(r){return(0,S.pC)(this.rasterInfo.multidimensionalInfo)&&null==r.sliceId&&(r=Y(H({},r),{sliceId:this.getSliceIndex(r.multidimensionalDefinition)})),r}};(0,I._)([(0,R.Cb)()],K.prototype,"_rasterTileAlighmentInfo",void 0),(0,I._)([(0,R.Cb)({readOnly:!0})],K.prototype,"_isGlobalWrappableSource",null),(0,I._)([(0,R.Cb)(ke.HQ)],K.prototype,"url",null),(0,I._)([(0,R.Cb)({type:String,json:{write:!0}})],K.prototype,"datasetName",void 0),(0,I._)([(0,R.Cb)({type:String,json:{write:!0}})],K.prototype,"datasetFormat",void 0),(0,I._)([(0,R.Cb)()],K.prototype,"rasterInfo",void 0),(0,I._)([(0,R.Cb)()],K.prototype,"ioConfig",void 0),(0,I._)([(0,R.Cb)()],K.prototype,"sourceJSON",void 0),K=(0,I._)([(0,ae.j)("esri.layers.support.rasterDatasets.BaseRaster")],K);const me=K;var $e=v(15365);function St(r){const e=r.fields,t=r.records,n=e.some(u=>"oid"===u.name.toLowerCase())?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(e.map(u=>({name:u.name,type:"esriFieldType"+u.typeName,alias:u.name}))),s=i.map(u=>u.name),a=[];let o=0,l=0;return t.forEach(u=>{const c={};for(c[n]=o++,l=1;l<s.length;l++)c[s[l]]=u[l-1];a.push({attributes:c})}),{displayFieldName:"",fields:i,features:a}}var Ve=v(46572),_e=v(17253);const le=new Map;le.set("int16","esriFieldTypeSmallInteger"),le.set("int32","esriFieldTypeInteger"),le.set("int64","esriFieldTypeInteger"),le.set("float32","esriFieldTypeSingle"),le.set("float64","esriFieldTypeDouble"),le.set("text","esriFieldTypeString");let Ie=class extends me{constructor(){super(...arguments),this.storageInfo=null,this.datasetFormat="CRF"}open(r){var e=this;return(0,F.Z)(function*(){yield e.init();const{data:t}=yield e.request(e.url+"/conf.json",{signal:null==r?void 0:r.signal});if(!e._validateHeader(t))throw new A.Z("cloudraster:open","Invalid or unsupported conf.json.");e.datasetName=e.url.slice(e.url.lastIndexOf("/")+1);const{storageInfo:n,rasterInfo:i}=e._parseHeader(t);if("thematic"===i.dataType){const s=yield e._fetchAuxiliaryInformation();i.attributeTable=s}e._set("storageInfo",n),e._set("rasterInfo",i),e.ioConfig.retryCount=e.ioConfig.retryCount||0})()}fetchRawTile(r,e,t,n={}){var i=this;return(0,F.Z)(function*(){const s=i.rasterInfo.storageInfo.maximumPyramidLevel-r;if(s<0)return null;const a=i._buildCacheFilePath(s,e,t,n.multidimensionalDefinition),o=i._getIndexRecordFromBundle(e,t),l=yield i.request(a,{range:{from:0,to:i.storageInfo.headerSize-1},responseType:"array-buffer",signal:n.signal});if(!l)return null;const u=new Uint8Array(l.data),c=i._getTileEndAndContentType(u,o);if(0===c.recordSize)return null;const f=yield i.request(a,{range:{from:c.position,to:c.position+c.recordSize},responseType:"array-buffer",signal:n.signal});return f?i.decodePixelBlock(f.data,{width:i.rasterInfo.storageInfo.tileInfo.size[0],height:i.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null}):null})()}_validateHeader(r){return r&&"RasterInfo"===r.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some(t=>!r[t])}_parseHeader(r){var e,t;const n=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][r.pixelType],{bandCount:i,histograms:s,colormap:a,blockWidth:o,blockHeight:l,firstPyramidLevel:u,maximumPyramidLevel:c}=r,f=r.statistics&&r.statistics.map(J=>({min:J.min,max:J.max,avg:J.mean,stddev:J.standardDeviation,median:J.median,mode:J.mode})),d=r.extent.spatialReference,m=null==(e=r.geodataXform)?void 0:e.spatialReference,p=new X.Z(null!=d&&d.wkid||null!=d&&d.wkt?d:m);let y=new j.Z({xmin:r.extent.xmin,ymin:r.extent.ymin,xmax:r.extent.xmax,ymax:r.extent.ymax,spatialReference:p});const g=new G.Z({x:r.pixelSizeX,y:r.pixelSizeY,spatialReference:p}),h=Math.round((y.xmax-y.xmin)/g.x),x=Math.round((y.ymax-y.ymin)/g.y),b=this._parseTransform(r.geodataXform),P=b?y:null;b&&(y=b.forwardTransform(y),g.x=(y.xmax-y.xmin)/h,g.y=(y.ymax-y.ymin)/x);const D=null!=(t=r.properties)?t:{},T=r.format.toLowerCase().replace("cache/",""),w=new G.Z(r.origin.x,r.origin.y,p);let C,O,M,B;if(a&&a.colors)for(C=[],O=0;O<a.colors.length;O++)M=a.colors[O],B=a.values?a.values[O]:O,C.push([B,255&M,M<<16>>>24,M<<8>>>24,M>>>24]);const E=r.LODInfos,k=[];for(O=0;O<E.levels.length;O++)k.push({level:E.levels[O],resolution:E.resolutions[O],scale:96/.0254*E.resolutions[O]});const ie=new fe.Z({dpi:96,lods:k,format:T,origin:w,size:[o,l],spatialReference:p}),U={recordSize:8,packetSize:r.packetSize,headerSize:r.packetSize*r.packetSize*8+64},V=[{maxCol:Math.ceil(h/o)-1,maxRow:Math.ceil(x/l)-1,minCol:0,minRow:0}];let _=2;if(c>0)for(O=0;O<c;O++)V.push({maxCol:Math.ceil(h/_/o)-1,maxRow:Math.ceil(x/_/l)-1,minCol:0,minRow:0}),_*=2;return{storageInfo:U,rasterInfo:new de.Z({width:h,height:x,pixelType:n,bandCount:i,extent:y,nativeExtent:P,transform:b,spatialReference:p,pixelSize:g,keyProperties:D,statistics:f,histograms:s,multidimensionalInfo:r.mdInfo,colormap:C,storageInfo:new ve.Z({blockWidth:o,blockHeight:l,pyramidBlockWidth:o,pyramidBlockHeight:l,origin:w,tileInfo:ie,firstPyramidLevel:u,maximumPyramidLevel:c,blockBoundary:V})})}}_parseTransform(r){var e,t;if(!(0,Ve.j)(r))throw new A.Z("cloudraster:open","the data contains unsupported geodata transform types");const n=(0,Ve.c)(r);if("identity"===n.type)return null;if("polynomial"!==n.type||null==(e=n.forwardCoefficients)||!e.length||null==(t=n.inverseCoefficients)||!t.length)throw new A.Z("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return n}_fetchAuxiliaryInformation(r){var e=this;return(0,F.Z)(function*(){const t=e.request(e.url+"/conf.vat.json",{signal:r}).then(a=>a.data).catch(()=>null),n=e.request(e.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:r}).then(a=>a.data).catch(()=>null),i=yield Promise.all([t,n]);let s;if(i[0]){let a=i[0].fields;const o=i[0].values;if(a&&o){a=a.map(u=>({type:"OID"===u.name?"esriFieldTypeOID":le.get(u.type),name:u.name,alias:u.alias||u.name}));const l=o.map(u=>({attributes:u}));a&&o&&(s={fields:a,features:l})}}return!s&&i[1]&&(s=class Rt{static get supportedVersions(){return[5]}static parse(e){const t=new DataView(e),n=3&t.getUint8(0);if(3!==n)return{header:{version:n},recordSet:null};const i=t.getUint32(4,!0),s=t.getUint16(8,!0),a=t.getUint16(10,!0),o={version:n,recordCount:i,headerByteCount:s,recordByteCount:a};let l=32;const u=[],c=[];let f;if(3===n){for(;13!==t.getUint8(l);)f=String.fromCharCode(t.getUint8(l+11)).trim(),u.push({name:(0,$e.f)(new Uint8Array(e,l,11)),type:f,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(f)],length:t.getUint8(l+16)}),l+=32;if(l+=1,u.length>0)for(;c.length<i&&e.byteLength-l>a;){const d=[];32===t.getUint8(l)?(l+=1,u.forEach(m=>{if("C"===m.type)d.push((0,$e.f)(new Uint8Array(e,l,m.length)).trim());else if("N"===m.type)d.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,l,m.length)).trim(),10));else if("F"===m.type)d.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,l,m.length)).trim()));else if("D"===m.type){const p=String.fromCharCode.apply(null,new Uint8Array(e,l,m.length)).trim();d.push(new Date(parseInt(p.substring(0,4),10),parseInt(p.substring(4,6),10)-1,parseInt(p.substring(6,8),10)))}l+=m.length}),c.push(d)):l+=a}}return{header:o,fields:u,records:c,recordSet:St({fields:u,records:c})}}}.parse(i[1]).recordSet),_e.default.fromJSON(s)})()}_buildCacheFilePath(r,e,t,n){const i=this.storageInfo.packetSize,s=Math.floor(e/i)*i,a=Math.floor(t/i)*i,o="R"+this._toHexString4(s)+"C"+this._toHexString4(a);let l="L";l+=r>=10?r.toString():"0"+r.toString();const{multidimensionalInfo:u}=this.rasterInfo,c=null==n?void 0:n[0];if(!(0,S.pC)(u)||!c)return`${this.url}/_alllayers/${l}/${o}.bundle`;let f=u.variables.find(m=>m.name===c.variableName).dimensions[0].values.indexOf(c.values[0]).toString(16);const d=4-f.length;for(let m=0;m<d;m++)f="0"+f;return f="S"+f,`${this.url}/_alllayers/${c.variableName}/${f}/${l}/${o}.bundle`}_getIndexRecordFromBundle(r,e){const t=this.storageInfo.packetSize,n=t*(r%t)+e%t;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44}_getTileEndAndContentType(r,e){const t=r.subarray(e,e+8);let n,i=0;for(n=0;n<5;n++)i|=(255&t[n])<<8*n;const s=0xffffffffff&i;for(i=0,n=5;n<8;n++)i|=(255&t[n])<<8*(n-5);return{position:s,recordSize:0xffffffffff&i}}_toHexString4(r){let e=r.toString(16);if(4!==e.length){let t=4-e.length;for(;t-- >0;)e="0"+e}return e}};(0,I._)([(0,R.Cb)({readOnly:!0})],Ie.prototype,"storageInfo",void 0),(0,I._)([(0,R.Cb)({type:String,json:{write:!0}})],Ie.prototype,"datasetFormat",void 0),Ie=(0,I._)([(0,ae.j)("esri.layers.support.rasterDatasets.CloudRaster")],Ie);const Tt=Ie;let be=class extends me{constructor(){super(...arguments),this.datasetFormat="MEMORY"}open(r){var e=this;return(0,F.Z)(function*(){var t;yield e.init();const{pixelBlock:n,statistics:i,histograms:s,name:a,keyProperties:o,nativeExtent:l,transform:u}=e.data,{width:c,height:f,pixelType:d}=n,m=e.data.extent||new j.Z({xmin:-.5,ymin:.5,xmax:c-.5,ymax:f-.5,spatialReference:new X.Z({wkid:3857})}),p=null!=(t=e.data.isPseudoSpatialReference)?t:!e.data.extent,g=new de.Z({width:c,height:f,pixelType:d,extent:m,nativeExtent:l,transform:u,pixelSize:{x:m.width/c,y:m.height/f},spatialReference:m.spatialReference,bandCount:3,keyProperties:o||{},statistics:i,isPseudoSpatialReference:p,histograms:s});e.createRemoteDatasetStorageInfo(g,512,512),e._set("rasterInfo",g),e.updateTileInfo(),yield e._buildInMemoryRaster(n,{width:512,height:512},r),e.datasetName=a,e.url="/InMemory/"+a})()}fetchRawTile(r,e,t,n={}){const i=this._pixelBlockTiles.get(`${r}/${e}/${t}`);return Promise.resolve(i)}_buildInMemoryRaster(r,e,t){var n=this;return(0,F.Z)(function*(){const i=n.rasterInfo.storageInfo.maximumPyramidLevel,s=n.rasterJobHandler?n.rasterJobHandler.split({pixelBlock:r,tileSize:e,maximumPyramidLevel:i},t):Promise.resolve((0,q.Vl)(r,e,i)),a=(0,S.pC)(n.rasterInfo.statistics),o=(0,S.pC)(n.rasterInfo.histograms),l=a&&o?Promise.resolve({statistics:null,histograms:null}):n.rasterJobHandler?n.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:r},t):Promise.resolve((0,q.Hv)(r)),u=yield(0,ye.as)([s,l]);if(!u[0].value&&u[1].value)throw new A.Z("inmemory-raster:open","failed to build in memory raster");var c,f;n._pixelBlockTiles=u[0].value,a||(n.rasterInfo.statistics=null==(c=u[1].value)?void 0:c.statistics),o&&(n.rasterInfo.histograms=null==(f=u[1].value)?void 0:f.histograms)})()}};(0,I._)([(0,R.Cb)({type:String,json:{write:!0}})],be.prototype,"datasetFormat",void 0),(0,I._)([(0,R.Cb)()],be.prototype,"data",void 0),be=(0,I._)([(0,ae.j)("esri.layers.support.rasterDatasets.InMemoryRaster")],be);const wt=be;function he(r,e){if(!r||!e)return[];let t=e;e.indexOf("/")>-1?(t=e.slice(0,e.indexOf("/")),e=e.slice(e.indexOf("/")+1)):e="";const n=[];if(e){const s=he(r,t);for(let a=0;a<s.length;a++)he(s[a],e).forEach(o=>n.push(o));return n}const i=r.getElementsByTagNameNS("*",t);if(!i||0===i.length)return[];for(let s=0;s<i.length;s++)n.push(i[s]||i.item[s]);return n}function Q(r,e){if(!r||!e)return null;let t=e;e.indexOf("/")>-1?(t=e.slice(0,e.indexOf("/")),e=e.slice(e.indexOf("/")+1)):e="";const n=he(r,t);return n.length>0?e?Q(n[0],e):n[0]:null}function ee(r,e=null){const t=e?Q(r,e):r;let n;return t?(n=t.textContent||t.nodeValue,n?n.trim():null):null}function Pe(r,e){return function Pt(r,e){const t=he(r,e),n=[];let i;for(let s=0;s<t.length;s++)i=t[s].textContent||t[s].nodeValue,i&&(i=i.trim(),""!==i&&n.push(i));return n}(r,e).map(t=>Number(t))}function ue(r,e){const t=ee(r,e);return Number(t)}function He(r,e){var t;const n=null==r||null==(t=r.nodeName)?void 0:t.toLowerCase(),i=e.toLowerCase();return n.slice(n.lastIndexOf(":")+1)===i}var Le=v(85374);function Xe(r,e){if(!r||!e)return null;const t=[];for(let n=0;n<r.length;n++)t.push(r[n]),t.push(e[n]);return t}function Me(r){if(!r)return null;let e=Number(r);if(!isNaN(e)&&0!==e)return new X.Z({wkid:e});if((r=String(r)).startsWith("COMPD_CS")){if(!r.includes("VERTCS")||!r.includes("GEOGCS")&&!r.startsWith("PROJCS"))return null;const t=r.indexOf("VERTCS"),n=r.indexOf("PROJCS"),i=n>-1?n:r.indexOf("GEOGCS");if(-1===i)return null;const s=r.slice(i,r.lastIndexOf("]",t)+1).trim(),a=r.slice(t,r.lastIndexOf("]")).trim();e=ze(s);const o=new X.Z(e?{wkid:e}:{wkt:s}),l=ze(a);return l&&(o.vcsWkid=l),o}return r.startsWith("GEOGCS")||r.startsWith("PROJCS")?(e=ze(r),new X.Z(0!==e?{wkid:e}:{wkt:r})):null}function ze(r){var e;const t=r.replace(/\]/g,"[").replace(/\"/g,"").split("[").map(s=>s.trim()).filter(s=>""!==s),n=t[t.length-1].split(","),i=null==(e=n[0])?void 0:e.toLowerCase();if(("epsg"===i||"esri"===i)&&r.endsWith('"]]')){const s=Number(n[1]);if(!isNaN(s)&&0!==s)return s}return 0}function Ae(r){var e;if("pamdataset"!==(null==r||null==(e=r.documentElement.tagName)?void 0:e.toLowerCase()))return{};const t={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};r.documentElement.childNodes.forEach(i=>{if(1===i.nodeType)if(He(i,"SRS")){if(!t.spatialReference){const s=ee(i);t.spatialReference=Me(s)}}else if(He(i,"Metadata"))if("xml:ESRI"===i.getAttribute("domain")){const{spatialReference:s,transform:a}=function Mt(r){var e;const t=Q(r,"GeodataXform"),n=Me(ue(t,"SpatialReference/WKID")||ee(t,"SpatialReference/WKT"));if("typens:PolynomialXform"!==t.getAttribute("xsi:type"))return{spatialReference:n,transform:null};const i=null!=(e=ue(t,"PolynomialOrder"))?e:1,s=Pe(t,"CoeffX/Double"),a=Pe(t,"CoeffY/Double"),o=Pe(t,"InverseCoeffX/Double"),l=Pe(t,"InverseCoeffY/Double"),u=Xe(s,a),c=Xe(o,l);return{spatialReference:n,transform:new Le.Z({spatialReference:n,polynomialOrder:i,forwardCoefficients:u,inverseCoefficients:c})}}(i);t.transform=a,t.spatialReference||(t.spatialReference=s)}else he(i,"MDI").forEach(s=>t.metadata[s.getAttribute("key")]=ee(s));else if(He(i,"PAMRasterBand")){const s=function Ft(r){var e;const t=ue(r,"NoDataValue"),n=Q(r,"Histograms/HistItem"),i=ue(n,"HistMin"),s=ue(n,"HistMax"),a=ue(n,"BucketCount"),o=null==(e=ee(n,"HistCounts"))?void 0:e.split("|").map(m=>Number(m));let l,u,c,f;he(r,"Metadata/MDI").forEach(m=>{var p;const y=Number(null!=(p=m.textContent)?p:m.nodeValue);switch(m.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":l=y;break;case"STATISTICS_MAXIMUM":u=y;break;case"STATISTICS_MEAN":c=y;break;case"STATISTICS_STDDEV":f=y}});const d=ue(r,"Metadata/SourceBandIndex");return{noDataValue:t,histogram:null!=o&&o.length&&null!=l&&null!=u?{min:i,max:s,size:a||o.length,counts:o}:null,sourceBandIndex:d,statistics:null!=l&&null!=u?{min:l,max:u,avg:c,stddev:f}:null}}(i);null!=s.sourceBandIndex&&null==t.rasterBands[s.sourceBandIndex]?t.rasterBands[s.sourceBandIndex]=s:t.rasterBands.push(s)}});const n=t.rasterBands;return n&&(t.statistics=n[0].statistics?n.map(a=>a.statistics):null,t.histograms=n[0].histogram?n.map(a=>a.histogram):null),t}let Fe=class extends me{open(r){var e=this;return(0,F.Z)(function*(){yield e.init();const t=yield e._fetchData(r);let{spatialReference:n,statistics:i,histograms:s,transform:a}=yield e._fetchAuxiliaryData(r);const o=!n;o&&(n=new X.Z({wkid:3857})),null!=s&&s.length&&null==i&&(i=(0,q.Oh)(s));const{width:l,height:u}=t;let c=new j.Z({xmin:-.5,ymin:.5-u,xmax:l-.5,ymax:.5,spatialReference:n});const f=a?a.forwardTransform(c):c;let d=!0;if(a){const p=a.forwardCoefficients;d=p&&0===p[1]&&0===p[2],d&&(a=null,c=f)}const m=new wt({data:{extent:f,nativeExtent:c,transform:a,pixelBlock:t,statistics:i,histograms:s,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:o}});yield m.open(),e._set("rasterInfo",m.rasterInfo),e._inMemoryRaster=m})()}fetchRawTile(r,e,t,n={}){return this._inMemoryRaster.fetchRawTile(r,e,t,n)}_fetchData(r){var e=this;return(0,F.Z)(function*(){const{data:t}=yield e.request(e.url,{responseType:"array-buffer",signal:null==r?void 0:r.signal}),n=(0,Ge.y)(t).toUpperCase();if("JPG"!==n&&"PNG"!==n&&"GIF"!==n&&"BMP"!==n)throw new A.Z("image-aux-raster:open","the data is not a supported format");return e._set("datasetFormat",n),yield e.decodePixelBlock(t,{format:"jpg",width:1,height:1,useCanvas:!0})})()}_fetchAuxiliaryData(r){var e=this;return(0,F.Z)(function*(){var t,n;const i=(0,S.Wg)(null==r?void 0:r.signal),s=null!=(t=e.ioConfig.skipExtensions)?t:[],a=s.indexOf("aux.xml")>-1?null:e.request(e.url+".aux.xml",{responseType:"xml",signal:i}),o=e.datasetFormat,l="JPG"===o?"jgw":"PNG"===o?"pgw":"BMP"===o?"bpw":null,u=s.indexOf(l)>-1?null:e.request(e.url.slice(0,e.url.lastIndexOf("."))+"."+l,{responseType:"text",signal:i}),c=yield(0,ye.as)([a,u]);if(null!=i&&i.aborted)throw(0,ye.zE)();const f=Ae(null==(n=c[0].value)?void 0:n.data);if(!f.transform){const d=c[1].value?c[1].value.data.split("\n").slice(0,6).map(m=>Number(m)):null;f.transform=6===(null==d?void 0:d.length)?new Le.Z({forwardCoefficients:[d[4],d[5],d[0],-d[1],d[2],-d[3]]}):null}return f})()}};(0,I._)([(0,R.Cb)({type:String,json:{write:!0}})],Fe.prototype,"datasetFormat",void 0),Fe=(0,I._)([(0,ae.j)("esri.layers.support.rasterDatasets.ImageAuxRaster")],Fe);const Oe=Fe;var Ot=v(21726),Dt=v(51026),Bt=v(28930),Zt=v(76671);let Ce=class extends me{constructor(){super(...arguments),this._levelOffset=0,this._slices=null,this._tilemapCache=null,this.datasetFormat="RasterTileServer"}open(r){var e=this;return(0,F.Z)(function*(){yield e.init();const t=r&&r.signal,n=e.sourceJSON?{data:e.sourceJSON}:yield e.request(e.url,{query:{f:"json"},signal:t});n.ssl&&(e.url=e.url.replace(/^http:/i,"https:"));const i=n.data;if(e.sourceJSON=i,!i)throw new A.Z("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!i.tileInfo)throw new A.Z("imageserverraster:open","use ImageryLayer to open non-tiled image services");e._fixScaleInServiceInfo(),e.tileType=i.cacheType,null==e.tileType&&(e.tileType=["jpg","jpeg","png","png8","png24","png32","mixed"].indexOf(i.tileInfo.format.toLowerCase())>-1?"Map":"lerc"===i.tileInfo.format.toLowerCase()?"Elevation":"Raster"),e.datasetName=i.name.slice(i.name.indexOf("/")+1);const a=yield e._fetchRasterInfo({signal:t});if(!(0,S.pC)(a))throw new A.Z("image-server-raster:open","cannot initialize image service");{const o="Map"===e.tileType?(0,Dt.d)(i.tileInfo,i):fe.Z.fromJSON(i.tileInfo),{extent:l,pixelSize:u}=a,c=.5/a.width*u.x;let f,d;const m=o.lodAt(Math.max.apply(null,o.lods.map(T=>T.level)));"Map"!==e.tileType&&0!==i.maxScale&&("Raster"===e.tileType?(f=o.lods.find(T=>T.resolution===u.x),f||(f=o.lods[o.lods.length-1])):(f=o.lods.find(T=>Math.abs(T.scale-i.maxScale)<c),f||(f=o.lods.filter(T=>T.scale>i.maxScale).sort((T,w)=>T.scale>w.scale?1:-1)[0])),u.x=u.y=f.resolution,a.width=Math.ceil((l.xmax-l.xmin)/u.x-.1),a.height=Math.ceil((l.ymax-l.ymin)/u.y-.1)),f||(f=m);const p=o.lodAt(Math.min.apply(null,o.lods.map(T=>T.level)));"Map"===e.tileType?e._levelOffset=o.lods[0].level:0!==i.minScale&&"Elevation"===e.tileType&&(d=o.lods.find(T=>Math.abs(T.scale-i.minScale)<c),e._levelOffset=d.level-p.level),d||(d=p);const y=Math.max(u.x,u.y);(Math.abs(u.x-u.y)>c||!o.lods.some(T=>Math.abs(T.resolution-y)<c))&&(u.x=u.y=f.resolution,a.width=Math.ceil((l.xmax-l.xmin)/u.x-.1),a.height=Math.ceil((l.ymax-l.ymin)/u.y-.1));const g=f.level-d.level,[h,x]=o.size,b=[];o.lods.forEach(T=>{T.level>=d.level&&T.level<=f.level&&b.push({x:T.resolution,y:T.resolution})}),b.sort((T,w)=>T.x-w.x);const P=e.computeBlockBoundary(l,h,x,o.origin,b,g),D=b.length>1?b.slice(1):null;a.storageInfo=new ve.Z({blockWidth:o.size[0],blockHeight:o.size[1],pyramidBlockWidth:o.size[0],pyramidBlockHeight:o.size[1],pyramidResolutions:D,compression:o.format,origin:o.origin,firstPyramidLevel:1,maximumPyramidLevel:g,tileInfo:o,blockBoundary:P}),e._fixGCSShift(a),e._set("rasterInfo",a)}if(i.capabilities.toLowerCase().indexOf("tilemap")>-1){const o={tileInfo:a.storageInfo.tileInfo,parsedUrl:(0,Ot.mN)(e.url),url:e.url,tileServers:[],type:"tile"};e._tilemapCache=new Bt.y({layer:o})}})()}fetchRawTile(r,e,t,n={}){var i=this;return(0,F.Z)(function*(){if(i._slices&&null==n.sliceId)return null;const{storageInfo:s,extent:a}=i.rasterInfo,l=`${i.url}/tile/${s.maximumPyramidLevel-r+i._levelOffset}/${e}/${t}`,u=i._slices?{sliceId:n.sliceId||0}:null,{data:c}=yield i.request(l,{query:u,responseType:"array-buffer",signal:n.signal});if(!c)return null;const f=yield i.decodePixelBlock(c,{width:s.tileInfo.size[0],height:s.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===i.tileType}),d=s.blockBoundary[r];if("jpg"!==s.compression||t>d.minCol&&t<d.maxCol&&e>d.minRow&&e<d.maxRow)return f;const{origin:m,blockWidth:p,blockHeight:y}=s,{x:g,y:h}=i.getPyramidPixelSize(r),x=Math.round((a.xmin-m.x)/g)%p,b=Math.round((a.xmax-m.x)/g)%p||p,P=Math.round((m.y-a.ymax)/h)%y,D=Math.round((m.y-a.ymin)/h)%y||y,T=t===d.minCol?x:0,w=e===d.minRow?P:0;return(0,q.pW)(f,{x:T,y:w},{width:(t===d.maxCol?b:p)-T,height:(e===d.maxRow?D:y)-w}),f})()}getSliceIndex(r){if(!this._slices||(0,S.Wi)(r)||0===r.length)return null;const e=r;for(let t=0;t<this._slices.length;t++){const n=this._slices[t].multidimensionalDefinition;if(n.length===e.length&&!n.some(i=>{const s=e.find(a=>i.variableName===a.variableName&&a.dimensionName===i.dimensionName);return!s||(Array.isArray(i.values[0])?`${i.values[0][0]}-${i.values[0][1]}`:i.values[0])!==(Array.isArray(s.values[0])?`${s.values[0][0]}-${s.values[0][1]}`:s.values[0])}))return t}return null}fetchVariableStatisticsHistograms(r,e){var t=this;return(0,F.Z)(function*(){const n=t.request(t.url+"/statistics",{query:{variable:r,f:"json"},signal:e}).then(a=>{var o;return null==(o=a.data)?void 0:o.statistics}),i=t.request(t.url+"/histograms",{query:{variable:r,f:"json"},signal:e}).then(a=>{var o;return null==(o=a.data)?void 0:o.histograms}),s=yield Promise.all([n,i]);return s[0]&&s[0].forEach(a=>{a.avg=a.mean,a.stddev=a.standardDeviation}),{statistics:s[0]||null,histograms:s[1]||null}})()}computeBestPyramidLevelForLocation(r,e={}){var t=this;return(0,F.Z)(function*(){if(!t._tilemapCache)return 0;let n=t.identifyPixelLocation(r,0,(0,S.Wg)(e.datumTransformation));if(null===n)return null;let i=0;const{maximumPyramidLevel:s}=t.rasterInfo.storageInfo;let a=s-i+t._levelOffset;const o=n.srcLocation;for(;a>=0;){try{if("available"===(yield t._tilemapCache.fetchAvailability(a,n.row,n.col,e)))break}catch(l){}if(a--,i++,n=t.identifyPixelLocation(o,i,(0,S.Wg)(e.datumTransformation)),null===n)return null}return-1===a||null==n?null:i})()}_fetchRasterInfo(r){var e=this;return(0,F.Z)(function*(){const t=e.sourceJSON,n=Math.ceil((t.extent.xmax-t.extent.xmin)/t.pixelSizeX-.1),i=Math.ceil((t.extent.ymax-t.extent.ymin)/t.pixelSizeY-.1),s=X.Z.fromJSON(t.spatialReference||t.extent.spatialReference);if("Map"===e.tileType)return new de.Z({width:n,height:i,bandCount:3,extent:j.Z.fromJSON(t.extent),spatialReference:s,pixelSize:new G.Z({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:s}),pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}});const{slice:a,signal:o}=r,l=!!t.hasRasterAttributeTable&&e.request(e.url+"/rasterAttributeTable",{query:{slice:a,f:"json"},signal:o}).then(p=>_e.default.fromJSON(p.data)).catch(()=>null),u=!!t.hasColormap&&e.request(e.url+"/colormap",{query:{slice:a,f:"json"},signal:o}).then(p=>{var y;return null==(y=p.data)?void 0:y.colormap}),c=!!t.hasHistograms&&e.request(e.url+"/histograms",{query:{slice:a,f:"json"},signal:o}).then(p=>{var y;return null==(y=p.data)?void 0:y.histograms}),f=e.request(e.url+"/keyProperties",{query:{f:"json"},signal:o}).then(p=>p.data).catch(()=>{}),d=!!t.hasMultidimensions&&e._fetchMultidimensionalInfo(),m=!!t.hasMultidimensions&&e.request(e.url+"/slices",{query:{f:"json"},signal:o}).then(p=>p.data&&p.data.slices).catch(()=>{});return Promise.all([l,u,c,f,d,m]).then(p=>{let y=null;if(t.minValues&&t.minValues.length===t.bandCount){y=[];for(let g=0;g<t.minValues.length;g++)y.push({min:t.minValues[g],max:t.maxValues[g],avg:t.meanValues[g],stddev:t.stdvValues[g]})}return e._slices=p[5]||null,new de.Z({width:n,height:i,bandCount:t.bandCount,extent:j.Z.fromJSON(t.extent),spatialReference:s,pixelSize:new G.Z({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:s}),pixelType:t.pixelType.toLowerCase(),statistics:y,attributeTable:p[0]||null,colormap:p[1]||null,histograms:p[2]||null,keyProperties:p[3]||{},multidimensionalInfo:p[4]||null})})})()}_fetchMultidimensionalInfo(r){var e=this;return(0,F.Z)(function*(){var t;const n=yield e.request(e.url+"/multidimensionalInfo",{query:{f:"json"},signal:r}).then(i=>{var s;return null==(s=i.data)?void 0:s.multidimensionalInfo});return null!=(t=n.variables)&&t.length&&n.variables.forEach(i=>{var s;null!=(s=i.statistics)&&s.length&&i.statistics.forEach(a=>{a.avg=a.mean,a.stddev=a.standardDeviation})}),n})()}_fixScaleInServiceInfo(){const{sourceJSON:r}=this;r.minScale&&r.minScale<0&&(r.minScale=0),r.maxScale&&r.maxScale<0&&(r.maxScale=0)}_fixGCSShift(r){const{extent:e,spatialReference:t}=r;0===e.xmin&&360===e.xmax&&t.wkid&&t.isGeographic&&(r.nativeExtent=r.extent,r.transform=new Zt.Z,r.extent=r.transform.forwardTransform(e))}};(0,I._)([(0,R.Cb)({type:String,json:{write:!0}})],Ce.prototype,"datasetFormat",void 0),(0,I._)([(0,R.Cb)()],Ce.prototype,"tileType",void 0),Ce=(0,I._)([(0,ae.j)("esri.layers.support.rasterDatasets.ImageServerRaster")],Ce);const kt=Ce;var Et=v(60295),Ht=v(44853);const ne=new Map;ne.set("Int8","s8"),ne.set("UInt8","u8"),ne.set("Int16","s16"),ne.set("UInt16","u16"),ne.set("Int32","s32"),ne.set("UInt32","u32"),ne.set("Float32","f32"),ne.set("Float64","f32"),ne.set("Double64","f32");const oe=new Map;oe.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"}),oe.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"}),oe.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"}),oe.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});let pe=class extends me{constructor(){super(...arguments),this._files=null,this._storageIndex=null,this.datasetFormat="MRF"}open(r){var e=this;return(0,F.Z)(function*(){var t;yield e.init(),e.datasetName=e.url.slice(e.url.lastIndexOf("/")+1);const n=r?(0,S.Wg)(r.signal):null,i=yield e.request(e.url,{responseType:"xml",signal:n}),{rasterInfo:s,files:a}=e._parseHeader(i.data);if(-1===(null==(t=e.ioConfig.skipExtensions)?void 0:t.indexOf("aux.xml"))){const x=yield e._fetchAuxiliaryData(r);var o;null!=x&&(s.statistics=null!=(o=x.statistics)?o:s.statistics,s.histograms=x.histograms,x.histograms&&!(0,S.pC)(s.statistics)&&(s.statistics=(0,q.Oh)(x.histograms)))}e._set("rasterInfo",s),e._files=a;const l=yield e.request(a.index,{responseType:"array-buffer",signal:n});e._storageIndex=e._parseIndex(l.data);const{blockWidth:u,blockHeight:c}=e.rasterInfo.storageInfo,f=e.rasterInfo.storageInfo.pyramidScalingFactor,{width:d,height:m}=e.rasterInfo,p=[],y=e._getBandSegmentCount();let g=0,h=-1;for(;g<e._storageIndex.length;){h++;const x=Math.ceil(d/u/f**h)-1,b=Math.ceil(m/c/f**h)-1;g+=(x+1)*(b+1)*y*4,p.push({maxRow:b,maxCol:x,minCol:0,minRow:0})}e.rasterInfo.storageInfo.blockBoundary=p,h>0&&(e.rasterInfo.storageInfo.firstPyramidLevel=1,e.rasterInfo.storageInfo.maximumPyramidLevel=h),e.updateTileInfo()})()}fetchRawTile(r,e,t,n={}){var i=this;return(0,F.Z)(function*(){const{blockWidth:s,blockHeight:a,blockBoundary:o}=i.rasterInfo.storageInfo,l=o[r];if(!l||l.maxRow<e||l.maxCol<t||l.minRow>e||l.minCol>t)return null;const{bandCount:u,pixelType:c}=i.rasterInfo,{ranges:f,actualTileWidth:d,actualTileHeight:m}=i._getTileLocation(r,e,t);if(!f||0===f.length)return null;if(0===f[0].from&&0===f[0].to){const M=new Uint8Array(s*a);return new Et.Z({width:s,height:a,pixels:null,mask:M,validPixelCount:0})}const{bandIds:p}=i.ioConfig,y=i._getBandSegmentCount(),g=[];let h=0;for(h=0;h<y;h++)(!p||p.indexOf[h]>-1)&&g.push(i.request(i._files.data,{range:{from:f[h].from,to:f[h].to},responseType:"array-buffer",signal:n.signal}));const x=yield Promise.all(g),b=x.map(M=>M.data.byteLength).reduce((M,B)=>M+B),P=new Uint8Array(b);let D=0;for(h=0;h<y;h++)P.set(new Uint8Array(x[h].data),D),D+=x[h].data.byteLength;const T=oe.get(i.rasterInfo.storageInfo.compression).decoderFormat,w=yield i.decodePixelBlock(P.buffer,{width:s,height:a,format:T,planes:(null==p?void 0:p.length)||u,pixelType:c});if((0,S.pC)(i.rasterInfo.noDataValue)&&"lerc"!==T&&!w.mask){const M=i.rasterInfo.noDataValue[0];if(null!=M){const B=w.width*w.height,E=new Uint8Array(B);if(Math.abs(M)>1e24)for(h=0;h<B;h++)Math.abs((w.pixels[0][h]-M)/M)>1e-6&&(E[h]=1);else for(h=0;h<B;h++)w.pixels[0][h]!==M&&(E[h]=1);w.mask=E}}let C=0,O=0;if(d!==s||m!==a){let M=w.mask;if(M)for(h=0;h<a;h++)if(O=h*s,h<m)for(C=d;C<s;C++)M[O+C]=0;else for(C=0;C<s;C++)M[O+C]=0;else for(M=new Uint8Array(s*a),w.mask=M,h=0;h<m;h++)for(O=h*s,C=0;C<d;C++)M[O+C]=1}return w})()}_parseIndex(r){if(r.byteLength%16>0)throw"invalid array buffer must be multiples of 16";let e,t,n,i,s,a;if(Ht.f){for(t=new Uint8Array(r),i=new ArrayBuffer(r.byteLength),n=new Uint8Array(i),s=0;s<r.byteLength/4;s++)for(a=0;a<4;a++)n[4*s+a]=t[4*s+3-a];e=new Uint32Array(i)}else e=new Uint32Array(r);return e}_getBandSegmentCount(){return oe.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}_getTileLocation(r,e,t){const{blockWidth:n,blockHeight:i,pyramidScalingFactor:s}=this.rasterInfo.storageInfo,{width:a,height:o}=this.rasterInfo,l=this._getBandSegmentCount();let u,c,f,d=0,m=0;for(f=0;f<r;f++)m=s**f,u=Math.ceil(a/n/m),c=Math.ceil(o/i/m),d+=u*c;m=s**r,u=Math.ceil(a/n/m),c=Math.ceil(o/i/m),d+=e*u+t,d*=4*l;const p=this._storageIndex.subarray(d,d+4*l);let y=0,g=0;const h=[];for(let x=0;x<l;x++)y=p[4*x+0]*2**32+p[4*x+1],g=y+p[4*x+2]*2**32+p[4*x+3],h.push({from:y,to:g});return{ranges:h,actualTileWidth:t<u-1?n:Math.ceil(a/m)-n*(u-1),actualTileHeight:e<c-1?i:Math.ceil(o/m)-i*(c-1)}}_parseHeader(r){const e=Q(r,"MRF_META/Raster");if(!e)throw new A.Z("mrf:open","not a valid MRF format");const t=Q(e,"Size"),n=parseInt(t.getAttribute("x"),10),i=parseInt(t.getAttribute("y"),10),s=parseInt(t.getAttribute("c"),10),a=(ee(e,"Compression")||"none").toLowerCase();if(!oe.has(a))throw new A.Z("mrf:open","currently does not support compression "+a);const o=ee(e,"DataType")||"UInt8",l=ne.get(o);if(null==l)throw new A.Z("mrf:open","currently does not support pixel type "+o);const u=Q(e,"PageSize"),c=parseInt(u.getAttribute("x"),10),f=parseInt(u.getAttribute("y"),10),d=Q(e,"DataValues");let m,p;if(d&&(p=d.getAttribute("NoData"),null!=p&&(m=p.trim().split(" ").map(B=>parseFloat(B)))),Q(r,"MRF_META/CachedSource"))throw new A.Z("mrf:open","currently does not support MRF referencing other data files");const y=Q(r,"MRF_META/GeoTags"),g=Q(y,"BoundingBox");let h,x=!1;if(null!=g){const B=parseFloat(g.getAttribute("minx")),E=parseFloat(g.getAttribute("miny")),k=parseFloat(g.getAttribute("maxx")),ie=parseFloat(g.getAttribute("maxy")),U=ee(y,"Projection")||"";let V;if("LOCAL_CS[]"!==U)if(U.toLowerCase().startsWith("epsg:")){const _=Number(U.slice(5));isNaN(_)||0===_||(V=new X.Z({wkid:_}))}else V=Me(U);else x=!0,V=new X.Z({wkid:3857});h=new j.Z(B,E,k,ie),h.spatialReference=V}else x=!0,h=new j.Z({xmin:-.5,ymin:.5-i,xmax:n-.5,ymax:.5,spatialReference:new X.Z({wkid:3857})});const b=Q(r,"MRF_META/Rsets"),P=parseInt(b&&b.getAttribute("scale")||"2",10),D=h.spatialReference,T=new ve.Z({origin:new G.Z({x:h.xmin,y:h.ymax,spatialReference:D}),blockWidth:c,blockHeight:f,pyramidBlockWidth:c,pyramidBlockHeight:f,compression:a,pyramidScalingFactor:P}),w=new G.Z({x:h.width/n,y:h.height/i,spatialReference:D}),C=new de.Z({width:n,height:i,extent:h,isPseudoSpatialReference:x,spatialReference:D,bandCount:s,pixelType:l,pixelSize:w,noDataValue:m,storageInfo:T}),O=ee(r,"datafile"),M=ee(r,"IndexFile");return{rasterInfo:C,files:{mrf:this.url,index:M||this.url.replace(".mrf",".idx"),data:O||this.url.replace(".mrf",oe.get(a).blobExtension)}}}_fetchAuxiliaryData(r){var e=this;return(0,F.Z)(function*(){try{const{data:t}=yield e.request(e.url+".aux.xml",{responseType:"xml",signal:null==r?void 0:r.signal});return Ae(t)}catch(t){return null}})()}};(0,I._)([(0,R.Cb)()],pe.prototype,"_files",void 0),(0,I._)([(0,R.Cb)()],pe.prototype,"_storageIndex",void 0),(0,I._)([(0,R.Cb)({type:String,json:{write:!0}})],pe.prototype,"datasetFormat",void 0),pe=(0,I._)([(0,ae.j)("esri.layers.support.rasterIO.MRFRaster")],pe);const Lt=pe;var Se=v(93122),De=v(635);const Qe=function(r,e){const t=r.get(e);return t&&t.values},Be=function(r,e){const t=r.get(e);return t&&t.values[0]};let ce=class extends me{constructor(){super(...arguments),this._files=null,this._headerInfo=null,this._bufferSize=1048576,this.datasetFormat="TIFF"}open(r){var e=this;return(0,F.Z)(function*(){var t,n,i;yield e.init();const s=r?(0,S.Wg)(r.signal):null,{data:a}=yield e.request(e.url,{range:{from:0,to:e._bufferSize},responseType:"array-buffer",signal:s});if(!a)throw new A.Z("tiffraster:open","failed to open url "+e.url);e.datasetName=e.url.slice(e.url.lastIndexOf("/")+1);const{littleEndian:o,firstIFD:l,isBigTiff:u}=(0,Se.cK)(a),c=[];yield e._readIFDs(c,a,o,l,0,u?8:4,s);const f=(0,Se.FI)(c),{width:d,height:m,tileWidth:p,tileHeight:y,planes:g,pixelType:h,compression:x,firstPyramidLevel:b,maximumPyramidLevel:P,pyramidBlockWidth:D,pyramidBlockHeight:T,tileBoundary:w,affine:C,metadata:O}=f;let B=Me((null==(t=f.extent.spatialReference)?void 0:t.wkt)||(null==(n=f.extent.spatialReference)?void 0:n.wkid)),E=!1;null==B&&(E=!0,B=new X.Z({wkid:3857}));const k=new j.Z(Y(H({},f.extent),{spatialReference:B})),ie=new G.Z(k?{x:k.xmin,y:k.ymax,spatialReference:B}:{x:0,y:0}),U=new ve.Z({blockWidth:p,blockHeight:y,pyramidBlockWidth:D,pyramidBlockHeight:T,compression:x,origin:ie,firstPyramidLevel:b,maximumPyramidLevel:P,blockBoundary:w}),V=new G.Z({x:(k.xmax-k.xmin)/d,y:(k.ymax-k.ymin)/m,spatialReference:B}),Z=new de.Z({width:d,height:m,bandCount:g,pixelType:h,compression:x,pixelSize:V,storageInfo:U,spatialReference:B,isPseudoSpatialReference:E,keyProperties:O?{BandProperties:O.bandProperties,DataType:O.dataType}:{},extent:k,statistics:O?O.statistics:null});if(null!=C&&C.length&&(Z.nativeExtent=new j.Z({xmin:-.5,ymin:.5-m,xmax:d-.5,ymax:.5,spatialReference:B}),Z.transform=new Le.Z({polynomialOrder:1,forwardCoefficients:[C[2]+C[0]/2,C[5]-C[3]/2,C[0],C[3],-C[1],-C[4]]}),Z.extent=Z.transform.forwardTransform(Z.nativeExtent),Z.pixelSize=new G.Z({x:(k.xmax-k.xmin)/d,y:(k.ymax-k.ymin)/m,spatialReference:B}),U.origin.x=-.5,U.origin.y=.5),null==(i=e.ioConfig.skipExtensions)||!i.includes("aux.xml")){const N=yield e._fetchAuxiliaryData(r);if(null!=N){var J;if(Z.statistics=null!=(J=N.statistics)?J:Z.statistics,Z.histograms=N.histograms,N.histograms&&!(0,S.pC)(Z.statistics)&&(Z.statistics=(0,q.Oh)(N.histograms)),N.transform&&!C){Z.transform=N.transform,Z.nativeExtent=Z.extent;const te=Z.transform.forwardTransform(Z.nativeExtent);Z.pixelSize=new G.Z({x:(te.xmax-te.xmin)/d,y:(te.ymax-te.ymin)/m,spatialReference:B}),Z.extent=te}Z.spatialReference||(Z.spatialReference=N.spatialReference)}}if(e._set("rasterInfo",Z),e._headerInfo=H({littleEndian:o,isBigTiff:u,ifds:c},f),!e._headerInfo.isSupported)throw new A.Z("tiffraster:open","this tiff is not supported: "+e._headerInfo.message);e.updateTileInfo()})()}fetchRawTile(r,e,t,n={}){var i=this;return(0,F.Z)(function*(){var s;if(null==(s=i._headerInfo)||!s.isSupported||i.isBlockOutside(r,e,t))return null;const a=i._getTileLocation(r,e,t);if(!a)return null;const{ranges:o,actualTileWidth:l,actualTileHeight:u,ifd:c}=a,f=o.map(w=>i.request(i.url,{range:w,responseType:"array-buffer",signal:n.signal})),d=yield Promise.all(f),m=d.map(w=>w.data.byteLength).reduce((w,C)=>w+C),p=1===d.length?d[0].data:new ArrayBuffer(m),y=[0],g=[0];if(d.length>1){const w=new Uint8Array(p);for(let C=0,O=0;C<d.length;C++){const M=d[C].data;w.set(new Uint8Array(M),O),y[C]=O,O+=M.byteLength,g[C]=M.byteLength}}const{blockWidth:h,blockHeight:x}=i.getBlockWidthHeight(r),b=yield i.decodePixelBlock(p,{format:"tiff",customOptions:{headerInfo:i._headerInfo,ifd:c,offsets:y,sizes:g},width:h,height:x,planes:null,pixelType:null});let P,D,T;if(l!==h||u!==x){let w=b.mask;if(w)for(P=0;P<x;P++)if(T=P*h,P<u)for(D=l;D<h;D++)w[T+D]=0;else for(D=0;D<h;D++)w[T+D]=0;else for(w=new Uint8Array(h*x),b.mask=w,P=0;P<u;P++)for(T=P*h,D=0;D<l;D++)w[T+D]=1}return b})()}_readIFDs(r,e,t,n,i,s=4,a){var o=this;return(0,F.Z)(function*(){if(!n)return null;(n>=e.byteLength||n<0)&&(e=(yield o.request(o.url,{range:{from:n+i,to:n+i+o._bufferSize},responseType:"array-buffer",signal:a})).data,i=n+i,n=0);const l=yield o._readIFD(e,t,n,i,De.Z.TIFF_TAGS,s,a);if(r.push(l.ifd),!l.nextIFD)return null;yield o._readIFDs(r,e,t,l.nextIFD-i,i,s,a)})()}_readIFD(r,e,t,n,i=De.Z.TIFF_TAGS,s=4,a){var o=this;return(0,F.Z)(function*(){if(!r)return null;const l=(0,Se.vr)(r,e,t,n,i,s);if(l.success){const u=[];if(l.ifd.forEach(c=>{c.values||u.push(c)}),u.length>0){const c=u.map(d=>d.offlineOffsetSize),f=Math.min.apply(null,c.map(d=>d[0]));if(Math.min.apply(null,c.map(d=>d[0]+d[1]))-f<=o._bufferSize){const{data:d}=yield o.request(o.url,{range:{from:f,to:f+o._bufferSize},responseType:"array-buffer",signal:a});r=d,n=f,u.forEach(m=>(0,Se.Dq)(r,e,m,n))}}if(l.ifd.has("GEOKEYDIRECTORY")){const c=l.ifd.get("GEOKEYDIRECTORY"),f=c.values;if(f&&f.length>4){const d=f[0]+"."+f[1]+"."+f[2],m=yield o._readIFD(r,e,c.valueOffset+6-n,n,De.Z.GEO_KEYS,2,a);c.data=m.ifd,c.data&&c.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[d]})}}return l}return l.requiredBufferSize&&l.requiredBufferSize!==r.byteLength?(r=(yield o.request(o.url,{range:{from:n,to:n+l.requiredBufferSize+4},responseType:"array-buffer",signal:a})).data).byteLength<l.requiredBufferSize?null:o._readIFD(r,e,0,n,De.Z.TIFF_TAGS,4,a):void 0})()}_getTileLocation(r,e,t){const{firstPyramidLevel:n,blockBoundary:i}=this.rasterInfo.storageInfo,s=0===r?0:r-(n-1),a=this._headerInfo.ifds[s];if(!a)return null;const o=(0,Se.If)(a,this._headerInfo),l=Qe(a,"TILEOFFSETS");if(void 0===l)return null;const u=Qe(a,"TILEBYTECOUNTS"),{minRow:c,minCol:f,maxRow:d,maxCol:m}=i[s];if(e>d||t>m||e<c||t<f)return null;const p=Be(a,"IMAGEWIDTH"),y=Be(a,"IMAGELENGTH"),g=Be(a,"TILEWIDTH"),h=Be(a,"TILELENGTH"),x=o?this.rasterInfo.bandCount:1,b=x*e*(m+1)+t,P=[{from:l[b],to:l[b+x-1]+u[b+x-1]-1}];if(o){let w=!0;for(let C=0;C<x;C++)if(l[b+C]+u[b+C]!==l[b+C+1]){w=!1;break}if(!w)for(let C=0;C<x;C++)P[C]={from:l[b+C],to:l[b+C]+u[b+C]-1}}return null==l[b]||null==u[b]?null:{ranges:P,ifd:a,actualTileWidth:t===m?p%g:g,actualTileHeight:e===d?y%h:h}}_fetchAuxiliaryData(r){var e=this;return(0,F.Z)(function*(){try{const{data:t}=yield e.request(e.url+".aux.xml",{responseType:"xml",signal:null==r?void 0:r.signal});return Ae(t)}catch(t){return null}})()}};(0,I._)([(0,R.Cb)()],ce.prototype,"_files",void 0),(0,I._)([(0,R.Cb)()],ce.prototype,"_headerInfo",void 0),(0,I._)([(0,R.Cb)()],ce.prototype,"_bufferSize",void 0),(0,I._)([(0,R.Cb)({type:String,json:{write:!0}})],ce.prototype,"datasetFormat",void 0),ce=(0,I._)([(0,ae.j)("esri.layers.support.rasterDatasets.TIFFRaster")],ce);const zt=ce,$=new Map;$.set("CRF",{desc:"Cloud Raster Format",constructor:Tt}),$.set("MRF",{desc:"Meta Raster Format",constructor:Lt}),$.set("TIFF",{desc:"GeoTIFF",constructor:zt}),$.set("RasterTileServer",{desc:"Raster Tile Server",constructor:kt}),$.set("JPG",{desc:"JPG Raster Format",constructor:Oe}),$.set("PNG",{desc:"PNG Raster Format",constructor:Oe}),$.set("GIF",{desc:"GIF Raster Format",constructor:Oe}),$.set("BMP",{desc:"BMP Raster Format",constructor:Oe});var Nt=v(49430);let L=class extends((0,lt.h)((0,xt.M)((0,pt.q)((0,yt.I)((0,ut.N)(ht((0,vt.n)((0,gt.Q)((0,nt.R)(ot.Z)))))))))){constructor(...r){super(...r),this.bandIds=null,this.interpolation=null,this.legendEnabled=!0,this.isReference=null,this.listMode="show",this.sourceJSON=null,this.version=null,this.title=null,this.type="imagery-tile",this.operationalLayerType="ArcGISTiledImageServiceLayer",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null}normalizeCtorArgs(r,e){return"string"==typeof r?H({url:r},e):r}load(r){const e=(0,S.pC)(r)?r.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},r).catch(ye.r9).then(()=>this._openRaster(e))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){var r,e;let t=[new xe.Z({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})];const n=null==(r=this.rasterInfo)||null==(e=r.attributeTable)?void 0:e.fields;if(n){const o=n.filter(l=>"oid"!==l.type&&"value"!==l.name.toLowerCase()).map(l=>{const u=l.clone();return u.name="Raster."+l.name,u});t=t.concat(o)}const s=this.rasterInfo.dataType;if(("vector-magdir"===s||"vector-uv"===s)&&(0,S.pC)(this.rasterInfo.multidimensionalInfo)){var a;const o=null==(a=this.rasterInfo.multidimensionalInfo.variables[0].unit)?void 0:a.trim();t.push(new xe.Z({name:"Raster.Magnitude",alias:"Magnitude"+(o?` (${o})`:""),domain:null,editable:!1,type:"double"})),t.push(new xe.Z({name:"Raster.Direction",alias:"Direction (\xb0)",domain:null,editable:!1,type:"double"}))}return t}set renderer(r){this._set("renderer",r),this.updateRenderer()}readRenderer(r,e,t){const i=(0,Re.ij)(e&&e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer,t)||void 0;if(null!=i)return i}createPopupTemplate(r){return(0,Nt.eZ)({fields:this.rasterFields,title:this.title},r)}write(r,e){const{raster:t}=this;return(this.loaded?"RasterTileServer"===t.datasetFormat&&("Raster"===t.tileType||"Map"===t.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))?super.write(r,e):(e&&e.messages&&e.messages.push(new A.Z("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e.origin}/${e.layerContainerType||"operational-layers"}'`,{layer:this})),null)}_openRaster(r){var e=this;return(0,F.Z)(function*(){e.raster?(e.raster.rasterInfo||(yield e.raster.open()),e.url=e.raster.url):e.raster=yield class At{static get supportedFormats(){const e=new Set;return $.forEach((t,n)=>e.add(n)),e}static open(e){var t=this;return(0,F.Z)(function*(){const{url:n,ioConfig:i,sourceJSON:s}=e;let a=e.datasetFormat;null==a&&n.lastIndexOf(".")&&(a=n.slice(n.lastIndexOf(".")+1).toUpperCase()),"OVR"===a||"TIF"===a?a="TIFF":"JPG"!==a&&"JPEG"!==a&&"JFIF"!==a||(a="JPG"),n.toLowerCase().indexOf("/imageserver")>-1&&-1===n.toLowerCase().indexOf("/wcsserver")&&(a="RasterTileServer");const o={url:n,sourceJSON:s,datasetFormat:a,ioConfig:i||{bandIds:null,sampling:null}};let l,u;if(t.supportedFormats.has(a))return l=$.get(a).constructor,u=new l(o),yield u.open({signal:e.signal}),u;if(a)throw new A.Z("rasterfactory:open","not a supported format "+a);const c=Array.from($.keys());let f=0;const d=function(){return a=c[f++],a?(l=$.get(a).constructor,u=new l(o),u.open({signal:e.signal}).then(()=>u).catch(()=>d())):null};return d()})()}static register(e,t,n){$.has(e.toUpperCase())||$.set(e.toUpperCase(),{desc:t,constructor:n})}}.open({url:e.url,sourceJSON:e.sourceJSON,ioConfig:Y(H({sampling:"closest"},e.ioConfig),{customFetchParameters:e.customParameters}),signal:r});const{rasterInfo:t}=e.raster;if(!t)throw new A.Z("imagery-tile-layer:load","cannot load resources on "+e.url);if(e.sourceJSON=e.sourceJSON||e.raster.sourceJSON,null!=e.sourceJSON){const n="Map"===e.raster.tileType&&null!=e.sourceJSON.minLOD&&null!=e.sourceJSON.maxLOD?e.sourceJSON:Y(H({},e.sourceJSON),{minScale:0,maxScale:0});e.read(n,{origin:"service"})}null==e.title&&(e.title=e.raster.datasetName),"Map"===e.raster.tileType&&(e.popupEnabled=!1),e._configDefaultSettings(),e.watch("customParameters",n=>e.raster.ioConfig.customFetchParameters=n)})()}};(0,I._)([(0,R.Cb)({type:[it.z8],json:{write:{overridePolicy(){var r;return{enabled:!this.loaded||"Raster"===this.raster.tileType||"0,1,2"!==(null==(r=this.bandIds)?void 0:r.join(","))}}}}})],L.prototype,"bandIds",void 0),(0,I._)([(0,R.Cb)({json:{write:{overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),(0,at.J)(It.c)],L.prototype,"interpolation",void 0),(0,I._)([(0,R.Cb)({json:{write:!0}})],L.prototype,"multidimensionalDefinition",void 0),(0,I._)([(0,R.Cb)(ke.rn)],L.prototype,"legendEnabled",void 0),(0,I._)([(0,R.Cb)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],L.prototype,"isReference",void 0),(0,I._)([(0,R.Cb)({type:["show","hide"]})],L.prototype,"listMode",void 0),(0,I._)([(0,R.Cb)()],L.prototype,"sourceJSON",void 0),(0,I._)([(0,R.Cb)({readOnly:!0,json:{origins:{service:{read:{source:"currentVersion"}}}}})],L.prototype,"version",void 0),(0,I._)([(0,R.Cb)()],L.prototype,"title",void 0),(0,I._)([(0,R.Cb)({readOnly:!0,json:{read:!1}})],L.prototype,"type",void 0),(0,I._)([(0,R.Cb)({type:["ArcGISTiledImageServiceLayer"]})],L.prototype,"operationalLayerType",void 0),(0,I._)([(0,R.Cb)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(r,e)=>!e.disablePopup},write:{target:"disablePopup",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer(r,e,t){e[t]=!r}}}})],L.prototype,"popupEnabled",void 0),(0,I._)([(0,R.Cb)({type:rt.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],L.prototype,"popupTemplate",void 0),(0,I._)([(0,R.Cb)({readOnly:!0})],L.prototype,"defaultPopupTemplate",null),(0,I._)([(0,R.Cb)({readOnly:!0,type:[xe.Z]})],L.prototype,"fields",void 0),(0,I._)([(0,R.Cb)({readOnly:!0,type:[xe.Z]})],L.prototype,"rasterFields",null),(0,I._)([(0,R.Cb)({types:Re.dr,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy(){var r;const e="raster-stretch"===(null==(r=this.renderer)?void 0:r.type)&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!e}}},origins:{"web-scene":{types:Re.FK,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:r=>({enabled:r&&"vector-field"!==r.type&&"flow"!==r.type})}}}}})],L.prototype,"renderer",null),(0,I._)([(0,st.r)("renderer")],L.prototype,"readRenderer",null),L=(0,I._)([(0,ae.j)("esri.layers.ImageryTileLayer")],L);const Jt=L}}]);