"use strict";var $e=Object.defineProperty,qe=Object.defineProperties,ti=Object.getOwnPropertyDescriptors,Ee=Object.getOwnPropertySymbols,ei=Object.prototype.hasOwnProperty,ii=Object.prototype.propertyIsEnumerable,Ie=(Tt,dt,d)=>dt in Tt?$e(Tt,dt,{enumerable:!0,configurable:!0,writable:!0,value:d}):Tt[dt]=d,qt=(Tt,dt)=>{for(var d in dt||(dt={}))ei.call(dt,d)&&Ie(Tt,d,dt[d]);if(Ee)for(var d of Ee(dt))ii.call(dt,d)&&Ie(Tt,d,dt[d]);return Tt},te=(Tt,dt)=>qe(Tt,ti(dt));(self.webpackChunkesri4_pwa=self.webpackChunkesri4_pwa||[]).push([[1619],{25293:(Tt,dt,d)=>{d.d(dt,{i:()=>ct});var Y=d(72283),ot=d(11004);class ct{static getPlacement(B,Q,J,A){const k=(0,ot.W)(Q);if(!k)return null;const H=(0,Y.GP)(B);return k.execute(H,Q,J,A)}}},55130:(Tt,dt,d)=>{d.d(dt,{_:()=>vt}),d(17083),d(9598);var ct=d(58098),Q=(d(8480),d(79527),d(39351)),J=d(99666),A=d(39406),k=d(64288);const H=new Map;H.set(A.LW.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),H.set(A.LW.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),H.set(A.LW.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),H.set(A.LW.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),H.set(A.LW.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var g=d(75734);class S{constructor(E,N,nt){this._start={index:0,vertex:0};const U=function Et(yt,E,N){const{indicesPerRecord:nt,multiplier:U,verticesPerRecord:at}=H.get(yt);return{recordBytes:N*Q.XJ*Uint32Array.BYTES_PER_ELEMENT,indexBytes:U*nt*N*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:U*at*N*E}}(E,N,nt),at=N/4;this.geometryType=E,this._records=new g.Z(Int32Array,U.recordBytes),this._indices=new g.Z(Uint32Array,U.indexBytes),this._vertices=new g.Z(Uint32Array,U.vertexBytes),this._metrics=new g.Z(Float32Array,0),this._strideInt=at}serialize(E){const N=this._records.buffer(),nt=this._indices.buffer(),U=this._vertices.buffer(),at=this._metrics.length?this._metrics.buffer():null,mt=4*this._strideInt;return E.push(N,nt,U),{stride:mt,records:N,indices:nt,vertices:U,metrics:at}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/Q.XJ}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(E){this._vertices.ensureSize(E)}indexEnsureSize(E){this._indices.ensureSize(E)}recordStart(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}recordEnd(E,N,nt,U,at,mt,Lt,gt){this._records.push(E),this._records.push(N),this._records.push(nt),this._records.push(U),this._records.push(at),this._records.push(mt),this._records.push(Lt),this._records.writeF32(gt)}writeIndex(E){this._indices.push(E)}writeVertex(E){this._vertices.push(E)}writeVertexF32(E){this._vertices.writeF32(E)}copyLastFrom(E,N,nt){const U=E._records.length-Q.XJ,at=E._records.getValue(U),mt=E._records.getValue(U+1),Lt=E._records.getValue(U+2),gt=E._records.getValue(U+4),ft=E._records.getValue(U+6),Ot=E._records.getValue(U+7),St=this._vertices.length,Kt=(E._start.vertex-this._vertices.length)/this._strideInt,Bt=this._indices.length,Jt=this.vertexCount;for(let w=E._start.index;w!==E._indices.length;w++){const h=E._indices.getValue(w);this._indices.push(h-Kt)}for(let w=E._start.vertex;w!==E._vertices.length;w++){const h=E._vertices.getValue(w);this._vertices.push(h)}for(let w=St;w<=this._vertices.length;w+=this._strideInt)this._vertices.i1616Add(w,N,nt);this._records.push(at),this._records.push(mt),this._records.push(Lt),this._records.push(Bt),this._records.push(gt),this._records.push(Jt),this._records.push(ft),this._records.push(Ot)}}var l=d(55376);function R(yt){switch(yt){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function rt(yt){switch(yt){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class vt{constructor(E,N,nt,U,at){this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=N,this.tileKey=E,this._hasAggregate=U,this._pixelBufferEnabled=at,this._strideOptions=nt}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(E){const N=[];return N.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((nt,U)=>{const at=1<<U,mt=R(at),Lt=rt(at),gt=(0,l.M)(new ct.Z(this.tileKey),mt,Lt,E),ft=this._serializeTileVertexData(this.tileKey,gt.id,nt.vertexData);ft.message.bufferIds=nt.displayIds,N.push(ft)}),N}_serializeTileVertexData(E,N,nt){var U,at,mt,Lt,gt;const ft=new Array;return{message:{tileKeyOrigin:E,tileKey:N,data:{[A.LW.MARKER]:null==(U=nt.get(A.LW.MARKER))?void 0:U.serialize(ft),[A.LW.FILL]:null==(at=nt.get(A.LW.FILL))?void 0:at.serialize(ft),[A.LW.LINE]:null==(mt=nt.get(A.LW.LINE))?void 0:mt.serialize(ft),[A.LW.TEXT]:null==(Lt=nt.get(A.LW.TEXT))?void 0:Lt.serialize(ft),[A.LW.LABEL]:null==(gt=nt.get(A.LW.LABEL))?void 0:gt.serialize(ft)}},transferList:ft}}featureStart(E,N){this._current.insertAfter=E,this._current.sortKey=N}featureEnd(){}recordStart(E,N,nt,U){this._current.writer=this._getVertexWriter(nt),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=U,this._current.id=E,this._current.materialKey=N,this._current.geometryType=nt,this._current.isDotDensity=!1,this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(E){this._current.writer.vertexEnsureSize(E)}indexEnsureSize(E){this._current.writer.indexEnsureSize(E)}vertexBounds(E,N,nt,U){this._current.bufferingEnabled&&this._addOverlap(E,N,nt,U)}vertexWrite(E){this._current.writer.writeVertex(E)}vertexWriteF32(E){this._current.writer.writeVertexF32(E)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(E){this._current.writer.writeIndex(E)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(E,N,nt,U,at,mt,Lt,gt){this._current.writer=this._getVertexWriter(A.LW.LABEL);const ft=this._current.writer.metricWriter;ft.push((0,J.jL)(E)),ft.push(N),ft.push(nt),ft.push(U),ft.push(at),ft.push(mt),ft.push(Lt),ft.push(gt),ft.push(255),this._current.metricBoxLenPointer=ft.push(0)}metricEnd(){const E=this._current.writer.metricWriter;0===E.getValue(this._current.metricBoxLenPointer)&&E.seek(E.length-10)}metricBoxWrite(E,N,nt,U){const at=this._current.writer.metricWriter;at.incr(this._current.metricBoxLenPointer),at.push(0),at.push(0),at.push(E),at.push(N),at.push(nt),at.push(U)}recordEnd(){const E=this._current.vertStart,N=this._current.writer.vertexCount-E;if(!N)return!1;this.hasRecords=!0;const nt=this._current.indexStart;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,nt,this._current.writer.indexCount-nt,E,N,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===A.LW.LABEL)return!0;const at=this._current.writer;for(let mt=0;mt<8;mt++){const Lt=1<<mt;if(this._current.overlaps&Lt){this._data.neighbors[mt]||(this._data.neighbors[mt]={vertexData:new Map,displayIds:new Set});const gt=this._data.neighbors[mt],ft=this._current.geometryType;if(!gt.vertexData.has(ft)){const Jt=(0,k.$_)(ft,this._strideOptions).geometry,w=new S(ft,Jt,Q.Ip);gt.vertexData.set(ft,w)}const Ot=gt.vertexData.get(this._current.geometryType),St=8,Kt=512*-R(Lt)*St,Bt=512*-rt(Lt)*St;Ot.copyLastFrom(at,Kt,Bt),gt.displayIds.add(this._current.id)}}return!0}_addOverlap(E,N,nt,U){this._current.overlaps|=255^((E<0+nt?148:E>=Q.I_-nt?41:189)|(N<0+U?224:N>=Q.I_-U?7:231))}_getVertexWriter(E){if(!this._data.self.has(E)){const N=this._data.self,nt=(0,k.$_)(E,this._strideOptions).geometry;N.set(E,new S(E,nt,this.hint.records))}return this._data.self.get(E)}}},246:(Tt,dt,d)=>{d.d(dt,{j:()=>Jt});var Y=d(15861),ct=(d(8314),d(62208)),F=d(10699),B=d(58774),Q=d(99666),J=d(26584),A=d(63290),k=d(21286),H=d(23841),V=d(7547),Et=d(61261),g=d(81295),S=d(39351),l=d(39406),x=d(5254),K=d(18716),et=d(50114);function D(w){return w.length-1}function y(w,h,m=1){const[p,I]=function it(w,h){return w[h+1]}(w,h);return Math.sqrt(p*p+I*I)*m}class W{constructor(h,m,p,I,b){this._segments=h,this._index=m,this._distance=p,this._xStart=I,this._yStart=b,this._done=!1}static create(h){return new W(h,0,0,h[0][0],h[0][1])}clone(){return new W(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(h){return this._index===h._index||h._index===this._index-1&&(0===this._distance||1===h._distance)||h._index===this._index+1&&(1===this._distance||0===h._distance)}leq(h){return this._index<h._index||this._index===h._index&&this._distance<=h._distance}geq(h){return this._index>h._index||this._index===h._index&&this._distance>=h._distance}get _segment(){return this._segments[this._index+1]}get angle(){const h=this.dy;let p=Math.acos((0*h+-1*-this.dx)/(1*this.length));return h>0&&(p=2*Math.PI-p),p}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:h,dy:m}=this;return Math.sqrt(h*h+m*m)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<D(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(h,m){const p=this.backwardLength;if(h<=p)return this._distance=(p-h)/this.length,this;let I=this.backwardLength;for(;this.prev();){if(I+this.length>h)return this._seekBackwards(h-I);I+=this.length}return this._distance=0,m?this:null}seek(h,m=!1){if(h<0)return this._seekBackwards(Math.abs(h),m);if(h<=this.remainingLength)return this._distance=(this.backwardLength+h)/this.length,this;let p=this.remainingLength;for(;this.next();){if(p+this.length>h)return this.seek(h-p,m);p+=this.length}return this._distance=1,m?this:null}}function R(w,h,m,p=!0){const I=function G(w){let h=0;for(let m=0;m<D(w);m++)h+=y(w,m);return h}(w),b=W.create(w),O=I/2;if(!p)return b.seek(O),void m(b.clone(),0,O+0*h,I);const X=Math.max((I-h)/2,0),$=Math.floor(X/h);b.seek(O-$*h);for(let _t=-$;_t<=$;_t++)b.x<512&&b.x>=0&&b.y<512&&b.y>=0&&m(b.clone(),_t,O+_t*h,I),b.seek(h)}function lt(w,h){if(h<=0)return;const p=w.length;if(p<3)return;const I=[];let b=0;I.push(0);for(let Z=1;Z<p;Z++)b+=(0,et.TK)(w[Z],w[Z-1]),I.push(b);h=Math.min(h,.2*b);const O=[];O.push(w[0][0]),O.push(w[0][1]);const X=w[p-1][0],$=w[p-1][1],ht=(0,et.lu)([0,0],w[0],w[1]);(0,et.Fv)(ht),w[0][0]+=h*ht[0],w[0][1]+=h*ht[1],(0,et.lu)(ht,w[p-1],w[p-2]),(0,et.Fv)(ht),w[p-1][0]+=h*ht[0],w[p-1][1]+=h*ht[1];for(let Z=1;Z<p;Z++)I[Z]+=h;I[p-1]+=h;const _t=.5*h;for(let Z=1;Z<p-1;Z++){let Mt=0,Pt=0,Vt=0;for(let pt=Z-1;pt>=0&&!(I[pt+1]<I[Z]-_t);pt--){const zt=_t+I[pt+1]-I[Z],Wt=I[pt+1]-I[pt],It=I[Z]-I[pt]<_t?1:zt/Wt;if(Math.abs(It)<1e-6)break;const Ft=It*It,At=It*zt-.5*Ft*Wt,Gt=It*Wt/h,bt=w[pt+1],wt=w[pt][0]-bt[0],Ht=w[pt][1]-bt[1];Mt+=Gt/At*(bt[0]*It*zt+.5*Ft*(zt*wt-Wt*bt[0])-Ft*It*Wt*wt/3),Pt+=Gt/At*(bt[1]*It*zt+.5*Ft*(zt*Ht-Wt*bt[1])-Ft*It*Wt*Ht/3),Vt+=Gt}for(let pt=Z+1;pt<p&&!(I[pt-1]>I[Z]+_t);pt++){const zt=_t-I[pt-1]+I[Z],Wt=I[pt]-I[pt-1],It=I[pt]-I[Z]<_t?1:zt/Wt;if(Math.abs(It)<1e-6)break;const Ft=It*It,At=It*zt-.5*Ft*Wt,Gt=It*Wt/h,bt=w[pt-1],wt=w[pt][0]-bt[0],Ht=w[pt][1]-bt[1];Mt+=Gt/At*(bt[0]*It*zt+.5*Ft*(zt*wt-Wt*bt[0])-Ft*It*Wt*wt/3),Pt+=Gt/At*(bt[1]*It*zt+.5*Ft*(zt*Ht-Wt*bt[1])-Ft*It*Wt*Ht/3),Vt+=Gt}O.push(Mt/Vt),O.push(Pt/Vt)}O.push(X),O.push($);for(let Z=0,Mt=0;Z<p;Z++)w[Z][0]=O[Mt++],w[Z][1]=O[Mt++]}var ut=d(51919);const vt=A.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),Lt=function mt(w){const h=new Map;return m=>(h.has(m)||h.set(m,w(m)),h.get(m))}(w=>{let h=0;if(0===w)return 1/0;for(;!(w%2);)h++,w/=2;return h}),gt=w=>Math.floor(127*w+127),ft=w=>Math.floor(10*w),Ot=w=>Math.round(w*(254/360));class St extends ut.Z{constructor(h,m,p,I){var b,O,X;super(h,p.font.size,p.haloSize||0,p.font.size,p.color&&(0,g.aH)(p.color)||0,p.haloColor&&(0,g.aH)(p.haloColor)||0,p.horizontalAlignment,p.verticalAlignment,(0,Et.NS)(m.labelPlacement)?V.v2.MAP:V.v2.SCREEN,p.font.decoration,!1,p.angle||0,p.xoffset,p.yoffset,p.lineWidth,p.lineHeight,null,null,null,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this._zoomLevel=0,this.geometryType=l.LW.LABEL,this._allowOverrun=null!=(b=m.allowOverrun)&&b,this._repeatLabel=null==(O=m.repeatLabel)||O,this._labelPosition=null!=(X=m.labelPosition)?X:"curved";const $=function U(w,h){const m=!!w.minScale&&h.scaleToZoom(w.minScale)||0;return(0,k.uZ)(m,0,25.5)}(m,I),ht=function at(w,h){const m=!!w.maxScale&&h.scaleToZoom(w.maxScale)||255;return(0,k.uZ)(m,0,25.5)}(m,I),_t=m.labelPlacement,[Z,Mt]=(0,Et.qv)(_t);this._xAlignD=Z,this._yAlignD=Mt,this._minZoom=$,this._maxZoom=ht,this._refPlacementPadding=(0,H.F2)(p.haloSize)+S.Iw,this._repeatLabelDistance=m.repeatLabelDistance?(0,H.F2)(m.repeatLabelDistance):128;const Pt=K.Gq.load(h);Pt.sdf=!0,this._materialKey=Pt.data}static fromLabelClass(h,m){if("esriServerLinePlacementCenterAlong"===h.labelPlacement){const p=h.symbol;p.xoffset=0,p.yoffset=0,p.angle=0,p.font.decoration="none"}return new St(h.materialKey,h,h.symbol,m)}get _shapedBox(){return(0,ct.Wg)(this._shapingInfo).bounds}setZoomLevel(h){this._zoomLevel=h}bindReferenceTemplate(h){let m=(0,Et.g)(this._xAlignD),p=(0,Et.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,ct.Wi)(h))return void(this._refSymbolAndPlacementOffset=(0,x.Jz)(0,0,gt(m),gt(p)));if("circle"===h.boundsType&&(m||p)){const O=Math.sqrt(m*m+p*p);m/=O,p/=O}const I=Math.max(h.height,h.width);this._refSymbolAndPlacementOffset=(0,x.Jz)(4*this._refPlacementPadding,I,gt(m),gt(p)),this._referenceSize=I,this._refPlacementDirX=m,this._refPlacementDirY=p,this._refOffsetX=h.xOffset,this._refOffsetY=h.yOffset}_write(h,m){if((0,ct.Wi)(this._shapingInfo))return;const p=this._shapingInfo,I=m.getDisplayId(),b="esriGeometryPolygon"===m.geometryType?m.readLegacyCentroid():m.readLegacyGeometry();if(b)switch(this.current={out:h,inId:I,inShaping:p,zoomLevel:this._zoomLevel},m.geometryType){case"esriGeometryPolyline":this._placeLineLabels(b);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(b);break;default:((w,h="mapview-labeling")=>{vt.error(new J.Z(h,"mapview-labeling"))})(0,`Geometry of type ${m.geometryType} is not supported`)}}_isVisible(h,m){const p=ft(this.current.zoomLevel);return ft(h)<=p&&p<=ft(m)}_placePointLabels(h){const{out:m,inId:p,inShaping:I}=this.current;this._writeGlyphs(m,p,h,I)}_placeLineLabels(h){const m=function j(w,h){const m=h;for(let p=0;p<w.length;p++){let I=w[p];const b=[];b.push(I[0]);for(let X=1;X<I.length;X++){let[$,ht]=b[X-1];$+=I[X][0],ht+=I[X][1],b.push([$,ht])}lt(b,m);const O=[];O.push(b[0]);for(let X=1;X<b.length;X++){const[$,ht]=b[X-1],[_t,Z]=b[X],Mt=Math.round(_t-$),Pt=Math.round(Z-ht);O.push([Mt,Pt])}w[p]=O,I=O}return w}(h.paths,this.current.inShaping.bounds.width),p=this._placeSubdivGlyphs.bind(this),I=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const b of m)R(b,I,p,this._repeatLabel)}_placeSubdivGlyphs(h,m,p,I){const b=Lt(m),O=this._shapedBox.width/2,X=Math.sqrt(this._repeatLabelDistance)/2,$=Math.min(p,I-p),ht=Math.log2($/(X+O/2)),_t=0===m?ht:Math.min(b,ht),Z=Math.max(this._minZoom,this.current.zoomLevel+1-_t),Mt=this.current.zoomLevel-Z,Pt=this._shapedBox.width/2*2**Mt;this.current.inShaping.isMultiline?0===m&&this._placeStraight(h,Z):this._allowOverrun&&Mt<0?this._placeStraightAlong(h,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(h,Z):"curved"===this._labelPosition&&this._placeCurved(h,Z,Pt)}_placeStraight(h,m){const{out:p,inId:I,inShaping:b}=this.current;this._writeGlyphs(p,I,h,b,m)}_placeCurved(h,m,p){const{out:I,inId:b}=this.current;I.metricStart(b,m,h.x,h.y,0,0,0,0);const O=h.clone(),X=h.angle*(180/Math.PI)%360,$=(h.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Ot(X),this._placeFirst(O,m,1),this._placeBack(h,O,m,p,1),this._placeForward(h,O,m,p,1),this._outLineLabelAngle=Ot($),this._placeFirst(O,m,0),this._placeBack(h,O,m,p,0),this._placeForward(h,O,m,p,0),I.metricEnd()}_placeStraightAlong(h,m){const{out:p,inId:I}=this.current;p.metricStart(I,m,h.x,h.y,0,0,0,0);const b=h.clone(),O=h.angle*(180/Math.PI)%360,X=(h.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Ot(O),this._placeFirst(b,m,1,!0),this._outLineLabelAngle=Ot(X),this._placeFirst(b,m,0,!0),p.metricEnd()}_placeBack(h,m,p,I,b){const O=h.clone();let X=h.backwardLength+0;for(;O.prev()&&!(X>=I);)this._placeOnSegment(O,m,X,p,-1,b),X+=O.length+0}_placeForward(h,m,p,I,b){const O=h.clone();let X=h.remainingLength+0;for(;O.next()&&!(X>=I);)this._placeOnSegment(O,m,X,p,1,b),X+=O.length+0}_placeFirst(h,m,p,I=!1){const b=h,O=this.current.inShaping,X=O.glyphs,$=this.current.zoomLevel,{out:ht,inId:_t}=this.current;for(const Z of X){const Mt=Z.x>O.bounds.x?p:1-p,Pt=Mt*h.remainingLength+(1-Mt)*h.backwardLength,Vt=Math.abs(Z.x+Z.width/2-O.bounds.x),pt=Math.max(0,$+Math.log2(Vt/(Pt+0))),zt=Math.max(m,I?0:pt);if(Z.maxZoom=25,Z.angle=h.angle+(1-p)*Math.PI,Z.minZoom=zt,this._writeGlyph(ht,_t,b.x,b.y,Z),p&&this._isVisible(Z.minZoom,Z.maxZoom)){const Wt=Z.bounds;ht.metricBoxWrite(Wt.center[0],Wt.center[1],Wt.width,Wt.height)}}}_placeOnSegment(h,m,p,I,b,O){const X=this.current.inShaping.glyphs,{out:$,inId:ht}=this.current,_t=this.current.inShaping,Z=this.current.zoomLevel,Vt={x:h.x+p*-b*(h.dx/h.length),y:h.y+p*-b*(h.dy/h.length)};for(const pt of X){const zt=pt.x>_t.bounds.x?O:1-O;if(!(zt&&1===b||!zt&&-1===b))continue;const Wt=Math.abs(pt.x+pt.width/2-_t.bounds.x),It=Math.max(0,Z+Math.log2(Wt/p)-.1),Ft=Math.max(I,Z+Math.log2(Wt/(p+h.length+0)));if(0!==It&&(pt.angle=h.angle+(1-O)*Math.PI,pt.minZoom=Ft,pt.maxZoom=It,this._writeGlyph($,ht,Vt.x,Vt.y,pt),O&&this._isVisible(pt.minZoom,pt.maxZoom))){const At=pt.bounds;$.metricBoxWrite(At.center[0]+(h.x-m.x),At.center[1]+(h.y-m.y),At.width,At.height)}}}_writeGlyphs(h,m,p,I,b=this._minZoom){if(p.x<0||p.x>=512||p.y<0||p.y>=512)return;const O=p.x+this._refOffsetX,X=p.y-this._refOffsetY;for(const Z of I.glyphs)Z.minZoom=b,Z.maxZoom=this._maxZoom,this._writeGlyph(h,m,O,X,Z);const _t=I.boundsT;h.metricStart(m,b,O,X,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey),h.metricBoxWrite(_t.center[0],_t.center[1],_t.width,_t.height),h.metricEnd()}_writeVertexCommon(h,m,p,I){const b=this._color,O=this._haloColor,X=(0,x.Jz)(0,0,this._size,this._haloSize),$=Math.max(I.minZoom,this._minZoom),ht=Math.min(I.maxZoom,this._maxZoom),_t=(0,x.Jz)(ft($),ft(ht),this._outLineLabelAngle,0);h.vertexWrite(p),h.vertexWrite(m),h.vertexWrite(b),h.vertexWrite(O),h.vertexWrite(X),h.vertexWrite(this._refSymbolAndPlacementOffset),h.vertexWrite(_t)}}var Kt=d(18752),Bt=d(1825);class Jt{constructor(h,m,p){this._loadPromise=(0,B.j)(),this._geometryType=h,this._idField=m,this._templateStore=p}update(h,m){(0,ct.pC)(h.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(h.mesh.labels,m)),this._schema=h}_createLabelTemplates(h,m){const p=new Map;if("simple"===h.type){for(const I of h.classes){const b=St.fromLabelClass(I,m);p.set(I.index,b)}return p}for(const I in h.classes){const b=h.classes[I];for(const O of b){const X=St.fromLabelClass(O,m);p.set(O.index,X)}}return p}get templates(){return this._templateStore}analyze(h,m,p,I,b,O,X){var $=this;return(0,Y.Z)(function*(){if((0,F.Hc)(X))return;let ht;"dictionary"===p.type&&(ht=yield p.analyze($._idField,h.copy(),m,b,O,X));let _t=0;for(;h.next();){let Z;if(Z=ht?ht[_t++]:(0,ct.pC)(I)&&(0,Q.nE)(h.getDisplayId())&&1!==h.readAttribute("cluster_count")?I.match($._idField,h,$._geometryType,b,O):p.match($._idField,h,$._geometryType,b,O),h.setGroupId(Z),(0,Bt.Sl)(Z)){const Mt=$._templateStore.getDynamicTemplateGroup(Z);for(const Pt of Mt)Pt&&Pt.analyze&&Pt.analyze($._templateStore,h,b,O)}}return yield $._loadPromise,$._templateStore.finalize(X)})()}analyzeGraphics(h,m,p,I,b,O){var X=this;return(0,Y.Z)(function*(){if((0,F.Hc)(O))return;const $=h.getCursor();for(p&&(yield p.analyze(X._idField,$.copy(),m,I,b,O));$.next();){let ht=$.getGroupId();if(null!=ht&&-1!==ht||(ht=p.match(X._idField,$,$.geometryType,I,b),$.setGroupId(ht)),(0,Bt.Sl)(ht)){const _t=X._templateStore.getDynamicTemplateGroup(ht);for(const Z of _t)Z&&Z.analyze&&Z.analyze(X._templateStore,$,I,b)}$.setGroupId(ht)}return yield X._loadPromise,X._templateStore.finalize(O)})()}writeGraphic(h,m,p,I){const b=m.getGroupId(),O=m.getDisplayId(),X=this._templateStore.getTemplateGroup(b);if(h.featureStart(m.insertAfter,0),null!=O){if((0,Bt.Sl)(b))for(const $ of X)$&&$.bindFeature(m,null,null);if(X){for(const $ of X)$&&$.write(h,m,p,I);h.featureEnd()}}}writeCursor(h,m,p,I,b,O,X){const $=m.getGroupId(),ht=m.getDisplayId(),_t=this._templateStore.getTemplateGroup($),Z=this._schema.mesh.sortKey;let Mt=0;if((0,ct.pC)(Z)&&(Mt=null!=Z.fieldIndex?m.getComputedNumericAtIndex(Z.fieldIndex):m.readAttribute(null!=Z.field?Z.field:this._idField),Mt*="asc"===Z.order?1:-1),h.featureStart(0,null==Mt||isNaN(Mt)?0:Mt),null!=ht&&_t){if((0,Bt.Sl)($))for(const Pt of _t)Pt.bindFeature(m,p,I);for(const Pt of _t)Pt.write(h,m,b,X);if((0,ct.pC)(O)&&h.hasRecords){const Pt=O&&this._findLabelRef(_t);this._writeLabels(h,m,O,Pt,b,X)}h.featureEnd()}}_findLabelRef(h){for(const m of h)if(m instanceof Kt.Z)return m;return null}_writeLabels(h,m,p,I,b,O){for(const X of p)if((0,ct.pC)(X)&&X){const{glyphs:$,rtl:ht,index:_t}=X,Z=this._labelTemplates.get(_t);Z.setZoomLevel(b),Z.bindReferenceTemplate(I),Z.bindTextInfo($,ht),Z.write(h,m,null,O)}}}},88337:(Tt,dt,d)=>{d.d(dt,{Z:()=>g});var Y=d(62208),ot=d(23841),ct=d(31478),F=d(12225),B=d(67831),Q=d(9545),J=d(82054),A=d(25293),k=d(39406),H=d(5254);const V=3.14159265359/180,g=S=>class extends S{constructor(...l){super(...l),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},this.geometryType=k.LW.MARKER}_write(l,x,K,et){const it=x.getDisplayId();l.recordStart(it,this._materialKey,this.geometryType,!0),this._writeGeometry(l,x,it,K,et),l.recordEnd()}_writeGeometry(l,x,K,et,it){if((0,Y.pC)(this._markerPlacement))return this._writePlacedMarkers(l,x,et,it);const D=it?(0,J.oB)((0,J.GH)(it),2):"esriGeometryPolygon"===x.geometryType?x.readCentroid():x.readGeometryForDisplay();if(!(0,Y.Wi)(D)){if(D.isPoint){const[G,y]=D.coords;return!l.hasAggregates&&l.hasPixelBufferEnabled&&(G<0||G>=512||y<0||y>=512)?void 0:this._writeVertices(l,K,this._getPos(G,y),G,y)}D.forEachVertex((G,y)=>this._writeVertices(l,K,this._getPos(G,y),G,y))}}_writePlacedMarkers(l,x,K,et){const it=null!=et?et:x.readLegacyGeometryForDisplay(),D=A.i.getPlacement(it,(0,Y.Wg)(this._markerPlacement),(0,ot.F2)(1),K.geometryEngine);if(!D)return;const G=x.getDisplayId(),y=(0,Q.c)(),W=(0,F.c)();let st=D.next();for(;null!=st;){const j=st.tx,lt=-st.ty;j>=-128&&j<=640&&lt>=-128&&lt<=640&&(this._applyTransformation(W,y,-st.getAngle()/V),this._writeVertices(l,G,this._getPos(j,lt),j,lt)),st=D.next()}}_writeVertices(l,x,K,et,it){const D=l.vertexCount();l.vertexBounds(et+this.xOffset,it-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY),l.vertexWrite(K),l.vertexWrite(this._offsetUpperLeft),l.vertexWrite(this._texUpperLeft),l.vertexWrite(this._bitestAndDistRatio),l.vertexWrite(x),l.vertexWrite(this._fillColor),l.vertexWrite(this._outlineColor),l.vertexWrite(this._sizeOutlineWidth),l.vertexWrite(this._minMaxZoom),l.vertexEnd(),l.vertexWrite(K),l.vertexWrite(this._offsetUpperRight),l.vertexWrite(this._texUpperRight),l.vertexWrite(this._bitestAndDistRatio),l.vertexWrite(x),l.vertexWrite(this._fillColor),l.vertexWrite(this._outlineColor),l.vertexWrite(this._sizeOutlineWidth),l.vertexWrite(this._minMaxZoom),l.vertexEnd(),l.vertexWrite(K),l.vertexWrite(this._offsetBottomLeft),l.vertexWrite(this._texBottomLeft),l.vertexWrite(this._bitestAndDistRatio),l.vertexWrite(x),l.vertexWrite(this._fillColor),l.vertexWrite(this._outlineColor),l.vertexWrite(this._sizeOutlineWidth),l.vertexWrite(this._minMaxZoom),l.vertexEnd(),l.vertexWrite(K),l.vertexWrite(this._offsetBottomRight),l.vertexWrite(this._texBottomRight),l.vertexWrite(this._bitestAndDistRatio),l.vertexWrite(x),l.vertexWrite(this._fillColor),l.vertexWrite(this._outlineColor),l.vertexWrite(this._sizeOutlineWidth),l.vertexWrite(this._minMaxZoom),l.vertexEnd(),l.indexWrite(D+0),l.indexWrite(D+1),l.indexWrite(D+2),l.indexWrite(D+1),l.indexWrite(D+3),l.indexWrite(D+2)}_applyTransformation(l,x,K=0){(0,ct.a)(l,(0,Q.f)(this.xOffset,-this.yOffset)),this.angle+K!==0&&(0,ct.r)(l,l,V*(this.angle+K));const et=this._computedWidth,it=this._computedHeight,D=(this._anchorX-.5)*et,G=(this._anchorY-.5)*it;(0,B.s)(x,D,G),(0,B.t)(x,x,l),this._offsetUpperLeft=(0,H.UJ)(16*x[0],16*x[1]),this._offsets.xUpperLeft=x[0],this._offsets.yUpperLeft=x[1],(0,B.s)(x,D+et,G),(0,B.t)(x,x,l),this._offsetUpperRight=(0,H.UJ)(16*x[0],16*x[1]),this._offsets.xUpperRight=x[0],this._offsets.yUpperRight=x[1],(0,B.s)(x,D,G+it),(0,B.t)(x,x,l),this._offsetBottomLeft=(0,H.UJ)(16*x[0],16*x[1]),this._offsets.xBottomLeft=x[0],this._offsets.yBottomLeft=x[1],(0,B.s)(x,D+et,G+it),(0,B.t)(x,x,l),this._offsetBottomRight=(0,H.UJ)(16*x[0],16*x[1]),this._offsets.xBottomRight=x[0],this._offsets.yBottomRight=x[1]}_getPos(l,x){return(0,H.UJ)(Math.round(8*l),Math.round(8*x))}}},44526:(Tt,dt,d)=>{d.d(dt,{Z:()=>V});var Y=d(62208),ot=d(23841),ct=d(82054),F=d(25293),B=d(39351),Q=d(39406),J=d(5254),A=d(18716),k=d(25797);const V=Et=>class extends Et{constructor(...g){super(...g),this._isCIM=!1,this._vertexBoundsScale=1,this.geometryType=Q.LW.TEXT,this._aux=(0,J.Jz)(0,0,this._referenceSize,this._bitset)}bindTextInfo(g,S){this._shapingInfo=g&&g.length?(0,Y.yw)(g,l=>(0,k.Nr)(l,S,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:B.xm*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM})):null}_write(g,S,l,x){const K=S.getDisplayId();this._writeGeometry(g,S,K,l,x)}_writeGeometry(g,S,l,x,K){const et=this._shapingInfo;if((0,Y.Wi)(et))return;if((0,Y.pC)(this._textPlacement)){const D=null!=K?K:S.readLegacyGeometryForDisplay();return this._writePlacedText(g,l,D,et,x)}const it=K?(0,ct.oB)((0,ct.GH)(K),2):"esriGeometryPolygon"===S.geometryType?S.readCentroid():S.readGeometryForDisplay();if(!(0,Y.Wi)(it)){if(it.isPoint){const[D,G]=it.coords;return!g.hasAggregates&&g.hasPixelBufferEnabled&&(D<0||D>=512||G<0||G>=512)?void 0:this._writeGlyphs(g,l,{x:D,y:G},et)}it.forEachVertex((D,G)=>this._writeGlyphs(g,l,{x:D,y:G},et))}}_writePlacedText(g,S,l,x,K){const et=(0,Y.Wg)(this._textPlacement),it=F.i.getPlacement(l,et,(0,ot.F2)(1),K.geometryEngine);if(!it)return;let D=it.next();for(;null!=D;){const G=-D.getAngle();x.setRotation(G);const y=D.tx,W=-D.ty;y<0||y>=512||W<0||W>=512||(this._writeGlyphs(g,S,{x:y,y:W},x),x.setRotation(-G)),D=it.next()}}_writeGlyphs(g,S,l,x){const K=A.m2.load(this._materialKey),et=(0,J.UJ)(Math.round(8*l.x),Math.round(8*l.y)),it=this._vertexBoundsScale,D=x.bounds,G=2*Math.max(D.width,D.height);for(const y of x.glyphs)K.textureBinding=y.textureBinding,g.recordStart(S,K.data,this.geometryType,!0),g.vertexBounds(l.x+D.x+this._xOffset,l.y+D.y-this._yOffset,G*it,G*it),this._writeVertices(g,S,et,y),g.recordEnd()}_writeGlyph(g,S,l,x,K){const et=A.m2.load(this._materialKey),it=(0,J.UJ)(Math.round(8*l),Math.round(8*x));et.textureBinding=K.textureBinding,g.recordStart(S,et.data,this.geometryType,!0);const D=K.bounds,G=this._vertexBoundsScale;g.vertexBounds(l+D.x*G,x+D.y*G,D.width*G,D.height*G),this._writeVertices(g,S,it,K),g.recordEnd()}_writeVertices(g,S,l,x){const K=g.vertexCount();this._writeVertexCommon(g,S,l,x),g.vertexWrite(x.offsets.upperLeft),g.vertexWrite(x.texcoords.upperLeft),g.vertexEnd(),this._writeVertexCommon(g,S,l,x),g.vertexWrite(x.offsets.upperRight),g.vertexWrite(x.texcoords.upperRight),g.vertexEnd(),this._writeVertexCommon(g,S,l,x),g.vertexWrite(x.offsets.lowerLeft),g.vertexWrite(x.texcoords.lowerLeft),g.vertexEnd(),this._writeVertexCommon(g,S,l,x),g.vertexWrite(x.offsets.lowerRight),g.vertexWrite(x.texcoords.lowerRight),g.vertexEnd(),g.indexWrite(K+0),g.indexWrite(K+1),g.indexWrite(K+2),g.indexWrite(K+1),g.indexWrite(K+3),g.indexWrite(K+2)}_writeVertexCommon(g,S,l,x){const K=this._color,et=this._haloColor,it=(0,J.Jz)(0,0,this._referenceSize,this._bitset),D=(0,J.Jz)(0,0,this._size,this._haloSize);g.vertexWrite(l),g.vertexWrite(S),g.vertexWrite(K),g.vertexWrite(et),g.vertexWrite(D),g.vertexWrite(it),g.vertexWrite(this._minMaxZoom)}}},18752:(Tt,dt,d)=>{d.d(dt,{Z:()=>g});var Y=d(62208),ot=d(23841),ct=d(12225),F=d(9545),B=d(7547),Q=d(81295),J=d(39351),A=d(5254),k=d(18716),H=d(50114),V=d(88337),Et=d(94358);class g extends((0,V.Z)(Et.Z)){constructor(l,x,K,et,it,D,G,y,W,R,rt,st,j,lt,ut,vt,yt,E,N,nt,U,at,mt){super(),this.angle=et,this.height=G,this.width=D,this.xOffset=x*N,this.yOffset=K*N,this._markerPlacement=nt,this._effects=U,this._anchorX=.5-(.5+vt)*ut.width/ut.width,this._anchorY=.5-(.5+yt)*ut.height/ut.height,this._minMaxZoom=(0,A.UJ)(Math.round(at*J.MI),Math.round(mt*J.MI));const Lt=(lt===B.v2.MAP?J.Tz:J.CQ)|(rt?J.Uh:0)|(j?J.oK:0)|(st?J.e0:0),gt=ut&&ut.sdf,ft=k.mE.load(l);ft.sdf=gt,ft.pattern=!0,ft.textureBinding=ut.textureBinding,this._materialKey=ft.data,this._fillColor=it,this._outlineColor=W,this._sizeOutlineWidth=(0,A.Jz)(Math.round(Math.min(Math.sqrt(128*D),255)),Math.round(Math.min(Math.sqrt(128*G),255)),Math.round(Math.min(Math.sqrt(128*R),255)),Math.round(Math.min(Math.sqrt(128*y),255)));const Ot=ut.rect.x+J.fL,St=ut.rect.y+J.fL,Kt=Ot+ut.width,Bt=St+ut.height;this._offsets.xUpperLeft=Ot,this._offsets.yUpperLeft=St,this._offsets.xUpperRight=Kt,this._offsets.yUpperRight=St,this._offsets.xBottomLeft=Ot,this._offsets.yBottomLeft=Bt,this._offsets.xBottomRight=Kt,this._offsets.yBottomRight=Bt,this._texUpperLeft=(0,A.UJ)(Ot,St),this._texUpperRight=(0,A.UJ)(Kt,St),this._texBottomLeft=(0,A.UJ)(Ot,Bt),this._texBottomRight=(0,A.UJ)(Kt,Bt),D*=E,G*=E,D*=N,G*=N;const Jt=Math.round(64*E);this._bitestAndDistRatio=(0,A.UJ)(Lt,Jt),this._computedWidth=D,this._computedHeight=G;const w=(0,F.c)(),h=(0,ct.c)();this._applyTransformation(h,w)}static fromCIMMarker(l,x,K){const D=l.size,G=(x&&x.width||1)/(x&&x.height||1)*l.scaleX,y=l.scaleSymbolsProportionally&&l.frameHeight?D/l.frameHeight:1;let W=(0,Q.t2)(l.color);const R=(0,Q.t2)(l.outlineColor),rt=(0,ot.F2)(D),st=rt*G,j=(0,ot.F2)(l.offsetX||0),lt=(0,ot.F2)(l.offsetY||0),ut=(0,ot.F2)(l.outlineWidth||0)*y,vt=l.alignment||B.v2.SCREEN,yt=(0,ot.F2)(l.referenceSize),[E,N]=(0,H._f)(l.scaleInfo,K);x.sdf||0!==W||(W=-1);let nt=l.rotation||0;l.rotateClockwise||(nt=-nt);let U=0,at=0;const mt=l.anchorPoint;mt&&(l.isAbsoluteAnchorPoint?D&&(U=-mt.x/(D*G),at=mt.y/D):(U=mt.x,at=mt.y));const Lt=new g(l.materialKey,j,lt,nt,W,st,rt,yt,R,ut,l.colorLocked,l.scaleSymbolsProportionally,!1,vt,x,U,at,l.sizeRatio,(0,Y.Pt)(l.scaleFactor,1),l.markerPlacement,l.effects,E,N);return Lt._vertexBoundsScaleX=l.maxVVSize?l.maxVVSize/st:1,Lt._vertexBoundsScaleY=l.maxVVSize?l.maxVVSize/rt:1,Lt}static fromPictureMarker(l,x){const K=Math.round((0,ot.F2)(l.width)),et=Math.round((0,ot.F2)(l.height)),it=J.ru,D=Math.round((0,ot.F2)(l.xoffset||0)),G=Math.round((0,ot.F2)(l.yoffset||0)),y=new g(l.materialKey,D,G,l.angle,it,K,et,et,0,0,!1,!1,!1,B.v2.SCREEN,x,0,0,1,1,null,null,H.Xe,H.eW);return y._vertexBoundsScaleX=l.maxVVSize?l.maxVVSize/l.width:1,y._vertexBoundsScaleY=l.maxVVSize?l.maxVVSize/l.height:1,y}static fromSimpleMarker(l,x){const K=(0,Q.aH)(l.color),et=Math.round((0,ot.F2)(l.size)),it=et,D=Math.round((0,ot.F2)(l.xoffset||0)),G=Math.round((0,ot.F2)(l.yoffset||0)),y=l.style,W=l.outline,R=0|(W&&W.color&&(0,Q.aH)(W.color)),rt=0|(W&&W.width&&Math.round((0,ot.F2)(W.width))),st=new g(l.materialKey,D,G,l.angle,K,et,it,it,R,rt,!1,!1,"esriSMSCross"===y||"esriSMSX"===y,B.v2.SCREEN,x,0,0,126/64,1,null,null,H.Xe,H.eW);return st.boundsType="esriSMSCircle"===y?"circle":"square",st._vertexBoundsScaleX=l.maxVVSize?l.maxVVSize/l.size:1,st._vertexBoundsScaleY=l.maxVVSize?l.maxVVSize/l.size:1,st}static fromLineSymbolMarker(l,x){const K=(0,Q.aH)(l.color),it=Math.round((0,ot.F2)(6*l.lineWidth)),D=it,G="cross"===l.style||"x"===l.style;let y;switch(l.placement){case"begin-end":y=B.Tx.Both;break;case"begin":y=B.Tx.JustBegin;break;case"end":y=B.Tx.JustEnd;break;default:y=B.Tx.None}const W={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:y,offsetAlongLine:0},R=new g(l.materialKey,0,0,0,K,it,D,D/6,K,G?Math.round((0,ot.F2)(l.lineWidth)):0,!1,!1,G,B.v2.MAP,x,0,0,126/64,1,W,null,H.Xe,H.eW);return R.boundsType="circle"===l.style?"circle":"square",R}}},94358:(Tt,dt,d)=>{d.d(dt,{Z:()=>ct});var Y=d(62208),ot=d(73608);class ct{bindFeature(B,Q,J){}write(B,Q,J,A){var k;if((0,Y.Wi)(this._effects)||0===(null==(k=this._effects)?void 0:k.length))return this._write(B,Q,A);const H=ot.j.executeEffects(this._effects,Q.readLegacyGeometryForDisplay(),A.geometryEngine);let V=ot.j.next(H);for(;V;)this._write(B,Q,A,V),V=ot.j.next(H)}_write(B,Q,J,A){}}},1825:(Tt,dt,d)=>{d.d(dt,{Wr:()=>Ne,Sl:()=>We});var Y=d(15861),ot=d(26584),ct=d(63290),F=d(10699),B=d(24837),Q=d(39406),J=d(18716),A=d(62208),k=d(23841),H=d(81295),V=d(39351),Et=d(43289),g=d(5254),S=d(50114),l=d(82054),K=(d(11915),d(58774)),et=d(88071),it=d(97938),D=d(47018);function G(a,i,r,n,s,c,u){O=0;const f=(n-r)*c,_=s&&s.length,M=_?(s[0]-r)*c:f;let v,T,C,P,L,z=y(i,r,0,0,M,c,!0);if(z&&z.next!==z.prev){if(_&&(z=function vt(a,i,r,n,s,c){const u=new Array;for(let f=0,_=n.length;f<_;f++){const M=y(a,i,0,n[f]*c,f<_-1?n[f+1]*c:r*c,c,!1);M===M.next&&(M.steiner=!0),u.push(ut(M))}u.sort(Kt);for(const f of u)yt(f,s),s=W(s,s.next);return s}(i,r,n,s,z,c)),f>80*c){v=C=i[0+r*c],T=P=i[1+r*c];for(let q=c;q<M;q+=c){const tt=i[q+r*c],xt=i[q+1+r*c];v=Math.min(v,tt),T=Math.min(T,xt),C=Math.max(C,tt),P=Math.max(P,xt)}L=Math.max(C-v,P-T),L=0!==L?1/L:0}R(z,a,c,v,T,L,u,0)}}function y(a,i,r,n,s,c,u){let f;if(u===function Lt(a,i,r,n,s,c){let u=0;for(let f=n,_=s-c;f<s;f+=c)u+=(a[_+i*c]-a[f+i*c])*(a[f+1+i*c]+a[_+1+i*c]),_=f;return u}(a,i,0,n,s,c)>0)for(let _=n;_<s;_+=c)f=j(_+i*c,a[_+i*c],a[_+1+i*c],f);else for(let _=s-c;_>=n;_-=c)f=j(_+i*c,a[_+i*c],a[_+1+i*c],f);return f&&St(f,f.next)&&(lt(f),f=f.next),f}function W(a,i=a){if(!a)return a;let r,n=a;do{if(r=!1,n.steiner||!St(n,n.next)&&0!==U(n.prev,n,n.next))n=n.next;else{if(lt(n),n=i=n.prev,n===n.next)break;r=!0}}while(r||n!==i);return i}function R(a,i,r,n,s,c,u,f){if(!a)return;!f&&c&&(a=N(a,n,s,c));let _=a;for(;a.prev!==a.next;){const M=a.prev,v=a.next;if(c?st(a,n,s,c):rt(a))i.push(M.index/r+u),i.push(a.index/r+u),i.push(v.index/r+u),lt(a),a=v.next,_=v.next;else if((a=v)===_){f?1===f?R(a=Bt(a,i,r,u),i,r,n,s,c,u,2):2===f&&Jt(a,i,r,n,s,c,u):R(W(a),i,r,n,s,c,u,1);break}}}function rt(a){const i=a.prev,r=a,n=a.next;if(U(i,r,n)>=0)return!1;let s=a.next.next;const c=s;let u=0;for(;s!==a.prev&&(0===u||s!==c);){if(u++,gt(i.x,i.y,r.x,r.y,n.x,n.y,s.x,s.y)&&U(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function st(a,i,r,n){const s=a.prev,c=a,u=a.next;if(U(s,c,u)>=0)return!1;const M=s.x>c.x?s.x>u.x?s.x:u.x:c.x>u.x?c.x:u.x,v=s.y>c.y?s.y>u.y?s.y:u.y:c.y>u.y?c.y:u.y,T=Ot(s.x<c.x?s.x<u.x?s.x:u.x:c.x<u.x?c.x:u.x,s.y<c.y?s.y<u.y?s.y:u.y:c.y<u.y?c.y:u.y,i,r,n),C=Ot(M,v,i,r,n);let P=a.prevZ,L=a.nextZ;for(;P&&P.z>=T&&L&&L.z<=C;){if(P!==a.prev&&P!==a.next&&gt(s.x,s.y,c.x,c.y,u.x,u.y,P.x,P.y)&&U(P.prev,P,P.next)>=0||(P=P.prevZ,L!==a.prev&&L!==a.next&&gt(s.x,s.y,c.x,c.y,u.x,u.y,L.x,L.y)&&U(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;P&&P.z>=T;){if(P!==a.prev&&P!==a.next&&gt(s.x,s.y,c.x,c.y,u.x,u.y,P.x,P.y)&&U(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;L&&L.z<=C;){if(L!==a.prev&&L!==a.next&&gt(s.x,s.y,c.x,c.y,u.x,u.y,L.x,L.y)&&U(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function j(a,i,r,n){const s=p.create(a,i,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function lt(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function ut(a){let i=a,r=a;do{(i.x<r.x||i.x===r.x&&i.y<r.y)&&(r=i),i=i.next}while(i!==a);return r}function yt(a,i){if(i=function E(a,i){let r=i;const n=a.x,s=a.y;let c,u=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){const C=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(C<=n&&C>u){if(u=C,C===n){if(s===r.y)return r;if(s===r.next.y)return r.next}c=r.x<r.next.x?r:r.next}}r=r.next}while(r!==i);if(!c)return null;if(n===u)return c.prev;const f=c,_=c.x,M=c.y;let v,T=1/0;for(r=c.next;r!==f;)n>=r.x&&r.x>=_&&n!==r.x&&gt(s<M?n:u,s,_,M,s<M?u:n,s,r.x,r.y)&&(v=Math.abs(s-r.y)/(n-r.x),(v<T||v===T&&r.x>c.x)&&ft(r,a)&&(c=r,T=v)),r=r.next;return c}(a,i)){const r=m(i,a);W(r,r.next)}}function N(a,i,r,n){for(let s;s!==a;s=s.next){if(s=s||a,null===s.z&&(s.z=Ot(s.x,s.y,i,r,n)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,N(a,i,r,n);s.prevZ=s.prev,s.nextZ=s.next}return a.prevZ.nextZ=null,a.prevZ=null,function nt(a){let i,r=1;for(;;){let n,s=a;a=null,i=null;let c=0;for(;s;){c++,n=s;let u=0;for(;u<r&&n;u++)n=n.nextZ;let f=r;for(;u>0||f>0&&n;){let _;0===u?(_=n,n=n.nextZ,f--):0!==f&&n?s.z<=n.z?(_=s,s=s.nextZ,u--):(_=n,n=n.nextZ,f--):(_=s,s=s.nextZ,u--),i?i.nextZ=_:a=_,_.prevZ=i,i=_}s=n}if(i.nextZ=null,r*=2,c<2)return a}}(a)}function U(a,i,r){return(i.y-a.y)*(r.x-i.x)-(i.x-a.x)*(r.y-i.y)}function at(a,i,r,n){return!!(St(a,i)&&St(r,n)||St(a,n)&&St(r,i))||U(a,i,r)>0!=U(a,i,n)>0&&U(r,n,a)>0!=U(r,n,i)>0}function gt(a,i,r,n,s,c,u,f){return(s-u)*(i-f)-(a-u)*(c-f)>=0&&(a-u)*(n-f)-(r-u)*(i-f)>=0&&(r-u)*(c-f)-(s-u)*(n-f)>=0}function ft(a,i){return U(a.prev,a,a.next)<0?U(a,i,a.next)>=0&&U(a,a.prev,i)>=0:U(a,i,a.prev)<0||U(a,a.next,i)<0}function Ot(a,i,r,n,s){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-r)*s)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-n)*s)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function St(a,i){return a.x===i.x&&a.y===i.y}function Kt(a,i){return a.x-i.x}function Bt(a,i,r,n){let s=a;do{const c=s.prev,u=s.next.next;!St(c,u)&&at(c,s,s.next,u)&&ft(c,u)&&ft(u,c)&&(i.push(c.index/r+n),i.push(s.index/r+n),i.push(u.index/r+n),lt(s),lt(s.next),s=a=u),s=s.next}while(s!==a);return s}function Jt(a,i,r,n,s,c,u){let f=a;do{let _=f.next.next;for(;_!==f.prev;){if(f.index!==_.index&&w(f,_)){let M=m(f,_);return f=W(f,f.next),M=W(M,M.next),R(f,i,r,n,s,c,u,0),void R(M,i,r,n,s,c,u,0)}_=_.next}f=f.next}while(f!==a)}function w(a,i){return a.next.index!==i.index&&a.prev.index!==i.index&&!function mt(a,i){let r=a;do{if(r.index!==a.index&&r.next.index!==a.index&&r.index!==i.index&&r.next.index!==i.index&&at(r,r.next,a,i))return!0;r=r.next}while(r!==a);return!1}(a,i)&&ft(a,i)&&ft(i,a)&&function h(a,i){let r=a,n=!1;const s=(a.x+i.x)/2,c=(a.y+i.y)/2;do{r.y>c!=r.next.y>c&&r.next.y!==r.y&&s<(r.next.x-r.x)*(c-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==a);return n}(a,i)}function m(a,i){const r=p.create(a.index,a.x,a.y),n=p.create(i.index,i.x,i.y),s=a.next,c=i.prev;return a.next=i,i.prev=a,r.next=s,s.prev=r,n.next=r,r.prev=n,c.next=n,n.prev=c,n}class p{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(i,r,n){const s=O<I.length?I[O++]:new p;return s.index=i,s.x=r,s.y=n,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const I=new Array;let O=0;for(let a=0;a<8096;a++)I.push(new p);const $=new D.b(0,0,0,1,0),ht=new D.b(0,0,0,1,0);function _t(a,i,r){let n=0;for(let s=1;s<r;s++)n+=(a[2*(i+s)]-a[2*(i+s-1)])*(a[2*(i+s)+1]+a[2*(i+s-1)+1]);return n}function Z(a,i,r,n,s){let c=0;for(let f=r;f<n;f+=3){const _=2*(a[f]-s),M=2*(a[f+1]-s),v=2*(a[f+2]-s);c+=Math.abs((i[_]-i[v])*(i[M+1]-i[_+1])-(i[_]-i[M])*(i[v+1]-i[_+1]))}return c}$.setExtent(V.I_),ht.setExtent(V.I_);var Ft=d(7547),At=d(64288),Gt=d(46519);const me=a=>class extends a{constructor(...i){super(...i),this.tessellationProperties={},this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},this.geometryType=Q.LW.LINE}writeGeometry(i,r,n,s){this._writeGeometry(i,r,n,s)}_initializeTessellator(i){const r=J.a.load(this._materialKey),n=J.dk.load(this._materialKey),s=this._tessellationOptions,u=this.tessellationProperties._halfWidth<V.tQ&&!i&&!(r.vvSizeFieldStops||r.vvSizeMinMaxValue||r.vvSizeScaleStops||r.vvSizeUnitValue);this.tessellationProperties.minMaxZoom=this._minMaxZoom,s.wrapDistance=65535,s.textured=this._isDashed||this._hasPattern,s.offset=this.tessellationProperties.offset,s.halfWidth=this.tessellationProperties._halfWidth;const f=u?0:1;this._lineTessellator=new Gt.z((n.outlinedFill?Ce:Se)(this.tessellationProperties,f,f),ze(this.tessellationProperties),u)}_write(i,r,n,s){const c="esriGeometryPoint"===r.geometryType;i.recordStart(r.getDisplayId(),this._materialKey,this.geometryType,c),this._writeGeometry(i,r,s,c),i.recordEnd()}_writeGeometry(i,r,n,s){const c=null!=n?n:r.readLegacyGeometryForDisplay(),u=this._getLines(c,s);(0,A.Wi)(u)||this._writeVertices(i,r,u)}_getLines(i,r){if((0,A.Wi)(i))return null;const n=i.paths||i.rings;return(0,A.Wi)(n)?null:function It(a,i){ht.setPixelMargin(i);const r=ht,n=-i,s=V.I_+i;let c=[],u=!1,f=0;for(;f<a.length;){const _=[],M=a[f];if(!M)return null;r.reset(it.V.LineString);let[v,T]=M[0];if(u)r.moveTo(v,T);else{if(v<n||v>s||T<n||T>s){u=!0;continue}_.push({x:v,y:T})}let C=!1;const P=M.length;for(let L=1;L<P;++L)if(v+=M[L][0],T+=M[L][1],u)r.lineTo(v,T);else{if(v<n||v>s||T<n||T>s){C=!0;break}_.push({x:v,y:T})}if(C)u=!0;else{if(u){const L=r.resultWithStarts();if(L)for(const z of L)c.push(z)}else c.push({line:_,start:0});f++,u=!1}}return c=c.filter(_=>_.line.length>1),0===c.length?null:c}(n,r?256:16)}_writeVertices(i,r,n){const s=r.getDisplayId(),c=i.vertexCount(),u=this.tessellationProperties,f=this._tessellationOptions;u.out=i,u.id=s,u.indexCount=0,u.vertexCount=0,u.offset=c,f.capType=this._capType,f.joinType=this._joinType;const _=J.dk.load(this._materialKey);this.tessellationProperties.key=_.outlinedFill?_:J.a.load(this._materialKey);for(const{line:M,start:v}of n)f.initialDistance=v%65535,this._lineTessellator.tessellate(M,f)}},Se=(a,i,r)=>(n,s,c,u,f,_,M,v,T,C,P)=>{const L=(0,g.UJ)(P,Math.ceil(16*a._halfWidth)),z=(0,g.Jz)(Math.round(16*M),Math.round(16*v),Math.round(16*T),Math.round(16*C)),q=(0,g.Jz)(16*f,16*_,0,a._bitset),tt=a.out;return tt.vertexBounds(n,s,i,r),tt.vertexWrite((0,g.UJ)(8*n,8*s)),tt.vertexWrite(a.id),tt.vertexWrite(a._fillColor),tt.vertexWrite(z),tt.vertexWrite(L),tt.vertexWrite(a._tl),tt.vertexWrite(a._br),tt.vertexWrite(q),tt.vertexWrite((0,g.UJ)(Math.ceil(16*a._halfReferenceWidth),0)),tt.vertexWrite(a.minMaxZoom),tt.vertexEnd(),a.offset+a.vertexCount++},Ce=(a,i,r)=>(n,s,c,u,f,_,M,v,T,C,P)=>{const L=(0,g.Jz)(0,0,16*a._halfWidth,16*a._halfReferenceWidth),z=(0,g.Jz)(16*M+128,16*v+128,16*T+128,16*C+128),q=a.out,tt=a._bitset<<24|a.id;return q.vertexBounds(n,s,i,r),q.vertexWrite((0,g.UJ)(8*n,8*s)),q.vertexWrite(tt),q.vertexWrite(a._fillColor),a.key.simple||(q.vertexWrite(0),q.vertexWrite(0)),q.vertexWrite(L),q.vertexWrite(z),a.key.simple||q.vertexWrite(a.minMaxZoom),q.vertexEnd(),a.offset+a.vertexCount++},ze=a=>(i,r,n)=>{const s=a.out;s.indexWrite(i),s.indexWrite(r),s.indexWrite(n),a.indexCount+=3};var ae=d(94358);const be=ct.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class kt extends(me(ae.Z)){constructor(i,r,n,s,c,u,f,_,M,v,T,C,P,L,z,q,tt,xt,Dt){super();const Ct=J.a.load(i);r&&(Ct.sdf=r.sdf,Ct.pattern=!0,Ct.textureBinding=r.textureBinding),this._capType=s,this._joinType=c,this._miterLimitCosine=(0,S.NW)(u),this.tessellationProperties._fillColor=f,this.tessellationProperties._tl=_,this.tessellationProperties._br=M,this._hasPattern=v,this._isDashed=T,this._zOrder=q,this._effects=tt,this._minMaxZoom=(0,g.UJ)(Math.round(xt*V.MI),Math.round(Dt*V.MI)),this._materialKey=Ct.data,this.tessellationProperties._bitset=(P?V.Uh:0)|(L?V.SD:0)|(C?V._6:0),this.tessellationProperties._halfWidth=.5*n,this.tessellationProperties._halfReferenceWidth=.5*z,this.tessellationProperties.offset=0,this._initializeTessellator(!1)}static fromCIMLine(i,r,n){const s=i.color,c=i.scaleFactor||1,u=!!i.dashTemplate;let f=i.cap;u&&f===Ft.RL.ROUND&&(f=Ft.RL.SQUARE);const _=i.join,M=(0,k.F2)(i.width)*c,v=(0,k.F2)(i.referenceWidth),T=(0,k.F2)(i.miterLimit),C=s&&(0,H.t2)(s)||0,[P,L]=(0,S._f)(i.scaleInfo,n);if(!r)return new kt(i.materialKey,r,M,f,_,T,C,0,0,!1,u,i.scaleDash,i.colorLocked,!1,v,i.zOrder,i.effects,P,L);const{rect:q,width:tt,height:xt}=r,Dt=q.x+V.fL,Ct=q.y+V.fL,Zt=Dt+tt,Yt=Ct+xt,Qt=(0,g.UJ)(Dt,Ct),$t=(0,g.UJ)(Zt,Yt);return new kt(i.materialKey,r,M,f,_,T,C,Qt,$t,!0,u,i.scaleDash,i.colorLocked,!1,v,i.zOrder,i.effects,P,L)}static fromFillOutline(i){var r;return i.isOutlinedFill&&i.outline&&"esriSLSSolid"===(null==(r=i.outline)?void 0:r.style)?kt.fromSimpleLine(qt({hash:"",materialKey:i.materialKey},i.outline),null,!0):null}static fromSimpleLine(i,r,n=!1){const{color:s}=i,c="esriSLSSolid"!==i.style&&"esriSLSNull"!==i.style,u=(0,At.ws)(i.cap||"round"),f=(0,At.xV)(i.join||"round");let _=s&&"esriSLSNull"!==i.style&&(0,H.aH)(s)||0;"esriSLSNull"===i.style&&(_=0);const M=(0,k.F2)(i.width),v=i.miterLimit;if(!r)return new kt(i.materialKey,r,M,u,f,v,_,0,0,!1,c,!0,!1,n,M,0,null,S.Xe,S.eW);const{rect:T,width:C,height:P}=r,L=T.x+V.fL,z=T.y+V.fL,q=L+C,tt=z+P,xt=(0,g.UJ)(L,z),Dt=(0,g.UJ)(q,tt);return new kt(i.materialKey,r,M,u,f,v,_,xt,Dt,!0,c,!0,!1,n,M,0,null,S.Xe,S.eW)}static fromPictureLineSymbol(i,r,n,s){return be.error("PictureLineSymbol support does not exist!"),null}}const ye=a=>class extends a{constructor(...i){super(...i),this.forceLibtess=!1,this._bitset=0,this._lineTemplate=null,this.geometryType=Q.LW.FILL}_maybeAddLineTemplate(i){this._lineTemplate=kt.fromFillOutline(i)}_write(i,r,n,s){const c="esriGeometryPoint"===r.geometryType,u=J.dk.load(this._materialKey);i.recordStart(r.getDisplayId(),this._materialKey,this.geometryType,c),this._writeGeometry(i,r,u,s,c),u.outlinedFill&&(0,A.pC)(this._lineTemplate)&&this._lineTemplate.writeGeometry(i,r,s,c),i.recordEnd()}_writeGeometry(i,r,n,s,c){const u=this._getGeometry(r,s,c);if((0,A.Wi)(u))return;const f=[];if(!(u.maxLength>100)&&!this.forceLibtess&&function Pt(a,i){const{coords:r,lengths:n,hasIndeterminateRingOrder:s}=i,u=a;if(s)return!1;let f=0;for(let _=0;_<n.length;){let M=_,v=n[_],T=_t(r,f,v);const C=[];for(;++M<n.length;){const q=n[M],tt=_t(r,f+v,q);if(!(tt>0))break;T+=tt,C.push(f+v),v+=q}const P=u.length;G(u,r,f,f+v,C,2,0);const L=Z(u,r,P,u.length,0),z=Math.abs(T);if(Math.abs((L-z)/Math.max(1e-7,z))>1e-5)return u.length=0,!1;_=M,f+=v}return!0}(f,u))return void(f.length&&this._writeVertices(i,r,u.coords,u.lengths,n,f));const _=function pt(a){const{coords:i,lengths:r}=a,{buffer:n}=(0,K.b)(i,r);return n}(u);this._writeVertices(i,r,_,[_.length/2],n)}_writeVertex(i,r,n,s,c,u){const f=(0,g.UJ)(1*s,1*c);i.vertexBounds(s,c,0,0),i.vertexWrite(f),i.vertexWrite(r),n.dotDensity?i.vertexWriteF32(1/Math.abs(u.readGeometryArea())):(i.vertexWrite(this.fillColor),n.simple||(i.vertexWrite(this.tl),i.vertexWrite(this.br)),i.vertexWrite(this.aux2),i.vertexWrite(this.aux3),n.simple||i.vertexWrite(this._minMaxZoom))}_writeVertices(i,r,n,s,c,u){const f=r.getDisplayId(),_=this._bitset<<24|f,M=s.reduce((P,L)=>P+L),v=c.dotDensity?4:10,T=i.vertexCount();i.vertexEnsureSize(v*M);let C=0;if(u)for(const P of u)this._writeVertex(i,_,c,n[2*P],n[2*P+1],r),C++;else for(let P=0;P<n.length;P+=2){const L=Math.round(n[P]),z=Math.round(n[P+1]);this._writeVertex(i,_,c,L,z,r),C++}i.indexEnsureSize(C);for(let P=0;P<C;P++)i.indexWrite(P+T)}_getGeometry(i,r,n){const s=r?(0,l.oB)((0,l.GH)(r),2):i.readGeometryForDisplay();return s?function Wt(a,i){if((0,A.Wi)(a))return null;if(!function zt(a,i,r){let n=0;for(let s=0;s<a.lengths.length;s++){const c=a.lengths[s];for(let u=0;u<c;u++){const f=a.coords[2*(u+n)],_=a.coords[2*(u+n)+1];if(f<i||f>r||_<i||_>r)return!0}n+=c}return!1}(a,-128,V.I_+128))return a;$.setPixelMargin(i),$.reset(it.V.Polygon);let r=0;for(let u=0;u<a.lengths.length;u++){const f=a.lengths[u];let _=a.coords[2*(0+r)],M=a.coords[2*(0+r)+1];$.moveTo(_,M);for(let v=1;v<f;v++)_=a.coords[2*(v+r)],M=a.coords[2*(v+r)+1],$.lineTo(_,M);$.close(),r+=f}const n=$.result(!1);if(!n)return null;const s=[],c=[];for(const u of n){let f=0;for(const _ of u)c.push(_.x),c.push(_.y),f++;s.push(f)}return new et.Z(s,c)}(s,n?256:8):null}};var De=d(84175),le=d(80991);const xe=ct.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class ee extends ae.Z{constructor(i){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=i}analyze(i,r,n,s,c){if(c&&0===c.length)return null;const u=c&&c.length>0,f=r.readLegacyFeature(),_=this._materialCache,M=this._cimLayer.materialHash;if(!M)return xe.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);const v="function"==typeof M?M(f,n,s):M;if(_.has(v)){const xt=_.get(v);return Promise.resolve(xt)}const T=this._ongoingMaterialRequestMap.get(v);if(T)return T;const C=this._cimLayer,P=(0,De.S)(C.cim,this._cimLayer.materialOverrides);P.mosaicHash=v;const{type:L,url:z}=C,q={cim:P,type:L,mosaicHash:v,url:z,size:null,dashTemplate:null,text:null,fontName:null};switch(L){case"marker":q.size=(0,le.hf)(C.size,f,n,s);break;case"line":q.dashTemplate=C.dashTemplate;break;case"text":q.text=(0,le.hf)(C.text,f,n,s),q.fontName=(0,le.hf)(C.fontName,f,n,s)}const tt=i.getMosaicItem(q,c).then(xt=>(u||(this._ongoingMaterialRequestMap.delete(v),_.set(v,xt)),xt)).catch(xt=>(this._ongoingMaterialRequestMap.delete(v),xe.error(".analyze()",xt.message),null));return u||this._ongoingMaterialRequestMap.set(v,tt),tt}}var Ut=d(84450);class he extends(ye(ee)){constructor(i,r,n){var s;if(super(i),this._minMaxZoom=(0,g.UJ)(Math.round(r*V.MI),Math.round(n*V.MI)),(0,S.mf)(i.color))this._dynamicPropertyMap.set("fillColor",(C,P,L)=>{const z=i.color(C,P,L);return z&&(0,H.t2)(z)||0});else{const T=i.color;this.fillColor=T&&(0,H.t2)(T)||0}const c="CIMMarkerPlacementInsidePolygon"===(null==(s=i.cim.placement)?void 0:s.type)&&i.cim.placement.shiftOddRows?2:1,u=i.height;(0,S.mf)(u)?this._dynamicPropertyMap.set("_height",(C,P,L)=>u(C,P,L)*c):this._height=(u||0)*c;const f=i.offsetX;if((0,S.mf)(f))this._dynamicPropertyMap.set("_offsetX",(C,P,L)=>{let z=(0,k.F2)(f(C,P,L))+128;return z>255?z=255:z<0&&(z=0),z});else{let T=(0,k.F2)(f||0)+128;T>255?T=255:T<0&&(T=0),this._offsetX=T}const _=i.offsetY;if((0,S.mf)(_))this._dynamicPropertyMap.set("_offsetY",(C,P,L)=>{let z=(0,k.F2)(-_(C,P,L))+128;return z>255?z=255:z<0&&(z=0),z});else{let T=(0,k.F2)(-_||0)+128;T>255?T=255:T<0&&(T=0),this._offsetY=T}const M=i.scaleX;(0,S.mf)(M)?this._dynamicPropertyMap.set("_scaleX",M):this._scaleX=M||1;const v=i.angle;if((0,S.mf)(v)?this._dynamicPropertyMap.set("_angle",(C,P,L)=>(0,Et.Or)(v(C,P,L))):this._angle=(0,Et.Or)(v)||0,(0,A.pC)(i.effects)){const T=i.effects;(0,S.mf)(T)?this._dynamicPropertyMap.set("_effects",T):this._effects=T}this._cimFillLayer=i,this._fillMaterialKey=J.dk.load(i.materialKey)}static fromCIMFill(i,r){const[n,s]=(0,S._f)(i.scaleInfo,r);return new he(i,n,s)}bindFeature(i,r,n){const s=i.readLegacyFeature();this._dynamicPropertyMap.forEach((v,T)=>{this[T]=v(s,r,n)});const c=this._fillMaterialKey,u=this._materialCache,f=(0,this._cimFillLayer.materialHash)(s,r,n),_=u.get(f);let M=null;if(_&&(0,Ut.ok)(_.spriteMosaicItem)&&(M=_.spriteMosaicItem),M){const{rect:v,width:T,height:C}=M,P=v.x+V.fL,L=v.y+V.fL,z=P+T,q=L+C;let tt=Math.round((0,k.F2)(this._height));tt>255?tt=255:tt<=0&&(tt=q-L);let xt=Math.round((0,k.F2)(this._height/C*T||0));xt>255?xt=255:xt<=0&&(xt=z-P);const Dt=this._scaleX,Ct=1;this.tl=(0,g.UJ)(P,L),this.br=(0,g.UJ)(z,q),this.aux2=(0,g.Jz)(xt,tt,this._offsetX,this._offsetY),this.aux3=(0,g.Jz)(Dt,Ct,this._angle,0),c.sdf=M.sdf,c.pattern=!0,c.textureBinding=M.textureBinding}else this.tl=0,this.br=0,this.aux2=0,this.aux3=0,c.sdf=!1,c.pattern=!1,c.textureBinding=0;this._materialKey=c.data}}class ce extends(me(ee)){constructor(i,r,n){super(i),this._minMaxZoom=(0,g.UJ)(Math.round(r*V.MI),Math.round(n*V.MI)),this._cimLineLayer=i;let s=0;(0,S.mf)(i.width)||(s=.5*(0,k.F2)(i.width)),this._dynamicPropertyMap.set("_halfWidth",(_,M,v)=>(0,S.mf)(i.width)?.5*(0,k.F2)(i.width(_,M,v)):s),(0,S.mf)(i.cap)?this._dynamicPropertyMap.set("_capType",i.cap):this._capType=i.cap,(0,S.mf)(i.join)?this._dynamicPropertyMap.set("_joinType",i.join):this._joinType=i.join;const u=i.color;(0,S.mf)(u)?this._dynamicPropertyMap.set("_fillColor",(M,v,T)=>(0,H.t2)(u(M,v,T))):this._fillColor=u&&(0,H.t2)(u)||0;const f=i.miterLimit;if((0,S.mf)(f)?this._dynamicPropertyMap.set("_miterLimitCosine",(M,v,T)=>(0,S.NW)(f(M,v,T))):this._miterLimitCosine=(0,S.NW)(f),(0,A.pC)(i.effects)){const _=i.effects;(0,S.mf)(_)?this._dynamicPropertyMap.set("_effects",_):this._effects=_}this._scaleFactor=i.scaleFactor||1,this._isDashed=null!=i.dashTemplate,this.tessellationProperties._bitset=(i.colorLocked?1:0)|(i.scaleDash?1:0)<<1,this._materialKey=i.materialKey,this._initializeTessellator(!0)}static fromCIMLine(i,r){const[n,s]=(0,S._f)(i.scaleInfo,r);return new ce(i,n,s)}bindFeature(i,r,n){const s=i.readLegacyFeature();this._dynamicPropertyMap.forEach((v,T)=>{this[T]=v(s,r,n)}),this._halfWidth*=this._scaleFactor;const c=this._materialCache,u=(0,this._cimLineLayer.materialHash)(s,r,n),f=c.get(u);let _=null;if(f&&(0,Ut.ok)(f.spriteMosaicItem)&&(_=f.spriteMosaicItem),_){this._hasPattern=!0;const{rect:v,width:T,height:C}=_,P=v.x+V.fL,L=v.y+V.fL,z=P+T,q=L+C;this.tessellationProperties._tl=(0,g.UJ)(P,L),this.tessellationProperties._br=(0,g.UJ)(z,q)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const M=J.a.load(this._materialKey);_&&(M.sdf=_.sdf,M.pattern=!0,M.textureBinding=_.textureBinding),this._materialKey=M.data}}var Oe=d(12225),Fe=d(9545),Be=d(88337);const Re=(0,Fe.c)(),Ae=(0,Oe.c)(),Ue=ct.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class ue extends((0,Be.Z)(ee)){constructor(i,r,n){super(i),this._cimMarkerLayer=i,this._minMaxZoom=(0,g.UJ)(Math.round(r*V.MI),Math.round(n*V.MI));const s=i.color;(0,S.mf)(s)?this._dynamicPropertyMap.set("_fillColor",(P,L,z)=>(0,H.t2)(s(P,L,z))):this._fillColor=(0,H.t2)(s);const c=i.outlineColor;(0,S.mf)(c)?this._dynamicPropertyMap.set("_outlineColor",(P,L,z)=>(0,H.t2)(c(P,L,z))):this._outlineColor=(0,H.t2)(c);const u=i.size;(0,S.mf)(u)?this._dynamicPropertyMap.set("_size",(P,L,z)=>(0,k.F2)(u(P,L,z))):this._size=(0,k.F2)(u)||0;const f=i.scaleX;(0,S.mf)(f)?this._dynamicPropertyMap.set("_scaleX",f):this._scaleX=f||1;const _=i.offsetX;(0,S.mf)(_)?this._dynamicPropertyMap.set("xOffset",(P,L,z)=>(0,k.F2)(_(P,L,z))):this.xOffset=(0,k.F2)(_)||0;const M=i.offsetY;(0,S.mf)(M)?this._dynamicPropertyMap.set("yOffset",(P,L,z)=>(0,k.F2)(M(P,L,z))):this.yOffset=(0,k.F2)(M)||0;const v=i.outlineWidth;(0,S.mf)(v)?this._dynamicPropertyMap.set("_outlineWidth",(P,L,z)=>(0,k.F2)(v(P,L,z))):this._outlineWidth=(0,k.F2)(v)||0;const T=i.rotation;if((0,S.mf)(T)?this._dynamicPropertyMap.set("_angle",T):this._angle=T||0,(0,A.pC)(i.effects)){const C=i.effects;(0,S.mf)(C)?this._dynamicPropertyMap.set("_effects",C):this._effects=C}if((0,A.pC)(i.markerPlacement)){const C=i.markerPlacement;(0,S.mf)(C)?this._dynamicPropertyMap.set("_markerPlacement",C):this._markerPlacement=C}this._scaleFactor=(0,A.Pt)(i.scaleFactor,1),this._bitSet=(i.alignment===Ft.v2.MAP?1:0)|(i.colorLocked?1:0)<<1|(i.scaleSymbolsProportionally?1:0)<<3,this._materialKey=i.materialKey}static fromCIMMarker(i,r){const[n,s]=(0,S._f)(i.scaleInfo,r);return new ue(i,n,s)}bindFeature(i,r,n){const s=i.readLegacyFeature();this._dynamicPropertyMap.forEach((Ye,Qe)=>{this[Qe]=Ye(s,r,n)});const c=this._cimMarkerLayer.materialHash,u="function"==typeof c?c(s,r,n):c,f=this._materialCache.get(u);if(!f||!(0,Ut.ok)(f.spriteMosaicItem)||!f.spriteMosaicItem)return void Ue.error(new ot.Z("mapview-cim","Encountered an error when binding feature"));const _=f.spriteMosaicItem,M=this._cimMarkerLayer.sizeRatio,v=_.width/_.height*this._scaleX,T=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let C=this._size,P=C*v;const L=this.xOffset,z=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const q=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,k.F2)(this._cimMarkerLayer.frameHeight):1,tt=this._outlineWidth*q,xt=(0,k.F2)(this._cimMarkerLayer.referenceSize);let Dt=0,Ct=0;const Zt=this._cimMarkerLayer.anchorPoint;Zt&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(Dt=-Zt.x/(this._size*v),Ct=Zt.y/this._size):(Dt=Zt.x,Ct=Zt.y)),this._sizeOutlineWidth=(0,g.Jz)(Math.round(Math.min(Math.sqrt(128*P),255)),Math.round(Math.min(Math.sqrt(128*C),255)),Math.round(Math.min(Math.sqrt(128*tt),255)),Math.round(Math.min(Math.sqrt(128*xt),255))),this.angle=T;const Yt=Math.round(64*M);this._bitestAndDistRatio=(0,g.UJ)(this._bitSet,Yt);const Qt=_.rect.x+V.fL,$t=_.rect.y+V.fL,ne=Qt+_.width,Te=$t+_.height;this._texUpperLeft=(0,g.UJ)(Qt,$t),this._texUpperRight=(0,g.UJ)(ne,$t),this._texBottomLeft=(0,g.UJ)(Qt,Te),this._texBottomRight=(0,g.UJ)(ne,Te);const oe=J.mE.load(this._materialKey);oe.sdf=_.sdf,oe.pattern=!0,oe.textureBinding=_.textureBinding,this._materialKey=oe.data,this._anchorX=.5-(.5+Dt)*_.width/_.width,this._anchorY=.5-(.5+Ct)*_.height/_.height,P*=M,C*=M,P*=this._scaleFactor,C*=this._scaleFactor,P*=_.rect.width/_.width,C*=_.rect.height/_.height,this._computedWidth=P,this._computedHeight=C,this._applyTransformation(Ae,Re),this.xOffset=L,this.yOffset=z}}var ge=d(61261),Ze=d(44526),Me=d(32954);class fe extends((0,Ze.Z)(ee)){constructor(i,r,n){super(i),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map,this._minMaxZoom=(0,g.UJ)(Math.round(r*V.MI),Math.round(n*V.MI));const s=i.scaleFactor||1;this._cimTextLayer=i;const c=i.color;(0,S.mf)(c)?this._dynamicPropertyMap.set("_color",(q,tt,xt)=>(0,H.t2)(c(q,tt,xt))):this._color=(0,H.t2)(c);const u=i.outlineColor;let f,M,T;if((0,S.mf)(u)?this._dynamicPropertyMap.set("_haloColor",(q,tt,xt)=>(0,H.t2)(u(q,tt,xt))):this._haloColor=(0,H.t2)(u),(0,S.mf)(i.size)||(f=Math.min(Math.round((0,k.F2)(i.size*i.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",(z,q,tt)=>(0,S.mf)(i.size)?Math.min(Math.round((0,k.F2)(i.size(z,q,tt)*i.sizeRatio)),127):f),(0,S.mf)(i.outlineSize)?this._dynamicPropertyMap.set("_haloSize",(q,tt,xt)=>Math.min(Math.floor(5*(0,k.F2)(i.outlineSize(q,tt,xt)*i.sizeRatio)),127)):this._haloSize=Math.min(Math.floor(5*(0,k.F2)(i.outlineSize*i.sizeRatio)),127),(0,S.mf)(i.offsetX)||(M=Math.round((0,k.F2)(i.offsetX*i.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",(z,q,tt)=>(0,S.mf)(i.offsetX)?Math.round((0,k.F2)(i.offsetX(z,q,tt)*i.sizeRatio)):M),(0,S.mf)(i.offsetY)||(T=Math.round((0,k.F2)(i.offsetY*i.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",(z,q,tt)=>(0,S.mf)(i.offsetY)?Math.round((0,k.F2)(i.offsetY(z,q,tt)*i.sizeRatio)):T),(0,S.mf)(i.angle)?this._dynamicPropertyMap.set("_angle",i.angle):this._angle=i.angle,(0,S.mf)(i.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",i.horizontalAlignment):this._horizontalAlignment=i.horizontalAlignment,(0,S.mf)(i.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",i.verticalAlignment):this._verticalAlignment=i.verticalAlignment,(0,A.pC)(i.effects)){const z=i.effects;(0,S.mf)(z)?this._dynamicPropertyMap.set("_effects",z):this._effects=z}if((0,A.pC)(i.markerPlacement)){const z=i.markerPlacement;(0,S.mf)(z)?this._dynamicPropertyMap.set("_markerPlacement",z):this._textPlacement=z}(0,S.mf)(i.text)?this._dynamicPropertyMap.set("_text",i.text):this._text=i.text,this._scaleFactor=s;const P=Math.min(Math.round((0,k.F2)(i.referenceSize*i.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*P)),this._materialKey=i.materialKey;const L=J.qr.load(this._materialKey);L.sdf=!0,this._bitset=(i.alignment===Ft.v2.MAP?1:0)|(i.colorLocked?1:0)<<1,this._materialKey=L.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._isCIM=!0}static fromCIMText(i,r){const[n,s]=(0,S._f)(i.scaleInfo,r);return new fe(i,n,s)}analyze(i,r,n,s){var c=()=>super.analyze,u=this;return(0,Y.Z)(function*(){const f=r.readLegacyFeature(),_=function Ke(a,i,r,n){return"string"==typeof a.text?a.text:"function"==typeof a.text?a.text(i,r,n):""}(u._cimTextLayer,f,n,s),M=yield c().call(u,i,r,n,s,(0,Me._)(_));return M&&M.glyphMosaicItems&&u._textToGlyphs.set(_,M.glyphMosaicItems),M})()}bindFeature(i,r,n){const s=i.readLegacyFeature();if(this._dynamicPropertyMap.forEach((u,f)=>{this[f]=u(s,r,n)}),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/V.Ex,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,ge.kH)(this._horizontalAlignment||"center"),this._yAlignD=(0,ge.b7)(this._verticalAlignment||"baseline");const c=this._textToGlyphs.get(this._text);this.bindTextInfo(c,!1)}}const jt=128;class Xt extends(ye(ae.Z)){constructor(i,r,n,s,c,u,f,_,M,v,T,C,P,L,z,q){super(),this._effects=L;const tt=J.dk.load(i);r&&(tt.sdf=r.sdf,tt.pattern=!0,tt.textureBinding=r.textureBinding),this.fillColor=n,this.tl=s,this.br=c,this.aux2=(0,g.Jz)(u,f,_,M),this.aux3=(0,g.Jz)(v,T,C,0),this._bitset=P,this._minMaxZoom=(0,g.UJ)(Math.round(z*V.MI),Math.round(q*V.MI)),this._materialKey=tt.data}static fromCIMFill(i,r,n){const s=i.color,c=s&&(0,H.t2)(s)||0,u=i.materialKey,[f,_]=(0,S._f)(i.scaleInfo,n);if(!r)return new Xt(u,null,c,0,0,0,0,0,0,0,0,0,i.colorLocked?V.Uh:0,i.effects,f,_);const{rect:M,width:v,height:T}=r,P=M.x+V.fL,L=M.y+V.fL,z=P+v,q=L+T,tt=i.height,xt=(i.scaleX||1)*tt;let Dt=Math.round(tt);Dt>255?Dt=255:Dt<=0&&(Dt=q-L);let Ct=Math.round(xt);Ct>255?Ct=255:Ct<=0&&(Ct=z-P);let Zt=(0,k.F2)(i.offsetX||0)+jt;Zt>255&&(Zt=255);let Yt=(0,k.F2)(-i.offsetY||0)+jt;Yt>255&&(Yt=255);const Qt=(0,g.UJ)(P,L),$t=(0,g.UJ)(z,q);return new Xt(u,r,c,Qt,$t,Ct,Dt,Zt,Yt,jt,jt,(0,Et.s5)(i.angle),i.colorLocked?V.Uh:0,i.effects,f,_)}static fromSimpleFill(i,r,n=!1){const{color:s}=i,c=s&&"esriSFSNull"!==i.style&&(0,H.aH)(s)||0,u=n?V.Uh:0,f=i.materialKey;let _;if(r){const{rect:M,width:v,height:T}=r,C=M.x+V.fL,P=M.y+V.fL,L=C+v,z=P+T,q=(0,g.UJ)(C,P),tt=(0,g.UJ)(L,z);_=new Xt(f,r,c,q,tt,v,T,0,0,jt,jt,0,u,null,S.Xe,S.eW)}else _=new Xt(f,null,c,0,0,0,0,0,0,0,0,0,u,null,S.Xe,S.eW);return _._maybeAddLineTemplate(i),_}static fromPictureFill(i,r,n=!1){const s=V.ru,{rect:c,width:u,height:f}=r,_=c.x+V.fL,M=c.y+V.fL,v=_+u,T=M+f,C=(0,g.UJ)(_,M),P=(0,g.UJ)(v,T);let L=Math.round((0,k.F2)(i.width));L>255&&(L=255);let z=Math.round((0,k.F2)(i.height));z>255&&(z=255);let q=(0,k.F2)(i.xoffset)+jt;q>255&&(q=255);let tt=(0,k.F2)(-i.yoffset)+jt;tt>255&&(tt=255);const Ct=new Xt(i.materialKey,r,s,C,P,L,z,q,tt,jt*i.xscale,jt*i.yscale,0,n?V.Uh:0,null,S.Xe,S.eW);return Ct._maybeAddLineTemplate(i),Ct}}var re=d(18752),Le=d(51919);class Ge{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){var i=this;return(0,Y.Z)(function*(){if(!i._resolver)return i._resolver=(0,F.hh)(),Promise.resolve();yield i._resolver.promise,yield i.acquire()})()}release(){const i=this._resolver;this._resolver=null,i.resolve()}}function _e(){return(_e=(0,Y.Z)(function*(a,i,r){try{yield a.acquire(),yield i(r),a.release()}catch(n){throw a.release(),n}})).apply(this,arguments)}var se=d(11263);const Rt=ct.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Pe=new Array,de={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:0},je=te(qt({},B.eG),{hash:JSON.stringify(B.eG),materialKey:(0,J.jj)(Q.LW.MARKER,de)}),Je=te(qt({},B.wW),{hash:JSON.stringify(B.wW),materialKey:(0,J.jj)(Q.LW.LINE,de)}),ke=te(qt({},B.lj),{hash:JSON.stringify(B.lj),materialKey:(0,J.jj)(Q.LW.FILL,de)});function Nt(a,i){const r=a.length;return a.push(null),i.then(n=>a[r]=n),a}function We(a){return!!(1&a)}class Ne{constructor(i,r){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new Ge,this._fetchResource=i,this._tileInfo=r}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(i,r){this._initErrorTemplates();const n=i.hash;if(this._symbolToTemplate.has(n))return this._symbolToTemplate.get(n);const s=new Array;r&&this._createMeshTemplates(s,r,!0),this._createMeshTemplates(s,i,!1);const c=this._createGroupId("expanded-cim"===i.type&&He(i));return this._idToTemplateGroup.set(c,s),this._symbolToTemplate.set(n,c),c}getTemplateGroup(i){return this._idToTemplateGroup.has(i)?this._idToTemplateGroup.get(i):Pe}getDynamicTemplateGroup(i){return this._idToTemplateGroup.has(i)?(We(i)||Rt.error("mapview-template-store",`Id ${i} does not refer to a dynamic template`),this._idToTemplateGroup.get(i)):Pe}getMosaicItem(i,r){const n=this._createTemplateId(),s=new Promise(c=>this._idToResolver.set(n,c));return this._fetchQueue.push({symbol:i,id:n,glyphIds:r}),s}finalize(i){return this._fetchQueue.length||this._lock.isHeld()?function Ve(a,i,r){return _e.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),i):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],ke,!1),marker:this._createMeshTemplates([],je,!1),line:this._createMeshTemplates([],Je,!1)})}_fetchAllQueuedResources(i){if(!this._fetchQueue.length)return Promise.resolve();const r=this._fetchQueue,n=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(n).then(()=>this._fetchResource(r,i).then(s=>{for(const{id:c,mosaicItem:u}of s)this._idToResolver.get(c)(u),this._idToResolver.delete(c)})).catch(s=>{(0,F.D_)(s)?this._fetchQueue=this._fetchQueue.concat(r):function Xe(a){return"worker:port-closed"===a.name}(s)||Rt.error(new ot.Z("mapview-template-store","Unable to fetch requested texture resources",s))})}_createGroupId(i){return this._idCounter++<<1|(i?1:0)}_createTemplateId(){return this._templateIdCounter++}_createSMS(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem(i);return(0,Ut.ok)(n,Rt)?re.Z.fromSimpleMarker(i,n):r._markerError})()}_createPMS(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem(i);return(0,Ut.ok)(n,Rt)?re.Z.fromPictureMarker(i,n):r._markerError})()}_createSFS(i,r){var n=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(i);return(0,Ut.ok)(s,Rt)?Xt.fromSimpleFill(i,s,r):n._fillError})()}_createPFS(i,r){var n=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(i);return(0,Ut.ok)(s,Rt)?Xt.fromPictureFill(i,s,r):n._fillError})()}_createSLS(i,r){var n=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(i);return(0,Ut.ok)(s,Rt)?kt.fromSimpleLine(i,s):n._lineError})()}_createLMS(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem(i);return(0,Ut.ok)(n,Rt)?re.Z.fromLineSymbolMarker(i,n):r._markerError})()}_createTS(i){var r=this;return(0,Y.Z)(function*(){const{glyphMosaicItems:n}=yield r.getMosaicItem(i);return Le.Z.fromText(i,n)})()}_createCIMText(i){var r=this;return(0,Y.Z)(function*(){const{glyphMosaicItems:n}=yield r.getMosaicItem((0,se.xS)(i),(0,Me._)(i.text));return(0,Ut.ok)(n,Rt)?Le.Z.fromCIMText(i,n,r._tileInfo):r._textError})()}_createCIMFill(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem((0,se.xS)(i));return(0,Ut.ok)(n,Rt)?Xt.fromCIMFill(i,n,r._tileInfo):r._fillError})()}_createCIMLine(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem((0,se.xS)(i));return(0,Ut.ok)(n,Rt)?kt.fromCIMLine(i,n,r._tileInfo):r._lineError})()}_createCIMMarker(i){var r=this;return(0,Y.Z)(function*(){const{spriteMosaicItem:n}=yield r.getMosaicItem((0,se.xS)(i));return(0,Ut.ok)(n,Rt)?re.Z.fromCIMMarker(i,n,r._tileInfo):r._markerError})()}_createCIM(i){var r=this;return(0,Y.Z)(function*(){const n=i.templateHash;if(r._cimTemplateCache.has(n))return r._cimTemplateCache.get(n);let s;switch(i.type){case"marker":s=yield r._createCIMMarker(i);break;case"line":s=yield r._createCIMLine(i);break;case"fill":s=yield r._createCIMFill(i);break;case"text":s=yield r._createCIMText(i)}return r._cimTemplateCache.set(n,s),s})()}_createDynamicCIM(i){var r=this;return(0,Y.Z)(function*(){const n=i.templateHash;if(r._cimTemplateCache.has(n))return r._cimTemplateCache.get(n);let s;switch(i.type){case"marker":s=ue.fromCIMMarker(i,r._tileInfo);break;case"line":s=ce.fromCIMLine(i,r._tileInfo);break;case"fill":s=he.fromCIMFill(i,r._tileInfo);break;case"text":s=fe.fromCIMText(i,r._tileInfo)}return r._cimTemplateCache.set(n,s),s})()}_createPrimitiveMeshTemplates(i,r,n){switch(r.type){case"esriSMS":return Nt(i,this._createSMS(r));case"esriPMS":return Nt(i,this._createPMS(r));case"esriSFS":return Nt(i,this._createSFS(r,n));case"line-marker":return Nt(i,this._createLMS(r));case"esriPFS":return Nt(i,this._createPFS(r,n));case"esriSLS":return Nt(i,this._createSLS(r,!1));case"esriTS":return Nt(i,this._createTS(r));default:return Rt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),i}}_createMeshTemplates(i,r,n){if(-1!==r.type.indexOf("3d"))return Rt.error("3D symbols are not supported with MapView"),i;if("expanded-cim"===r.type){for(const s of r.layers)Nt(i,"function"==typeof s.materialHash?this._createDynamicCIM(s):this._createCIM(s));return i}if("composite-symbol"===r.type){for(const s of r.layers)this._createPrimitiveMeshTemplates(i,s,n);return i}return"cim"===r.type||"label"===r.type||"web-style"===r.type?i:this._createPrimitiveMeshTemplates(i,r,n)}}const He=a=>{if(!a.layers)return!1;for(const i of a.layers)if("function"==typeof i.materialHash)return!0;return!1}},51919:(Tt,dt,d)=>{d.d(dt,{Z:()=>g});var Y=d(986),ot=d(23841),ct=d(7547),F=d(61261),B=d(81295),Q=d(39351),J=d(5254),A=d(18716),k=d(50114),H=d(44526),V=d(94358);class g extends((0,H.Z)(V.Z)){constructor(l,x,K,et,it,D,G,y,W,R,rt,st,j,lt,ut,vt,yt,E,N=!1,nt,U){super(),this._xOffset=(0,ot.F2)(j),this._yOffset=(0,ot.F2)(lt),this._decoration=R||"none",this._color=it,this._haloColor=D,this._haloSize=Math.min(Math.floor(5*(0,ot.F2)((0,ot.t_)(K))),127),this._size=Math.min(Math.round((0,ot.F2)(x)),127);const at=Math.min(Math.round((0,ot.F2)(et||x)),127);this._referenceSize=Math.round(Math.sqrt(256*at)),this._scale=this._size/Q.Ex,this._angle=st,this._justify=(0,F.Hd)(G||"center"),this._xAlignD=(0,F.kH)(G||"center"),this._yAlignD=(0,F.b7)(y||"baseline"),this._baseline="baseline"===(y||"baseline"),this._bitset=(W===ct.v2.MAP?1:0)|(rt?1:0)<<1;const mt=A.m2.load(l);mt.sdf=!0,this._materialKey=mt.data,this._lineWidth=(0,ot.F2)(ut)||512,this._lineHeight=vt||1,this._textPlacement=yt,this._effects=E,this._isCIM=N,this._minMaxZoom=(0,J.UJ)(Math.round(nt*Q.MI),Math.round(U*Q.MI))}static fromText(l,x){const K=new g(l.materialKey,l.font.size,l.haloSize||0,l.font.size,l.color&&(0,B.aH)(l.color)||0,l.haloColor&&(0,B.aH)(l.haloColor)||0,l.horizontalAlignment,l.verticalAlignment,ct.v2.SCREEN,l.font.decoration,!1,l.angle||0,l.xoffset,l.yoffset,l.lineWidth,l.lineHeight,null,null,!1,k.Xe,k.eW),[,et]=(0,Y.E)(l.text);return K.bindTextInfo(x,et),K._vertexBoundsScale=l.maxVVSize?l.maxVVSize/l.font.size:1,K}static fromCIMText(l,x,K){const et=l.scaleFactor||1,it=l.size*l.sizeRatio*et,[D,G]=(0,k._f)(l.scaleInfo,K),y=new g(l.materialKey,it,l.outlineSize*l.sizeRatio,l.referenceSize,(0,B.t2)(l.color),(0,B.t2)(l.outlineColor),l.horizontalAlignment,l.verticalAlignment,l.alignment,l.decoration,l.colorLocked,l.angle,l.offsetX*l.sizeRatio*et,l.offsetY*l.sizeRatio*et,512,1,l.markerPlacement,l.effects,!0,D,G),[,W]=(0,Y.E)(l.text);return y.bindTextInfo(x,W),y._vertexBoundsScale=l.maxVVSize?l.maxVVSize/it:1,y}}},50114:(Tt,dt,d)=>{d.d(dt,{eW:()=>ot,Xe:()=>Y,TK:()=>Q,NW:()=>A,_f:()=>S,mf:()=>J,Fv:()=>B,lu:()=>ct});const Y=0,ot=100;function ct(l,x,K){return l[0]=x[0]-K[0],l[1]=x[1]-K[1],l}function F(l,x){return Math.sqrt(l*l+x*x)}function B(l){const x=F(l[0],l[1]);l[0]/=x,l[1]/=x}function Q(l,x){return F(l[0]-x[0],l[1]-x[1])}function J(l){return"function"==typeof l}function A(l=2){return 1/Math.max(l,1)}function S(l,x){return[!!l.minScale&&x.scaleToZoom(l.minScale)||Y,!!l.maxScale&&x.scaleToZoom(l.maxScale)||ot]}},32940:(Tt,dt,d)=>{d.d(dt,{fL:()=>k});var Y=d(15861),ot=d(26584),ct=d(63290),F=d(93961),B=d(46679),Q=d(39236),J=d(11263);const A=ct.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");function k(G,y,W,R){return H.apply(this,arguments)}function H(){return(H=(0,Y.Z)(function*(G,y,W,R){switch(G.type){case"simple":return V.fromBasicRenderer(G,y,W,R);case"map":return S.fromUVRenderer(G,y,W,R);case"interval":return g.fromCBRenderer(G,y,W,R);case"dictionary":return D.fromDictionaryRenderer(G,y,W,R);case"subtype":return Et.fromSubtypes(G,y,W,R)}})).apply(this,arguments)}class V{constructor(){this.type="feature",this._defaultResult=null}static fromBasicRenderer(y,W,R,rt){return(0,Y.Z)(function*(){const st=new V;if(y.symbol){const j=yield(0,J.B3)(y.symbol,R,rt),lt=W.createTemplateGroup(j,null);st.setDefault(lt)}return st})()}size(){return 1}getDefault(){return this._defaultResult}setDefault(y){this._defaultResult=y}match(y,W,R,rt,st){return this.getDefault()}analyze(y,W,R,rt,st,j){return(0,Y.Z)(function*(){return null})()}}class Et extends V{constructor(y,W){super(),this._subMatchers=y,this._subtypeField=W}static fromSubtypes(y,W,R,rt){return(0,Y.Z)(function*(){const st=new Map,j=[];for(const lt in y.renderers){const ut=parseInt(lt,10),vt=k(y.renderers[lt],W,R,rt).then(yt=>st.set(ut,yt));j.push(vt)}return yield Promise.all(j),new Et(st,y.subtypeField)})()}match(y,W,R,rt,st){const j=W.readAttribute(this._subtypeField),lt=this._subMatchers.get(j);return lt?lt.match(y,W,R,rt,st):null}}class g extends V{constructor(y,W,R,rt){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=W,this._fieldIndex=rt,this._field=y,this._normalizationInfo=R}static fromCBRenderer(y,W,R,rt){return(0,Y.Z)(function*(){const{isMaxInclusive:st,normalizationField:j,normalizationTotal:lt,normalizationType:ut}=y,yt=new g(y.field,st,{normalizationField:j,normalizationTotal:lt,normalizationType:ut},y.fieldIndex),E=yield(0,J.B3)(y.backgroundFillSymbol,R,rt);yield Promise.all(y.intervals.map(function(){var nt=(0,Y.Z)(function*(U){const at=yield(0,J.B3)(U.symbol,R,rt),mt=yield W.createTemplateGroup(at,E);yt.add({min:U.min,max:U.max},mt)});return function(U){return nt.apply(this,arguments)}}()));const N=yield(0,J.B3)(y.defaultSymbol,R,rt);if(N){const nt=yield W.createTemplateGroup(N,E);yt.setDefault(nt)}return yt})()}add(y,W){this._intervals.push({interval:y,result:W}),this._intervals.sort((R,rt)=>R.interval.min-rt.interval.min)}size(){return super.size()+this._intervals.length}match(y,W,R,rt,st){if(null==this._fieldIndex&&!this._field)return this.getDefault();const j=null!=this._fieldIndex?W.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(W);if(!j&&(null==j||isNaN(j)))return this.getDefault();for(let lt=0;lt<this._intervals.length;lt++){const{interval:ut,result:vt}=this._intervals[lt],E=this._isMaxInclusive?j<=ut.max:j<ut.max;if(j>=ut.min&&E)return vt}return this.getDefault()}_needsNormalization(){const y=this._normalizationInfo;return y&&(y.normalizationField||y.normalizationTotal||y.normalizationType)}_getValueFromField(y){const W=y.readAttribute(this._field);if(!this._needsNormalization()||null==W)return W;const{normalizationField:R,normalizationTotal:rt,normalizationType:st}=this._normalizationInfo,j=!!R&&y.readAttribute(R);if(st)switch(st){case"esriNormalizeByField":return j?W/j:void 0;case"esriNormalizeByLog":return Math.log(W)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return W/rt*100;default:return void A.error(`Found unknown normalization type: ${st}`)}else A.error("Normalization is required, but no type was set!")}}class S extends V{constructor(y,W,R){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=R,this._fields=y,this._seperator=W||""}static fromUVRenderer(y,W,R,rt){return(0,Y.Z)(function*(){const st=y.fieldDelimiter,j=[y.field];y.field2&&j.push(y.field2),y.field3&&j.push(y.field3);const lt=yield(0,J.B3)(y.backgroundFillSymbol,R,rt),ut=new S(j,st,y.fieldIndex);yield Promise.all(y.map.map(function(){var yt=(0,Y.Z)(function*(E){const N=yield(0,J.B3)(E.symbol,R,rt),nt=yield W.createTemplateGroup(N,lt);"<Null>"===E.value?ut.setNullResult(nt):ut.add(E.value,nt)});return function(E){return yt.apply(this,arguments)}}()));const vt=yield(0,J.B3)(y.defaultSymbol,R,rt);if(vt){const yt=yield W.createTemplateGroup(vt,lt);ut.setDefault(yt)}return ut})()}setNullResult(y){this._nullResult=y}add(y,W){this._resultsMap.set(y.toString(),W)}size(){return super.size()+this._resultsMap.size}match(y,W,R,rt,st){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const j=null!=this._fieldsIndex?W.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(W);if(null!==this._nullResult&&(null==j||""===j||"<Null>"===j))return this._nullResult;if(!j&&null==j)return this.getDefault();const lt=j.toString();return this._resultsMap.has(lt)?this._resultsMap.get(lt):this.getDefault()}_getValueFromFields(y){const W=[];for(const R of this._fields){const rt=y.readAttribute(R);W.push(null==rt||""===rt?"<Null>":rt)}return W.join(this._seperator)}}function x(){return(x=(0,Y.Z)(function*(G,y){const W=G||1;if("number"==typeof W)return(rt,st,j)=>W;const R=yield(0,B.Yi)(W,y.spatialReference,y.fields);return(rt,st,j)=>(0,Q.Z)(R,rt,{$view:j},y.geometryType,st)||1})).apply(this,arguments)}let K;function et(){return it.apply(this,arguments)}function it(){return(it=(0,Y.Z)(function*(){return K||(K=d.e(3250).then(d.bind(d,3250))),K})).apply(this,arguments)}class D extends V{constructor(y,W,R,rt,st,j){super(),this.type="dictionary",this._groupIdCache=new F.Z(100),this._loader=y,this._fieldMap=y.fieldMap,this._symbolFields=y.getSymbolFields(),this._templates=W,this._info=R,this._scaleFn=rt,this._schemaUtilsModule=st,this._symbolOptions=j}static fromDictionaryRenderer(y,W,R,rt){return(0,Y.Z)(function*(){const[{DictionaryLoader:st},j]=yield Promise.all([Promise.resolve().then(d.bind(d,29996)),et()]),lt=new st(y.url,y.config,y.fieldMap);yield lt.fetchResources({spatialReference:R.spatialReference,fields:R.fields});const ut=yield function l(G,y){return x.apply(this,arguments)}(y.scaleExpression,R);return new D(lt,W,R,ut,j,y.symbolOptions)})()}_analyzeFeature(y,W,R,rt,st){var j=this;return(0,Y.Z)(function*(){const lt=y.readLegacyFeature(),ut=j._scaleFn(lt,R,rt),vt=j._attributeHash(lt)+"-"+ut,yt=j._groupIdCache.get(vt);if(yt)return yt;const E=te(qt({},rt),{spatialReference:j._info.spatialReference,abortOptions:st,fields:j._info.fields}),N=yield j._loader.getSymbolAsync(lt,E),nt=j._schemaUtilsModule.createSymbolSchema(N,j._symbolOptions),U=(0,J.B3)(nt,j._info,W,st).then(at=>{if("expanded-cim"!==at.type)return A.error(new ot.Z("mapview-bad-type",`Found unexpected type ${at.type} in dictionary response`)),null;at.hash+="-"+ut;for(const mt of at.layers)mt.scaleFactor=ut,mt.templateHash+="-"+ut;return j._templates.createTemplateGroup(at,null)});return j._groupIdCache.put(vt,U,1),U})()}analyze(y,W,R,rt,st,j){var lt=this;return(0,Y.Z)(function*(){const ut=W.getCursor(),vt=[];for(;ut.next();)vt.push(lt._analyzeFeature(ut,R,rt,st,j));return Promise.all(vt)})()}match(y,W,R,rt,st){return null}_attributeHash(y){let W="";for(const R of this._symbolFields){const rt=this._fieldMap[R];rt&&(W+=y.attributes[rt]+"-")}return W}}},84450:(Tt,dt,d)=>{d.d(dt,{ok:()=>ot});var Y=d(26584);function ot(ct,F){if(ct&&"name"in ct){const B=ct;return F&&F.error(new Y.Z(B.name,B.message,B.details)),!1}return!0}},75734:(Tt,dt,d)=>{d.d(dt,{Z:()=>ot});class ot{constructor(F,B){this._pos=0;const Q=B?this._roundToNearest(B,F.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(Q),this._buffer=new F(this._array),this._ctor=F,this._i16View=new Int16Array(this._array)}get length(){return this._pos}_roundToNearest(F,B){const Q=Math.round(F);return Q+(B-Q%B)}_ensureSize(F){if(this._pos+F>=this._buffer.length){const B=this._roundToNearest(1.25*(this._array.byteLength+F*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),Q=new ArrayBuffer(B),J=new this._ctor(Q);J.set(this._buffer,0),this._array=Q,this._buffer=J,this._i16View=new Int16Array(this._array)}}ensureSize(F){this._ensureSize(F)}writeF32(F){this._ensureSize(1);const B=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=F,this._pos++,B}push(F){this._ensureSize(1);const B=this._pos;return this._buffer[this._pos++]=F,B}writeFixed(F){this._buffer[this._pos++]=F}setValue(F,B){this._buffer[F]=B}i1616Add(F,B,Q){this._i16View[2*F]+=B,this._i16View[2*F+1]+=Q}getValue(F){return this._buffer[F]}incr(F){if(this._buffer.length<F)throw new Error("Increment index overflows the target buffer");this._buffer[F]++}decr(F){this._buffer[F]--}writeRegion(F){this._ensureSize(F.length);const B=this._pos;return this._buffer.set(F,this._pos),this._pos+=F.length,B}writeManyFrom(F,B,Q){this._ensureSize(Q-B);for(let J=B;J!==Q;J++)this.writeFixed(F._buffer[J])}buffer(){const F=this._array.slice(0,4*this._pos);return this.destroy(),F}toArray(){const F=this._array,B=[];for(let Q=0;Q<F.byteLength/4;Q++)B.push(F[Q]);return B}seek(F){this._pos=F}destroy(){this._array=null,this._buffer=null}}},55376:(Tt,dt,d)=>{function ct(F,B,Q,J){const A=F.clone(),k=1<<A.level,H=A.col+B,V=A.row+Q;return J&&H<0?(A.col=H+k,A.world-=1):H>=k?(A.col=H-k,A.world+=1):A.col=H,A.row=V,A}d.d(dt,{M:()=>ct}),d(81340)},32954:(Tt,dt,d)=>{function Y(ot){const ct=new Array(ot.length);for(let F=0;F<ot.length;F++)ct[F]=ot.charCodeAt(F);return ct}d.d(dt,{_:()=>Y})}}]);