"use strict";(self.webpackChunkesri4_pwa=self.webpackChunkesri4_pwa||[]).push([[5207],{90301:(L,P,t)=>{t.d(P,{eY:()=>A});var e=t(62208),p=t(30217),O=t(49966),y=t(9545),h=t(57477),l=t(14403),M=t(67969),B=t(55086);function D(d,a,i){const v={target:M.No.TEXTURE_2D,pixelFormat:M.VI.RGBA,internalFormat:M.VI.RGBA,dataType:M.Br.UNSIGNED_BYTE,wrapMode:M.e8.CLAMP_TO_EDGE};return a&&i&&(v.width=a,v.height=i),new B.x(d,v)}class A extends h.s{constructor(a=null,i,v=!0){super(),this.requestRenderOnSourceChangedEnabled=v,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=i,this.source=a,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(a){this._height=a}get source(){return this._source}set source(a){this._source=a,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(a){this._width=a}beforeRender(a){super.beforeRender(a),this.updateTexture(a.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:(0,O.c)()}}setTransform(a){const i=(0,p.b)(this.transforms.dvs),[v,m]=a.toScreenNoRotation([0,0],[this.x,this.y]),z=this.resolution/this.pixelRatio/a.resolution,w=z*this.width,W=z*this.height,H=Math.PI*this.rotation/180;(0,p.c)(i,i,(0,y.f)(v,m)),(0,p.c)(i,i,(0,y.f)(w/2,W/2)),(0,p.r)(i,i,-H),(0,p.c)(i,i,(0,y.f)(-w/2,-W/2)),(0,p.j)(i,i,(0,y.f)(w,W)),(0,p.m)(this.transforms.dvs,a.displayViewMat3,i)}setSamplingProfile(a){this._texture&&(a.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(a.samplingMode))}bind(a,i){this._texture&&a.bindTexture(this._texture,i)}updateTexture(a){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this._texture=this.source?D(a,this.sourceWidth,this.sourceHeight):D(a));const v=this.source;if(v){if(this._texture.resize(this.sourceWidth,this.sourceHeight),function R(d){return d&&"render"in d}(v))if(v instanceof l.Z){const m=v.getRenderedRasterPixels();this._texture.setData((0,e.pC)(m)?m.renderedRasterPixels:null)}else this._texture.setData(function U(d){const a=document.createElement("canvas");return a.width=d.width,a.height=d.height,d.render(a.getContext("2d")),a}(v));else(function C(d){return d&&!("render"in d)})(v)&&this._texture.setData(v);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},91757:(L,P,t)=>{t.d(P,{c:()=>y});var e=t(77598),p=t(39406),O=t(44589);class y extends O.Z{get requiresDedicatedFBO(){return this.children.some(l=>"additive"===l.blendFunction)}prepareRenderPasses(l){const M=l.registerRenderPass({name:"bitmap",brushes:[e.U.bitmap],target:()=>this.children,drawPhase:p.jx.MAP});return[...super.prepareRenderPasses(l),M]}}},14403:(L,P,t)=>{t.d(P,{Z:()=>p});var e=t(62208);class p{constructor(y,h,l){this.pixelBlock=y,this.extent=h,this.originalPixelBlock=l}get width(){return(0,e.pC)(this.pixelBlock)?this.pixelBlock.width:0}get height(){return(0,e.pC)(this.pixelBlock)?this.pixelBlock.height:0}render(y){const h=this.pixelBlock;if((0,e.Wi)(h))return;const l=this.filter({pixelBlock:h});if((0,e.Wi)(l.pixelBlock))return;const M=l.pixelBlock.getAsRGBA(),B=y.createImageData(l.pixelBlock.width,l.pixelBlock.height);B.data.set(M),y.putImageData(B,0,0)}getRenderedRasterPixels(){const y=this.filter({pixelBlock:this.pixelBlock});return(0,e.Wi)(y.pixelBlock)?null:{width:y.pixelBlock.width,height:y.pixelBlock.height,renderedRasterPixels:new Uint8Array(y.pixelBlock.getAsRGBA().buffer)}}}},37384:(L,P,t)=>{t.d(P,{y:()=>_});var e=t(17626),p=t(48701),O=t(89726),y=t(26584),h=t(32917),l=t(77712),C=(t(85931),t(8314),t(90912),t(76898)),U=t(1011),D=t(86810);t(63290),t(82255);let a=class extends D.wq{};a=(0,e._)([(0,C.j)("esri.views.layers.support.ClipArea")],a);const i=a;var v;let m=v=class extends i{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new v({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,e._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"left",void 0),(0,e._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"right",void 0),(0,e._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"top",void 0),(0,e._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"bottom",void 0),(0,e._)([(0,l.Cb)({readOnly:!0})],m.prototype,"version",null),m=v=(0,e._)([(0,C.j)("esri.views.layers.support.ClipRect")],m);const z=m;t(29132);var K,W=t(21674),H=t(91179),S=t(2004),b=t(37118);const j={base:W.Z,key:"type",typeMap:{extent:S.Z,polygon:b.Z}};let f=K=class extends i{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new K({geometry:this.geometry.clone()})}};(0,e._)([(0,l.Cb)({types:j,json:{read:H.im,write:!0}})],f.prototype,"geometry",void 0),(0,e._)([(0,l.Cb)({readOnly:!0})],f.prototype,"version",null),f=K=(0,e._)([(0,C.j)("esri.views.layers.support.Geometry")],f);const Y=f;let n=class extends i{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,e._)([(0,l.Cb)({type:[[[Number]]],json:{write:!0}})],n.prototype,"path",void 0),(0,e._)([(0,l.Cb)({readOnly:!0})],n.prototype,"version",null),n=(0,e._)([(0,C.j)("esri.views.layers.support.Path")],n);const E=p.Z.ofType({key:"type",base:i,typeMap:{rect:z,path:n,geometry:Y}}),_=g=>{let r=class extends g{constructor(){super(...arguments),this.attached=!1,this.clips=new E,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1}initialize(){var o,u,c,T;const V=null==(o=null==(u=this.view)?void 0:u.spatialReferenceLocked)||o;(null==(c=this.view)?void 0:c.spatialReference)&&V&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new y.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new U.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,h.YP)(()=>this.suspended,x=>{this.container&&(this.container.visible=!x),this.view&&!x&&this.updateRequested&&this.view.requestUpdate()},h.tX),(0,h.YP)(()=>{var x,Z;return null!=(x=null==(Z=this.layer)?void 0:Z.opacity)?x:1},x=>{this.container&&(this.container.opacity=x)},h.tX),(0,h.YP)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",x=>{this.container&&(this.container.blendMode=x)},h.tX),(0,h.YP)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,x=>{this.container&&(this.container.effect=x)},h.tX),(0,h.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),null!=(T=this.view)&&T.whenLayerView?this.view.whenLayerView(this.layer).then(x=>{x===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var o;const u=null==(o=this.view)?void 0:o.spatialReference;return null==u||this.supportsSpatialReference(u)}get updating(){var o;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null==(o=this.updatingHandles)||!o.updating))}get visibleAtCurrentScale(){return this.isVisibleAtScale(this.view.scale)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)}isVisibleAtScale(o){const u=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!u)return!0;const{minScale:c,maxScale:T}=u;return(0===c||o<=c)&&(0===T||o>=T)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(o){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",o),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(o))):this.updateRequested=!1}hitTest(o,u){return Promise.resolve(null)}supportsSpatialReference(o){return!0}isUpdating(){return!1}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const o=super.getSuspendInfo(),u=!this.spatialReferenceSupported,c=this.visibleAtCurrentScale;return u&&(o.spatialReferenceNotSupported=u),c&&(o.outsideScaleRange=c),o}};return(0,e._)([(0,l.Cb)()],r.prototype,"attached",void 0),(0,e._)([(0,l.Cb)({type:E,set(o){const u=(0,O.Z)(o,this._get("clips"),E);this._set("clips",u)}})],r.prototype,"clips",void 0),(0,e._)([(0,l.Cb)()],r.prototype,"container",void 0),(0,e._)([(0,l.Cb)()],r.prototype,"moving",void 0),(0,e._)([(0,l.Cb)({readOnly:!0})],r.prototype,"spatialReferenceSupported",null),(0,e._)([(0,l.Cb)({readOnly:!0})],r.prototype,"updateParameters",void 0),(0,e._)([(0,l.Cb)()],r.prototype,"updateRequested",void 0),(0,e._)([(0,l.Cb)()],r.prototype,"updating",null),(0,e._)([(0,l.Cb)()],r.prototype,"view",void 0),(0,e._)([(0,l.Cb)({readOnly:!0})],r.prototype,"visibleAtCurrentScale",null),r=(0,e._)([(0,C.j)("esri.views.2d.layers.LayerView2D")],r),r}},67802:(L,P,t)=>{t.d(P,{Z:()=>Y});var e=t(15861),p=t(17626),O=t(14517),y=t(10699),h=t(77712),R=(t(85931),t(8314),t(90912),t(76898)),C=t(2004),U=t(65401),D=t(37053),A=t(2584);const d=Math.PI/180;var w=t(90301),W=t(9598),H=t(58098);const S=(0,U.Ue)(),b=[0,0],K=new H.Z(0,0,0,0);let f=class extends O.Z{constructor(n){var s;super(n),s=this,this._imagePromise=null,this.bitmaps=[],this.hidpi=false,this.imageMaxWidth=2048,this.imageMaxHeight=2048,this.imageRotationSupported=false,this.imageNormalizationSupported=false,this.update=(0,y.Ds)(function(){var E=(0,e.Z)(function*(_,g){if(!_.stationary||s.destroyed)return null;const r=_.state,o=(0,D.C5)(r.spatialReference),u=s.hidpi?_.pixelRatio:1,c=s.imageNormalizationSupported&&r.worldScreenWidth&&r.worldScreenWidth<r.size[0];c?(b[0]=r.worldScreenWidth,b[1]=r.size[1]):s.imageRotationSupported?(b[0]=r.size[0],b[1]=r.size[1]):function v(n,s){const E=function a(n){return n*d}(s.rotation),_=Math.abs(Math.cos(E)),g=Math.abs(Math.sin(E)),[r,o]=s.size;return n[0]=Math.round(o*g+r*_),n[1]=Math.round(o*_+r*g),n}(b,r);const T=Math.floor(b[0]*u)>s.imageMaxWidth||Math.floor(b[1]*u)>s.imageMaxHeight,x=!s.imageNormalizationSupported&&o&&(r.extent.xmin<o.valid[0]||r.extent.xmax>o.valid[1]),F=s.imageRotationSupported?r.rotation:0;if(T||x){let I=Math.min(s.imageMaxWidth,s.imageMaxHeight);x&&(I=Math.min(r.worldScreenWidth,I)),s._imagePromise=s._tiledExport(r,I,F,u,g)}else s._imagePromise=s._singleExport(r,b,c?r.paddedViewState.center:r.center,r.resolution,F,u,g);return s._imagePromise.then(function(){var I=(0,e.Z)(function*(G){if(s._imagePromise=null,!s.destroyed){s.bitmaps=null!=G?G:[];for(const N of s.container.children)G.includes(N)||N.fadeOut().then(()=>{N.remove()});for(const N of G)s.container.addChild(N),N.fadeIn()}});return function(G){return I.apply(this,arguments)}}()).catch(I=>{throw s._imagePromise=null,I})});return function(_,g){return E.apply(this,arguments)}}(),5e3)}destroy(){this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}updateExports(n){for(const s of this.container.children){if(!s.visible||!s.stage)return;n(s),s.invalidateTexture(),s.requestRender()}}_export(n,s,E,_,g,r){var o=this;return(0,e.Z)(function*(){const u=yield o.fetchSource(n,Math.floor(s*g),Math.floor(E*g),{rotation:_,pixelRatio:g,signal:r}),c=new w.eY(u,"additive");return c.x=n.xmin,c.y=n.ymax,c.resolution=n.width/s,c.rotation=_,c.pixelRatio=g,c})()}_singleExport(n,s,E,_,g,r,o){var u=this;return(0,e.Z)(function*(){!function m(n,s,E,_){const[g,r]=s,[o,u]=_,c=.5*E;n[0]=g-c*o,n[1]=r-c*u,n[2]=g+c*o,n[3]=r+c*u}(S,E,_,s);const c=new C.Z(S[0],S[1],S[2],S[3],n.spatialReference);return[yield u._export(c,s[0],s[1],g,r,o)]})()}_tiledExport(n,s,E,_,g){const r=A.Z.create({size:s,spatialReference:n.spatialReference,scales:[n.scale]}),o=new W.Z(r),u=o.getTileCoverage(n);if(!u)return null;const c=[];return u.forEach((T,V,x,Z)=>{K.set(T,V,x,Z),o.getTileBounds(S,K);const F=new C.Z(S[0],S[1],S[2],S[3],n.spatialReference);c.push(this._export(F,s,s,E,_,g))}),Promise.all(c)}};(0,p._)([(0,h.Cb)()],f.prototype,"_imagePromise",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"bitmaps",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"container",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"fetchSource",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"hidpi",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"imageMaxWidth",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"imageMaxHeight",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"imageRotationSupported",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"imageNormalizationSupported",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"requestUpdate",void 0),(0,p._)([(0,h.Cb)()],f.prototype,"updating",null),f=(0,p._)([(0,R.j)("esri.views.2d.layers.support.ExportStrategy")],f);const Y=f},45611:(L,P,t)=>{t.d(P,{Z:()=>a});var e=t(17626),p=t(14517),O=t(61885),y=t(80542),h=t(61996),l=t(63290),M=t(62208),B=t(60330),R=t(77712),A=(t(85931),t(8314),t(90912),t(76898));let d=class extends((0,y.p)((0,h.I)((0,B.v)(O.Z.EventedMixin(p.Z))))){constructor(i){super(i),this.layer=null,this.parent=null}initialize(){this.when().catch(i=>{if("layerview:create-error"!==i.name){const v=this.layer&&this.layer.id||"no id",m=this.layer&&this.layer.title||"no title";throw l.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${m}', id: '${v}')`,i),i}})}get fullOpacity(){return(0,M.Pt)(this.get("layer.opacity"),1)*(0,M.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){var i;return!!(null!=(i=this.updatingHandles)&&i.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var i;return!0===(null==(i=this.layer)?void 0:i.visible)}set visible(i){void 0!==i?this._override("visible",i):this._clearOverride("visible")}canResume(){var i,v,m;return this.visible&&(null==(i=this.layer)?void 0:i.loaded)&&!(null!=(v=this.parent)&&v.suspended)&&(null==(m=this.view)?void 0:m.ready)||!1}getSuspendInfo(){const i=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,e._)([(0,R.Cb)()],d.prototype,"fullOpacity",null),(0,e._)([(0,R.Cb)()],d.prototype,"layer",void 0),(0,e._)([(0,R.Cb)()],d.prototype,"parent",void 0),(0,e._)([(0,R.Cb)({readOnly:!0})],d.prototype,"suspended",null),(0,e._)([(0,R.Cb)({readOnly:!0})],d.prototype,"suspendInfo",null),(0,e._)([(0,R.Cb)({readOnly:!0})],d.prototype,"legendEnabled",null),(0,e._)([(0,R.Cb)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),(0,e._)([(0,R.Cb)({readOnly:!0})],d.prototype,"updatingProgress",null),(0,e._)([(0,R.Cb)()],d.prototype,"visible",null),(0,e._)([(0,R.Cb)()],d.prototype,"view",void 0),d=(0,e._)([(0,A.j)("esri.views.layers.LayerView")],d);const a=d},94421:(L,P,t)=>{t.d(P,{y:()=>C});var e=t(17626),p=t(63290),O=t(10699),y=t(32917),h=t(77712),R=(t(85931),t(8314),t(90912),t(76898));const C=U=>{let D=class extends U{initialize(){this.handles.add((0,y.on)(()=>this.layer,"refresh",A=>{this.doRefresh(A.dataChanged).catch(d=>{(0,O.D_)(d)||p.Z.getLogger(this.declaredClass).error(d)})}),"RefreshableLayerView")}};return(0,e._)([(0,h.Cb)()],D.prototype,"layer",void 0),D=(0,e._)([(0,R.j)("esri.layers.mixins.RefreshableLayerView")],D),D}}}]);