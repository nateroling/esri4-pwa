"use strict";(self.webpackChunkesri4_pwa=self.webpackChunkesri4_pwa||[]).push([[2900],{90301:(v,x,t)=>{t.d(x,{eY:()=>p});var m=t(62208),l=t(30217),R=t(49966),h=t(9545),g=t(57477),d=t(14403),_=t(67969),o=t(55086);function c(s,e,n){const u={target:_.No.TEXTURE_2D,pixelFormat:_.VI.RGBA,internalFormat:_.VI.RGBA,dataType:_.Br.UNSIGNED_BYTE,wrapMode:_.e8.CLAMP_TO_EDGE};return e&&n&&(u.width=e,u.height=n),new o.x(s,u)}class p extends g.s{constructor(e=null,n,u=!0){super(),this.requestRenderOnSourceChangedEnabled=u,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=n,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){this._source=e,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:(0,R.c)()}}setTransform(e){const n=(0,l.b)(this.transforms.dvs),[u,f]=e.toScreenNoRotation([0,0],[this.x,this.y]),P=this.resolution/this.pixelRatio/e.resolution,I=P*this.width,E=P*this.height,y=Math.PI*this.rotation/180;(0,l.c)(n,n,(0,h.f)(u,f)),(0,l.c)(n,n,(0,h.f)(I/2,E/2)),(0,l.r)(n,n,-y),(0,l.c)(n,n,(0,h.f)(-I/2,-E/2)),(0,l.j)(n,n,(0,h.f)(I,E)),(0,l.m)(this.transforms.dvs,e.displayViewMat3,n)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,n){this._texture&&e.bindTexture(this._texture,n)}updateTexture(e){var n;if(!this.stage)return null==(n=this._texture)||n.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this._texture=this.source?c(e,this.sourceWidth,this.sourceHeight):c(e));const u=this.source;if(u){if(this._texture.resize(this.sourceWidth,this.sourceHeight),function r(s){return s&&"render"in s}(u))if(u instanceof d.Z){const f=u.getRenderedRasterPixels();this._texture.setData((0,m.pC)(f)?f.renderedRasterPixels:null)}else this._texture.setData(function i(s){const e=document.createElement("canvas");return e.width=s.width,e.height=s.height,s.render(e.getContext("2d")),e}(u));else(function a(s){return s&&!("render"in s)})(u)&&this._texture.setData(u);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},71379:(v,x,t)=>{t.d(x,{s:()=>r});var m=t(65401),l=t(49966),R=t(90301),h=t(43783);class g extends h.I{constructor(i,c,p,s,e,n=null){super(i,c,p,s,e),this.bitmap=new R.eY(n,"standard",!1),this.bitmap.coordScale=[s,e],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(i){super.beforeRender(i),this.bitmap.beforeRender(i)}afterRender(i){super.afterRender(i),this.bitmap.afterRender(i)}set stencilRef(i){this.bitmap.stencilRef=i}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{dvs:(0,l.c)(),tileMat3:(0,l.c)()}}setTransform(i,c){super.setTransform(i,c),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}var d=t(77598),_=t(39406),o=t(26268);class r extends o.Z{get requiresDedicatedFBO(){return this.children.some(i=>"additive"===i.bitmap.blendFunction)}createTile(i){const c=this._tileInfoView.getTileBounds((0,m.Ue)(),i),[p,s]=this._tileInfoView.tileInfo.size;return new g(i,c[0],c[3],p,s)}prepareRenderPasses(i){const c=i.registerRenderPass({name:"bitmap (tile)",brushes:[d.U.bitmap],target:()=>this.children.map(p=>p.bitmap),drawPhase:_.jx.MAP});return[...super.prepareRenderPasses(i),c]}doRender(i){this.visible&&i.drawPhase===_.jx.MAP&&super.doRender(i)}}},14403:(v,x,t)=>{t.d(x,{Z:()=>l});var m=t(62208);class l{constructor(h,g,d){this.pixelBlock=h,this.extent=g,this.originalPixelBlock=d}get width(){return(0,m.pC)(this.pixelBlock)?this.pixelBlock.width:0}get height(){return(0,m.pC)(this.pixelBlock)?this.pixelBlock.height:0}render(h){const g=this.pixelBlock;if((0,m.Wi)(g))return;const d=this.filter({pixelBlock:g});if((0,m.Wi)(d.pixelBlock))return;const _=d.pixelBlock.getAsRGBA(),o=h.createImageData(d.pixelBlock.width,d.pixelBlock.height);o.data.set(_),h.putImageData(o,0,0)}getRenderedRasterPixels(){const h=this.filter({pixelBlock:this.pixelBlock});return(0,m.Wi)(h.pixelBlock)?null:{width:h.pixelBlock.width,height:h.pixelBlock.height,renderedRasterPixels:new Uint8Array(h.pixelBlock.getAsRGBA().buffer)}}}},26268:(v,x,t)=>{t.d(x,{Z:()=>_});var m=t(8314),l=t(39406),R=t(44589),h=t(29384),g=t(13382);const d=(o,r)=>o.key.level-r.key.level!=0?o.key.level-r.key.level:o.key.row-r.key.row!=0?o.key.row-r.key.row:o.key.col-r.key.col;class _ extends R.Z{constructor(r){super(),this._tileInfoView=r}get requiresDedicatedFBO(){return!1}renderChildren(r){this.sortChildren(d),this.setStencilReference(r),super.renderChildren(r)}createRenderParams(r){const{state:a}=r,i=super.createRenderParams(r);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(a.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(a.scale),i}prepareRenderPasses(r){const a=super.prepareRenderPasses(r);return a.push(r.registerRenderPass({name:"stencil",brushes:[g.Z],drawPhase:l.jx.DEBUG|l.jx.MAP|l.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,m.Z)("esri-tiles-debug")&&a.push(r.registerRenderPass({name:"tileInfo",brushes:[h.Z],drawPhase:l.jx.DEBUG,target:()=>this.children})),a}getStencilTarget(){return this.children}updateTransforms(r){for(const a of this.children){const i=this._tileInfoView.getTileResolution(a.key);a.setTransform(r,i)}}setStencilReference(r){let a=1;for(const i of this.children)i.stencilRef=a++}}},43783:(v,x,t)=>{t.d(x,{I:()=>h});var m=t(30217),l=t(57477),R=t(58098);class h extends l.s{constructor(d,_,o,r,a,i=r,c=a){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new R.Z(d),this.x=_,this.y=o,this.width=r,this.height=a,this.rangeX=i,this.rangeY=c}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(d,_){const o=_/(d.resolution*d.pixelRatio),r=this.transforms.tileMat3,[a,i]=d.toScreenNoRotation([0,0],[this.x,this.y]);(0,m.s)(r,this.width/this.rangeX*o,0,0,0,this.height/this.rangeY*o,0,a,i,1),(0,m.m)(this.transforms.dvs,d.displayViewMat3,r)}}},32900:(v,x,t)=>{t.r(x),t.d(x,{default:()=>p});var m=t(17626),_=(t(63290),t(90912),t(85931),t(8314),t(82255),t(76898)),o=t(36859),r=t(71379),a=t(84225);class i{constructor(){this.gradient=null,this.height=512,this.width=512}render(e){(0,o.hy)(e,512,this.intensities,this.gradient,this.minPixelIntensity,this.maxPixelIntensity)}}let c=class extends a.Z{constructor(s){super(s),this._intensityInfo={minPixelIntensity:0,maxPixelIntensity:0},this.featuresView={attributeView:{initialize:()=>{},requestUpdate:()=>{}},requestRender:()=>{}},this._container=new r.s(s.tileInfoView)}createTile(s){const e=this._container.createTile(s);return this.tileInfoView.getTileCoords(e.bitmap,s),e.bitmap.resolution=this.tileInfoView.getTileResolution(s),e}onConfigUpdate(){const s=this.layer.renderer;if("heatmap"===s.type){const{minPixelIntensity:e,maxPixelIntensity:n}=s;this._intensityInfo.minPixelIntensity=e,this._intensityInfo.maxPixelIntensity=n,this._gradient=(0,o.uI)(s.colorStops),this.tiles.forEach(u=>{const f=u.bitmap.source;f&&(f.minPixelIntensity=e,f.maxPixelIntensity=n,f.gradient=this._gradient,u.bitmap.invalidateTexture())})}}hitTest(){return Promise.resolve([])}install(s){s.addChild(this._container)}uninstall(s){this._container.removeAllChildren(),s.removeChild(this._container)}disposeTile(s){this._container.removeChild(s),s.destroy()}supportsRenderer(s){return s&&"heatmap"===s.type}onTileData(s){const e=this.tiles.get(s.tileKey);if(!e)return;const n=s.intensityInfo,{minPixelIntensity:u,maxPixelIntensity:f}=this._intensityInfo,P=e.bitmap.source||new i;P.intensities=n&&n.matrix||null,P.minPixelIntensity=u,P.maxPixelIntensity=f,P.gradient=this._gradient,e.bitmap.source=P,this._container.addChild(e),this._container.requestRender(),this.requestUpdate()}onTileError(s){console.error(s)}lockGPUUploads(){}unlockGPUUploads(){}fetchResource(s,e){return console.error(s),Promise.reject()}};c=(0,m._)([(0,_.j)("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],c);const p=c}}]);