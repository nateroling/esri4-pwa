"use strict";var re=Object.defineProperty,se=Object.defineProperties,ie=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,te=(O,g,u)=>g in O?re(O,g,{enumerable:!0,configurable:!0,writable:!0,value:u}):O[g]=u,Q=(O,g)=>{for(var u in g||(g={}))oe.call(g,u)&&te(O,u,g[u]);if(ee)for(var u of ee(g))ae.call(g,u)&&te(O,u,g[u]);return O},ne=(O,g)=>se(O,ie(g));(self.webpackChunkesri4_pwa=self.webpackChunkesri4_pwa||[]).push([[4079],{84079:(O,g,u)=>{u.r(g),u.d(g,{default:()=>V});var h=u(15861),G=u(84792),R=u(26584),U=u(63290),x=u(62208),M=u(10699),L=u(91179),v=u(37053),b=u(82054),K=u(82708),y=u(82959),I=u(38330),j=u(58775),A=u(56554),f=u(35775),N=u(60466),k=u(85),z=u(36630);const J={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};class V{constructor(){var s=this;this._queryEngine=null,this._snapshotFeatures=function(){var i=(0,h.Z)(function*(r){const a=yield s._fetch(r);return s._createFeatures(a)});return function(r){return i.apply(this,arguments)}}()}destroy(){var s;null==(s=this._queryEngine)||s.destroy(),this._queryEngine=this._fieldsIndex=this._createDefaultAttributes=null}load(s,i={}){var r=this;return(0,h.Z)(function*(){r.loadOptions={url:s.url,customParameters:s.customParameters};const a=[];yield r._checkProjection(s.spatialReference);let d=null;s.url&&(d=yield r._fetch(null==i?void 0:i.signal));const c=(0,j.my)(d,{geometryType:s.geometryType}),_=s.fields||c.fields||[],E=null!=s.hasZ?s.hasZ:c.hasZ,P=c.geometryType,e=s.objectIdField||c.objectIdFieldName||"__OBJECTID",t=s.spatialReference||v.Zn;let n=s.timeInfo;_===c.fields&&c.unknownFields.length>0&&a.push({name:"geojson-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:c.unknownFields}});let o=_.find(l=>l.name===e);o?("esriFieldTypeString"!==o.type&&(o.type="esriFieldTypeOID"),o.editable=!1,o.nullable=!1):(o={alias:e,name:e,type:"string"===c.objectIdFieldType?"esriFieldTypeString":"esriFieldTypeOID",editable:!1,nullable:!1},_.unshift(o));const p={};for(const l of _){if(null==l.name&&(l.name=l.alias),null==l.alias&&(l.alias=l.name),!l.name)throw new R.Z("geojson-layer:invalid-field-name","field name is missing",{field:l});if(!k.v.jsonValues.includes(l.type))throw new R.Z("geojson-layer:invalid-field-type",`invalid type for field "${l.name}"`,{field:l});if(l.name!==o.name){const C=(0,z.os)(l);void 0!==C&&(p[l.name]=C)}}r._fieldsIndex=new N.Z(_);const S=r._fieldsIndex.requiredFields.indexOf(o);if(S>-1&&r._fieldsIndex.requiredFields.splice(S,1),n){if(n.startTimeField){const l=r._fieldsIndex.get(n.startTimeField);l?(n.startTimeField=l.name,l.type="esriFieldTypeDate"):n.startTimeField=null}if(n.endTimeField){const l=r._fieldsIndex.get(n.endTimeField);l?(n.endTimeField=l.name,l.type="esriFieldTypeDate"):n.endTimeField=null}if(n.trackIdField){const l=r._fieldsIndex.get(n.trackIdField);l?n.trackIdField=l.name:(n.trackIdField=null,a.push({name:"geojson-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:n}}))}n.startTimeField||n.endTimeField||(a.push({name:"geojson-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:n}}),n=null)}const F=P?(0,A.bU)(P):null,m={warnings:a,featureErrors:[],layerDefinition:ne(Q({},J),{drawingInfo:F,templates:(0,A.Hq)(p),extent:null,geometryType:P,objectIdField:e,fields:_,hasZ:!!E,timeInfo:n})};r._queryEngine=new I.Z({fields:_,geometryType:P,hasM:!1,hasZ:E,objectIdField:e,spatialReference:t,timeInfo:n,featureStore:new K.Z({geometryType:P,hasM:!1,hasZ:E}),cacheSpatialQueries:!0}),r._createDefaultAttributes=(0,A.Dm)(p,e);const D=yield r._createFeatures(d);r._objectIdGenerator=r._createObjectIdGenerator(r._queryEngine,D);const T=r._normalizeFeatures(D,m.warnings,m.featureErrors);if(r._queryEngine.featureStore.addMany(T),m.layerDefinition.extent=r._queryEngine.fullExtent,m.layerDefinition.timeInfo){const{start:l,end:C}=r._queryEngine.timeExtent;m.layerDefinition.timeInfo.timeExtent=[l,C]}return m})()}applyEdits(s){var i=this;return(0,h.Z)(function*(){const{spatialReference:r,geometryType:a}=i._queryEngine;return yield Promise.all([(0,f.b)(r,a),(0,y._W)(s.adds,r),(0,y._W)(s.updates,r)]),yield i._waitSnapshotComplete(),i._applyEdits(s)})()}queryFeatures(s={},i={}){var r=this;return(0,h.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQuery(s,i.signal)})()}queryFeatureCount(s={},i={}){var r=this;return(0,h.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQueryForCount(s,i.signal)})()}queryObjectIds(s={},i={}){var r=this;return(0,h.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQueryForIds(s,i.signal)})()}queryExtent(s={},i={}){var r=this;return(0,h.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQueryForExtent(s,i.signal)})()}querySnapping(s,i={}){var r=this;return(0,h.Z)(function*(){return yield r._waitSnapshotComplete(),r._queryEngine.executeQueryForSnapping(s,i.signal)})()}refresh(s){var i=this;return(0,h.Z)(function*(){var r;return i.loadOptions.customParameters=s,null==(r=i._snapshotTask)||r.abort(),i._snapshotTask=(0,M.vr)(i._snapshotFeatures),i._snapshotTask.promise.then(a=>{i._queryEngine.featureStore.clear(),i._objectIdGenerator=i._createObjectIdGenerator(i._queryEngine,a);const d=i._normalizeFeatures(a);d&&i._queryEngine.featureStore.addMany(d)},a=>{i._queryEngine.featureStore.clear(),(0,M.D_)(a)||U.Z.getLogger("esri.layers.GeoJSONLayer").error(new R.Z("geojson-layer:refresh","An error occurred during refresh",{error:a}))}),yield i._waitSnapshotComplete(),{extent:i._queryEngine.fullExtent,timeExtent:i._queryEngine.timeExtent}})()}_createFeatures(s){var i=this;return(0,h.Z)(function*(){const{geometryType:r,hasZ:a,objectIdField:d}=i._queryEngine,c=(0,j.lG)(s,{geometryType:r,hasZ:a,objectIdField:d});if(!(0,v.fS)(i._queryEngine.spatialReference,v.Zn))for(const _ of c)(0,x.pC)(_.geometry)&&(_.geometry=(0,b.GH)((0,y.iV)((0,b.di)(_.geometry,i._queryEngine.geometryType,i._queryEngine.hasZ,!1),v.Zn,i._queryEngine.spatialReference)));return c})()}_waitSnapshotComplete(){var s=this;return(0,h.Z)(function*(){if(s._snapshotTask&&!s._snapshotTask.finished){try{yield s._snapshotTask.promise}catch(i){}return s._waitSnapshotComplete()}})()}_fetch(s){var i=this;return(0,h.Z)(function*(){const{url:r,customParameters:a}=i.loadOptions,d=(yield(0,G.default)(r,{responseType:"json",query:Q({},a),signal:s})).data;return yield(0,j.O3)(d),d})()}_normalizeFeatures(s,i,r){const{objectIdField:a}=this._queryEngine,d=[];for(const c of s){const _=this._createDefaultAttributes(),E=(0,f.O0)(this._fieldsIndex,_,c.attributes,!0,i);E?null==r||r.push(E):(this._assignObjectId(_,c.attributes,!0),c.attributes=_,c.objectId=_[a],d.push(c))}return d}_applyEdits(s){const{adds:i,updates:r,deletes:a}=s,d={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(i&&i.length&&this._applyAddEdits(d,i),r&&r.length&&this._applyUpdateEdits(d,r),a&&a.length){for(const c of a)d.deleteResults.push((0,f.d1)(c));this._queryEngine.featureStore.removeManyById(a)}return{extent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent,featureEditResults:d}}_applyAddEdits(s,i){const{addResults:r}=s,{geometryType:a,hasM:d,hasZ:c,objectIdField:_,spatialReference:E,featureStore:P}=this._queryEngine,e=[];for(const t of i){if(t.geometry&&a!==(0,L.Ji)(t.geometry)){r.push((0,f.av)("Incorrect geometry type."));continue}const n=this._createDefaultAttributes(),o=(0,f.O0)(this._fieldsIndex,n,t.attributes);o?r.push(o):(this._assignObjectId(n,t.attributes),t.attributes=n,null!=t.uid&&(s.uidToObjectId[t.uid]=t.attributes[_]),(0,x.pC)(t.geometry)&&(t.geometry=(0,y.iV)((0,f.og)(t.geometry,E),t.geometry.spatialReference,E)),e.push(t),r.push((0,f.d1)(t.attributes[_])))}P.addMany((0,b.Yn)([],e,a,c,d,_))}_applyUpdateEdits({updateResults:s},i){const{geometryType:r,hasM:a,hasZ:d,objectIdField:c,spatialReference:_,featureStore:E}=this._queryEngine;for(const P of i){const{attributes:e,geometry:t}=P,n=e&&e[c];if(null==n){s.push((0,f.av)(`Identifier field ${c} missing`));continue}if(!E.has(n)){s.push((0,f.av)(`Feature with object id ${n} missing`));continue}const o=(0,b.EI)(E.getFeature(n),r,d,a);if((0,x.pC)(t)){if(r!==(0,L.Ji)(t)){s.push((0,f.av)("Incorrect geometry type."));continue}o.geometry=(0,y.iV)((0,f.og)(t,_),t.spatialReference,_)}if(e){const p=(0,f.O0)(this._fieldsIndex,o.attributes,e);if(p){s.push(p);continue}}E.add((0,b.XA)(o,r,d,a,c)),s.push((0,f.d1)(n))}}_createObjectIdGenerator(s,i){const r=s.fieldsIndex.get(s.objectIdField);if("esriFieldTypeString"===r.type)return()=>r.name+"-"+Date.now().toString(16);let a=Number.NEGATIVE_INFINITY;for(const d of i)d.objectId&&(a=Math.max(a,d.objectId));return a=Math.max(0,a)+1,()=>a++}_assignObjectId(s,i,r=!1){const a=this._queryEngine.objectIdField;s[a]=r&&a in i?i[a]:this._objectIdGenerator()}_checkProjection(s){return(0,h.Z)(function*(){try{yield(0,y._W)(v.Zn,s)}catch(i){throw new R.Z("geojson-layer","Projection not supported")}})()}}},58775:(O,g,u)=>{u.d(g,{lG:()=>P,q9:()=>M,my:()=>E,O3:()=>_});var h=u(26584),G=u(66385),R=u(88071),U=u(36630);const x={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function M(e){return x[e]}function*L(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*v(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const n of t)yield*n}}function K(e){for(const t of e)if(t.length>2)return!0;return!1}function j(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],p=e[(n+1)%e.length];t+=o[0]*p[1]-p[0]*o[1]}return t<=0}function A(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function f(e,t,n){switch(t.type){case"LineString":return function N(e,t,n){return r(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function k(e,t,n){for(const o of t.coordinates)r(e,o,n);return e}(e,t,n);case"MultiPoint":return function z(e,t,n){return r(e,t.coordinates,n),e}(e,t,n);case"MultiPolygon":return function J(e,t,n){for(const o of t.coordinates){s(e,o[0],n);for(let p=1;p<o.length;p++)i(e,o[p],n)}return e}(e,t,n);case"Point":return function V(e,t,n){return d(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function H(e,t,n){const o=t.coordinates;s(e,o[0],n);for(let p=1;p<o.length;p++)i(e,o[p],n);return e}(e,t,n)}}function s(e,t,n){const o=A(t);!function y(e){return!j(e)}(o)?r(e,o,n):a(e,o,n)}function i(e,t,n){const o=A(t);!function I(e){return j(e)}(o)?r(e,o,n):a(e,o,n)}function r(e,t,n){for(const o of t)d(e,o,n);e.lengths.push(t.length)}function a(e,t,n){for(let o=t.length-1;o>=0;o--)d(e,t[o],n);e.lengths.push(t.length)}function d(e,t,n){const[o,p,S]=t;e.coords.push(o,p),n.hasZ&&e.coords.push(S||0)}function c(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function _(e){if(!e)throw new h.Z("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new h.Z("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const n="string"==typeof t?t:"name"===t.type?t.properties.name:"EPSG"===t.type?t.properties.code:null,o=new RegExp(".*(CRS84H?|4326)$","i");if(!n||!o.test(n))throw new h.Z("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function E(e,t={}){const n=[],o=new Set,p=new Set;let S,F=!1,m=null,D=!1,{geometryType:T=null}=t,l=!1;for(const q of L(e)){const{geometry:$,properties:w,id:B}=q;if((!$||(T||(T=M($.type)),M($.type)===T))&&(F||(F=K(v($))),D||(D=null!=B,D&&(S=typeof B,m=Object.keys(w).filter(W=>w[W]===B))),D&&null!=B&&(m.length>1?m=m.filter(W=>w[W]===B):1===m.length&&(m=w[m[0]]===B?m:[])),!l&&w)){let W=!0;for(const Z in w){if(o.has(Z))continue;const Y=w[Z];if(null==Y){W=!1,p.add(Z);continue}const X=c(Y);"unknown"!==X?(p.delete(Z),o.add(Z),n.push({name:Z,alias:Z,type:X})):p.add(Z)}l=W}}const C=m&&1===m.length&&m[0]||null;if(C)for(const q of n)if(q.name===C&&(0,U.H7)(q)){q.type="esriFieldTypeOID";break}return{fields:n,geometryType:T,hasZ:F,objectIdFieldName:C,objectIdFieldType:S,unknownFields:Array.from(p)}}function P(e,t){return Array.from(function*b(e,t={}){const{geometryType:n,objectIdField:o}=t;for(const S of e){var p;const{geometry:F,properties:m,id:D}=S;if(F&&M(F.type)!==n)continue;const T=m||{};let l=null!=(p=T[o])?p:null;o&&null!=D&&!T[o]&&(T[o]=l=D),yield new G.u_(F?f(new R.Z,F,t):null,T,null,l)}}(L(e),t))}},56554:(O,g,u)=>{u.d(g,{MS:()=>K,Dm:()=>v,Hq:()=>b,bU:()=>x});var h=u(8314),G=u(58817),R=u(87757),U=u(24837);function x(y){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===y||"esriGeometryMultipoint"===y?U.I4:"esriGeometryPolyline"===y?U.ET:U.lF}}}const M=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let L=1;function v(y,I){if((0,h.Z)("esri-csp-restrictions"))return()=>Q({[I]:null},y);try{let j=`this.${I} = null;`;for(const f in y)j+=`this${M.test(f)?`.${f}`:`["${f}"]`} = ${JSON.stringify(y[f])};`;const A=new Function(`\n      return class AttributesClass$${L++} {\n        constructor() {\n          ${j};\n        }\n      }\n    `)();return()=>new A}catch(j){return()=>Q({[I]:null},y)}}function b(y={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,G.d9)(y)}}]}function K(y,I){return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:y},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:I,supportsDelete:I,supportsEditing:I,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:I,supportsExceedsLimitStatistics:!0},query:R.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0},editing:{supportsGeometryUpdate:I,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}}}]);