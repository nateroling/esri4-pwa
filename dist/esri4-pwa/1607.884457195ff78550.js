"use strict";var De=Object.defineProperty,Le=Object.defineProperties,je=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertySymbols,Ne=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable,be=(Z,R,n)=>R in Z?De(Z,R,{enumerable:!0,configurable:!0,writable:!0,value:n}):Z[R]=n,q=(Z,R)=>{for(var n in R||(R={}))Ne.call(R,n)&&be(Z,n,R[n]);if(Ce)for(var n of Ce(R))Be.call(R,n)&&be(Z,n,R[n]);return Z},Y=(Z,R)=>Le(Z,je(R));(self.webpackChunkesri4_pwa=self.webpackChunkesri4_pwa||[]).push([[1607,9530],{68915:(Z,R,n)=>{n.r(R),n.d(R,{default:()=>Me});var o=n(15861),u=n(17626),D=n(88879),c=n(77712),p=(n(85931),n(8314)),I=(n(90912),n(76898));let O=class extends D.Z{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer&&this.sourceLayer.featureReduction;return t&&"popupTemplate"in t&&t.popupEnabled?t.popupTemplate:null}getObjectId(){return this.objectId}};(0,u._)([(0,c.Cb)({type:Boolean})],O.prototype,"isAggregate",void 0),(0,u._)([(0,c.Cb)({type:Number,json:{read:!0}})],O.prototype,"objectId",void 0),O=(0,u._)([(0,I.j)("esri.AggregateGraphic")],O);const L=O;n(29132);var N=n(48701),w=n(26584),x=n(58817),z=n(63290),l=n(62208),_=n(10699),b=n(32917),ie=n(14517),de=n(52884);let V=class extends ie.Z{constructor(e){super(e),this._filter=null,this.duration=(0,p.Z)("mapview-transitions-duration"),this._excludedEffectView=new de.AM(e),this._includedEffectView=new de.AM(e)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(e){this._get("featureEffect")!==e&&this._transitionTo(e)}get filter(){var e;return this._filter||(null==(e=(0,l.Wg)(this.featureEffect))?void 0:e.filter)||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}end(){this._includedEffectView.end(),this._excludedEffectView.end(),this._filter=null}_transitionTo(e){const t=this._get("featureEffect"),r=(0,l.Wg)(e),i=(0,l.Wg)(null==r?void 0:r.includedEffect),s=(0,l.Wg)(null==r?void 0:r.excludedEffect),a=this._includedEffectView.canTransitionTo(i)&&this._excludedEffectView.canTransitionTo(s);this._includedEffectView.effect=i,this._excludedEffectView.effect=s,this._set("featureEffect",r),this._filter=(null==r?void 0:r.filter)||(null==t?void 0:t.filter)||null,a||this.end()}};(0,u._)([(0,c.Cb)()],V.prototype,"_filter",void 0),(0,u._)([(0,c.Cb)()],V.prototype,"_excludedEffectView",void 0),(0,u._)([(0,c.Cb)()],V.prototype,"_includedEffectView",void 0),(0,u._)([(0,c.Cb)()],V.prototype,"duration",void 0),(0,u._)([(0,c.Cb)()],V.prototype,"excludedEffects",null),(0,u._)([(0,c.Cb)()],V.prototype,"featureEffect",null),(0,u._)([(0,c.Cb)()],V.prototype,"filter",null),(0,u._)([(0,c.Cb)()],V.prototype,"hasEffects",null),(0,u._)([(0,c.Cb)()],V.prototype,"includedEffects",null),(0,u._)([(0,c.Cb)({value:0})],V.prototype,"scale",null),(0,u._)([(0,c.Cb)()],V.prototype,"transitioning",null),V=(0,u._)([(0,I.j)("esri.layers.effects.FeatureEffectView")],V);const he=V;var se=n(98624),ne=n(17253),X=n(84952),ce=n(39351),Q=n(37384),pe=n(49391);function te(){return(te=(0,o.Z)(function*(e,t){if(!e)return null;switch(e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return new((yield Promise.all([n.e(7692),n.e(5314),n.e(5506),n.e(4821),n.e(4589),n.e(4056),n.e(8592),n.e(3036)]).then(n.bind(n,19268))).default)(t);case"heatmap":return new((yield Promise.all([n.e(7692),n.e(5314),n.e(5506),n.e(4821),n.e(4589),n.e(8592),n.e(2900)]).then(n.bind(n,32900))).default)(t)}})).apply(this,arguments)}var K=n(62192),ye=n(71251);function re(e){return e.some(t=>t.globalId)}function F(e){return e.filter(t=>!t.error).map(t=>{var r;return null!=(r=t.objectId)?r:t.globalId})}function C(e,t){const r=new Set(e);for(const i of t.values())r.add(i);return r}function P(e,t){const r=new Set(e);for(const i of t.values())r.delete(i);return r}let j=class extends ie.Z{constructor(e){super(e),this._hasGlobalIds=!1}normalizeCtorArgs(e){return this._queueProcessor=new ye.e({concurrency:1,process:e.process}),{}}destroy(){this.clear()}get updating(){return this._queueProcessor.length>0}clear(){this._queueProcessor.clear()}push(e){const t=this._queueProcessor,r=t.last();switch(e.type){case"update":case"refresh":if((null==r?void 0:r.type)===e.type)return;t.push(e).finally(()=>this.notifyChange("updating"));break;case"edit":{const i="processed-edit"===(null==r?void 0:r.type)?r:null;i&&t.popLast();const s=this._mergeEdits(i,e);for(const a of s)t.push(a).finally(()=>this.notifyChange("updating"));break}}this.notifyChange("updating")}_mergeEdits(e,t){var r,i;const{addedFeatures:s,deletedFeatures:a,updatedFeatures:d}=t.edits;if(this._hasGlobalIds=this._hasGlobalIds||re(s)||re(d)||re(a),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[...s,...d],removed:a}}];const y=new Set(F(null!=(r=null==e?void 0:e.edits.addOrModified)?r:[])),h=new Set(F(null!=(i=null==e?void 0:e.edits.removed)?i:[])),v=new Set([...F(s),...F(d)]),f=new Set(F(a));return[{type:"processed-edit",edits:{addOrModified:Array.from(C(P(y,f),v)).map(E=>({objectId:E})),removed:Array.from(C(P(h,v),f)).map(E=>({objectId:E}))}}]}};(0,u._)([(0,c.Cb)({readOnly:!0})],j.prototype,"updating",null),j=(0,u._)([(0,I.j)("esri.views.2d.layers.support.FeatureCommandQueue")],j);const $=j;var fe=n(60330),A=n(59289);let k=class extends fe.D{constructor(e){super(e),this._startupResolver=(0,_.hh)(),this.isReady=!1}initialize(){this._controller=new AbortController,this.addResolvingPromise(this._startWorker(this._controller.signal))}destroy(){this._controller.abort(),this._connection&&this._connection.close()}set tileRenderer(e){this.client.tileRenderer=e}get closed(){return this._connection.closed}startup(e,t,r,i){var s=this;return(0,o.Z)(function*(){yield s.when();const a=s._controller.signal,d=function oe(e){return Array.isArray(e)}(r.source)?{transferList:r.source,signal:a}:void 0,y={service:r,config:t,tileInfo:e.tileInfo.toJSON(),tiles:i};yield s._connection.invoke("startup",y,d),s._startupResolver.resolve(),s._set("isReady",!0)})()}updateTiles(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,(0,_.R8)(t._connection.invoke("updateTiles",e))})()}update(e){var t=this;return(0,o.Z)(function*(){const r={config:e};return yield t._startupResolver.promise,t._connection.invoke("update",r)})()}applyUpdate(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,t._connection.invoke("applyUpdate",e)})()}setHighlight(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,(0,_.R8)(t._connection.invoke("controller.setHighlight",e))})()}stop(){var e=this;return(0,o.Z)(function*(){if(yield e._startupResolver.promise,!e.closed)return(0,_.R8)(e._connection.invoke("stop"))})()}refresh(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,(0,_.R8)(t._connection.invoke("controller.refresh",e))})()}querySummaryStatistics(e,t,r){var i=this;return(0,o.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.querySummaryStatistics",{query:e.toJSON(),params:t},r)})()}queryUniqueValues(e,t,r){var i=this;return(0,o.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryUniqueValues",{query:e.toJSON(),params:t},r)})()}queryClassBreaks(e,t,r){var i=this;return(0,o.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryClassBreaks",{query:e.toJSON(),params:t},r)})()}queryHistogram(e,t,r){var i=this;return(0,o.Z)(function*(){return yield i._startupResolver.promise,i._connection.invoke("controller.queryHistogram",{query:e.toJSON(),params:t},r)})()}queryFeatures(e,t){var r=this;return(0,o.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.queryFeatures",e.toJSON(),t)})()}queryVisibleFeatures(e,t){var r=this;return(0,o.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.queryVisibleFeatures",e.toJSON(),t)})()}queryObjectIds(e,t){var r=this;return(0,o.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.queryObjectIds",e.toJSON(),t)})()}queryFeatureCount(e,t){var r=this;return(0,o.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.queryFeatureCount",e.toJSON(),t)})()}queryExtent(e,t){var r=this;return(0,o.Z)(function*(){return r._connection.invoke("controller.queryExtent",e.toJSON(),t)})()}queryLatestObservations(e,t){var r=this;return(0,o.Z)(function*(){return yield r._startupResolver.promise,r._connection.invoke("controller.queryLatestObservations",e.toJSON(),t)})()}queryStatistics(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,t._connection.invoke("controller.queryStatistics",e)})()}getObjectId(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,t._connection.invoke("controller.getObjectId",e)})()}getDisplayId(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,t._connection.invoke("controller.getDisplayId",e)})()}getFeatures(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,t._connection.invoke("controller.getFeatures",e)})()}getAggregates(){var e=this;return(0,o.Z)(function*(){return yield e._startupResolver.promise,e._connection.invoke("controller.getAggregates")})()}getAggregateValueRanges(){var e=this;return(0,o.Z)(function*(){return yield e._startupResolver.promise,e._connection.invoke("controller.getAggregateValueRanges")})()}mapValidDisplayIds(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,t._connection.invoke("controller.mapValidDisplayIds",e)})()}onEdits(e){var t=this;return(0,o.Z)(function*(){return yield t._startupResolver.promise,(0,_.R8)(t._connection.invoke("controller.onEdits",e))})()}enableEvent(e,t){var r=this;return(0,o.Z)(function*(){return yield r._startupResolver.promise,(0,_.R8)(r._connection.invoke("controller.enableEvent",{name:e,value:t}))})()}pauseStream(){return(0,_.R8)(this._connection.invoke("controller.pauseStream"))}resumeStream(){return(0,_.R8)(this._connection.invoke("controller.resumeStream"))}_startWorker(e){var t=this;return(0,o.Z)(function*(){try{t._connection=yield(0,A.bA)("Pipeline",{client:t.client,strategy:"dedicated",signal:e})}catch(r){(0,_.H9)(r)}})()}};(0,u._)([(0,c.Cb)()],k.prototype,"isReady",void 0),(0,u._)([(0,c.Cb)()],k.prototype,"client",void 0),(0,u._)([(0,c.Cb)()],k.prototype,"tileRenderer",null),k=(0,u._)([(0,I.j)("esri.views.2d.layers.support.FeatureLayerProxy")],k);const Oe=k;var xe=n(43930),Ie=n(84378),ge=n(58098);class Fe{constructor(t){this._tiles=new Map,this.buffer=0,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.buffer=t.buffer}destroy(){}clear(){this._tiles.forEach(t=>this._releaseTile(t))}tileKeys(){const t=[];return this._tiles.forEach((r,i)=>t.push(i)),t}update(t){const r=this.tileInfoView.getTileCoverage(t.state,this.buffer,"closest"),{spans:i,lodInfo:s}=r,{level:a}=s,d=[],y=[],h=new Set,v=new Set;for(const{row:f,colFrom:E,colTo:T}of i)for(let S=E;S<=T;S++){const B=ge.Z.getId(a,f,s.normalizeCol(S),s.getWorldForColumn(S)),J=this._getOrAcquireTile(d,B);h.add(B),J.isReady?J.visible=!0:v.add(J.key)}return v.forEach(f=>this._addPlaceholders(h,f)),this._tiles.forEach(f=>{h.has(f.key.id)||(y.push(f.key.id),this._releaseTile(f))}),Ie.Z.pool.release(r),{hasMissingTiles:v.size>0,added:d,removed:y}}_getOrAcquireTile(t,r){if(!this._tiles.has(r)){const i=this.acquireTile(new ge.Z(r));t.push(r),this._tiles.set(r,i),i.visible=!1}return this._tiles.get(r)}_getTile(t){return this._tiles.get(t)}_releaseTile(t){this._tiles.delete(t.key.id),this.releaseTile(t)}_addPlaceholders(t,r){const i=this._addPlaceholderChildren(t,r);Math.abs(1-i)<1e-6||this._addPlaceholderParent(t,r)||(this._getTile(r.id).visible=!0)}_addPlaceholderChildren(t,r){let i=0;return this._tiles.forEach(s=>{i+=this._addPlaceholderChild(t,s,r)}),i}_addPlaceholderChild(t,r,i){return r.key.level<=i.level||!r.hasData||!i.contains(r.key)?0:(r.visible=!0,t.add(r.key.id),1/(1<<2*(r.key.level-i.level)))}_addPlaceholderParent(t,r){let i=r.getParentKey(),s=0,a=null;for(;(0,l.pC)(i);){if(t.has(i.id))return!0;const d=this._getTile(i.id);if(null!=d&&d.isReady)return d.visible=!0,t.add(d.key.id),!0;null!=d&&d.hasData&&d.patchCount>s&&(s=d.patchCount,a=d),i=i.getParentKey()}return!!a&&(a.visible=!0,t.add(a.key.id),!0)}}var me=n(55538),ve=n(27e3),Pe=n(13812),Ue=n(2319),U=n(36630),Te=n(46679),le=n(10023),_e=n(79530);const ae=z.Z.getLogger("esri.views.layers.FeatureLayerView"),we=e=>{let t=class extends e{constructor(...r){super(...r),this._updatingRequiredFieldsPromise=null,this.filter=null,this.timeExtent=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){(0,ve.S1)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","featureEffect","layer.timeInfo","layer.floorInfo","timeExtent"],()=>this._handleRequiredFieldsChange(),!0),(0,ve.on)(this,"view.floors","change",()=>this._handleRequiredFieldsChange()),(0,ve.on)(this,"layer.sublayer","change",()=>this._handleRequiredFieldsChange())}get availableFields(){const{layer:r,layer:{fieldsIndex:i},requiredFields:s}=this;return(0,U.Q0)(i,"outFields"in r&&r.outFields?[...(0,U.Lk)(i,r.outFields),...s]:s)}set effect(r){(0,me.Mr)(ae,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect=r}get effect(){return(0,me.Mr)(ae,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(r){void 0!==r?this._override("featureEffect",r):this._clearOverride("featureEffect")}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(r){ae.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(r){throw new Error("missing implementation")}createQuery(){const r={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},i=(0,l.pC)(this.filter)?this.filter.createQuery(r):new X.Z(r);if("feature"===this.layer.type){const s=(0,_e.cx)(this);(0,l.pC)(s)&&(i.where=i.where?`(${i.where}) AND (${s})`:s)}return(0,l.pC)(this.timeExtent)&&(i.timeExtent=(0,l.pC)(i.timeExtent)?i.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),i}queryFeatures(r,i){throw new Error("missing implementation")}queryObjectIds(r,i){throw new Error("missing implementation")}queryFeatureCount(r,i){throw new Error("missing implementation")}queryExtent(r,i){throw new Error("missing implementation")}fetchPopupFeatures(r,i){var s=this;return(0,o.Z)(function*(){const a=s.validateFetchPopupFeatures(i);if(a)throw a;return s.fetchClientPopupFeatures(i)})()}_loadArcadeModules(r){if(r.get("expressionInfos.length")||Array.isArray(r.content)&&r.content.some(i=>"expression"===i.type))return(0,Te.LC)()}_handleRequiredFieldsChange(){const r=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",r),r.then(()=>{this._updatingRequiredFieldsPromise===r&&this._set("_updatingRequiredFieldsPromise",null)})}_updateRequiredFields(){var r=this;return(0,o.Z)(function*(){if(!r.layer||!r.view)return;const i="3d"===r.view.type,{layer:s,layer:{fieldsIndex:a,objectIdField:d}}=r,y="renderer"in s&&s.renderer,h="orderBy"in s&&s.orderBy,v=s.featureReduction,f=new Set,E=yield(0,_.as)([y?y.collectRequiredFields(f,a):null,(0,U.Mu)(f,s),i?(0,U.vl)(f,s):null,(0,l.pC)(r.filter)?(0,U.Ll)(f,s,r.filter):null,(0,l.pC)(r.featureEffect)?(0,U.Ll)(f,s,r.featureEffect.filter):null,v?(0,U.ZV)(f,s,v):null,h?(0,U.Qj)(f,s,h):null]);if(s.timeInfo&&r.timeExtent&&(0,U.gd)(f,s.fieldsIndex,[s.timeInfo.startField,s.timeInfo.endField]),"feature"===s.type&&s.floorInfo&&(0,U.gd)(f,s.fieldsIndex,[s.floorInfo.floorField]),"subtype-group"===s.type){(0,U.AB)(f,a,s.subtypeField);const S=s.sublayers.map(B=>{var J;return Promise.all([null==(J=B.renderer)?void 0:J.collectRequiredFields(f,a),(0,U.Mu)(f,B)])});yield(0,_.as)(S)}for(const S of E)S.error&&ae.error(S.error);(0,U.AB)(f,a,d),i&&"displayField"in s&&s.displayField&&(0,U.AB)(f,a,s.displayField);const T=Array.from(f).sort();r._set("requiredFields",T)})()}validateFetchPopupFeatures(r){if((0,l.Wi)(r))return null;for(const i of r.clientGraphics){const s=i.layer;if("popupEnabled"in s&&!s.popupEnabled)return new w.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:s});if("popupTemplate"in s&&!(0,le.V)(s,r))return new w.Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:s});if(i.isAggregate&&!(s.featureReduction&&"popupTemplate"in s.featureReduction&&s.featureReduction.popupEnabled&&s.featureReduction.popupTemplate))return new w.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:s})}}fetchClientPopupFeatures(r){var i=this;return(0,o.Z)(function*(){const s=(0,l.pC)(r)?r.clientGraphics:null;if(!s||0===s.length)return[];const a=new Array(s.length),d=new Map,y=yield i.createPopupQuery(r);for(let h=0;h<s.length;h++){const v=s[h];if(v.isAggregate){a[h]=v;continue}const{layer:f}=v;if(!("popupEnabled"in f))continue;const E=(0,U.Lk)(i.layer.fieldsIndex,y.outFields),T=(0,le.V)(f,r);if(!(0,l.pC)(T))continue;const S=yield i._loadArcadeModules(T);S&&S.arcadeUtils.hasGeometryOperations(T)||!(0,U.R9)(E,v)?d.set(v.getObjectId(),h):a[h]=v}if("stream"===i.layer.type||0===d.size)return a.filter(Boolean);y.objectIds=Array.from(d.keys());try{const h=yield i.layer.queryFeatures(y);for(const v of h.features)a[d.get(v.getObjectId())]=v}catch(h){}return a.filter(Boolean)})()}createPopupQuery(r){var i=this;return(0,o.Z)(function*(){const s=i.layer.createQuery(),a=new Set;let d=!1;const y=(0,l.pC)(r)&&r.clientGraphics?r.clientGraphics.map(h=>h.layer):[i.layer];for(const h of y){if(!("popupEnabled"in h))continue;const v=(0,le.V)(h,r);if(!(0,l.pC)(v))continue;const f=yield i._loadArcadeModules(v),E=f&&f.arcadeUtils.hasGeometryOperations(v);d=!("point"!==i.layer.geometryType&&!E);const T=yield(0,le.e)(i.layer,v);for(const S of T)a.add(S)}if(s.returnGeometry=d,s.returnZ=d,s.returnM=d,s.outFields=Array.from(a),s.outSpatialReference=i.view.spatialReference,"feature"===i.layer.type){const h=(0,_e.cx)(i);(0,l.pC)(h)&&(s.where=s.where?`(${s.where}) AND (${h})`:h)}return s})()}canResume(){return!(!super.canResume()||(0,l.pC)(this.timeExtent)&&this.timeExtent.isEmpty)}};return(0,u._)([(0,c.Cb)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),(0,u._)([(0,c.Cb)({readOnly:!0})],t.prototype,"availableFields",null),(0,u._)([(0,c.Cb)()],t.prototype,"effect",null),(0,u._)([(0,c.Cb)({type:Ue.Z})],t.prototype,"featureEffect",null),(0,u._)([(0,c.Cb)({type:se.Z})],t.prototype,"filter",void 0),(0,u._)([(0,c.Cb)(Pe.qG)],t.prototype,"timeExtent",void 0),(0,u._)([(0,c.Cb)()],t.prototype,"layer",void 0),(0,u._)([(0,c.Cb)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),(0,u._)([(0,c.Cb)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),(0,u._)([(0,c.Cb)({readOnly:!0})],t.prototype,"requiredFields",void 0),(0,u._)([(0,c.Cb)()],t.prototype,"suspended",void 0),(0,u._)([(0,c.Cb)()],t.prototype,"view",void 0),t=(0,u._)([(0,I.j)("esri.views.layers.FeatureLayerView")],t),t};var Ve=n(45611),Ze=n(94421),Ee=n(31637),Ae=n(2004);function Re(e){return e&&"openPorts"in e}const ee=z.Z.getLogger("esri.views.2d.layers.FeatureLayerView2D");let M=class extends(we((0,Ze.y)((0,Q.y)(Ve.Z)))){constructor(){var e;super(...arguments),e=this,this._pipelineIsUpdating=!0,this._commandsQueue=new $({process:t=>{switch(t.type){case"processed-edit":return this._doEdit(t);case"refresh":return this._doRefresh(t.dataChanged);case"update":return this._doUpdate()}}}),this._visibilityOverrides=new Set,this._highlightIds=new Map,this._updateHighlight=(0,_.Ds)((0,o.Z)(function*(){return e._proxy.setHighlight(Array.from(e._highlightIds.keys()))})),this._uploadsLocked=!1,this._needsClusterSizeUpdate=!1,this.featureEffectView=new he,this._lastDefinitionExpression=null}destroy(){var e;(0,l.yw)(this._updateClusterSizeTask,t=>t.remove()),null==(e=this._proxy)||e.destroy(),this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",e=>{this._set("_aggregateValueRanges",e.valueRanges)}),(0,b.YP)(()=>this.featureEffect,e=>{this.featureEffectView.featureEffect=e},{initial:!0,sync:!0})])}_initProxy(){var e=this;return(0,o.Z)(function*(){if("isTable"in e.layer&&e.layer.isTable)throw new w.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:e.layer});e._proxy&&e._proxy.destroy();const t=e._createClientOptions();return e._set("_proxy",new Oe({client:t})),e._proxy.when()})()}_initServiceOptions(){var e=this;return(0,o.Z)(function*(){e._set("_serviceOptions",yield e._createServiceOptions())})()}get orderByFields(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}get labelsVisible(){return!this.suspended&&("subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer]).some(t=>t.labelingInfo&&t.labelsVisible)}get queryMode(){return this._serviceOptions.type}get renderingConfigHash(){if(!this.layer)return null;const e=this.availableFields,t=this.layer,r=this.view.floors,{definitionExpression:i}=t,s="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,a="renderer"in t&&t.renderer,d="feature"===t.type?t.gdbVersion:void 0,y="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,{timeExtent:h}=this,v="customParameters"in t?JSON.stringify(t.customParameters):void 0,f="apiKey"in t?t.apiKey:void 0,E="stream"===t.type?`${JSON.stringify(t.geometryDefinition)}${t.definitionExpression}`:null,T=JSON.stringify(this.clips),S=t.featureReduction&&t.featureReduction.toJSON(),B="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),J="sublayers"in this.layer&&this.layer.sublayers.items.reduce((ue,W)=>ue+`${W.visible?1:0}.${JSON.stringify(W.renderer)}.${W.labelsVisible}\n.${JSON.stringify(W.labelingInfo)}`,"");return JSON.stringify({orderBy:B,sublayerHash:J,filterHash:(0,l.pC)(this.filter)&&this.filter.toJSON(),effectHash:(0,l.pC)(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:E,gdbVersion:d,definitionExpression:i,historicMoment:y,availableFields:e,renderer:a,labelingInfo:s,timeExtent:h,floors:r,clipsHash:T,featureReduction:S,customParameters:v,apiKey:f})}highlight(e){var t;let r;return e instanceof D.Z?r=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?r=[e]:Array.isArray(e)&&e.length>0?r="number"==typeof e[0]||"string"==typeof e[0]?e:e.map(i=>null==i?void 0:i.getObjectId()):N.Z.isCollection(e)&&e.length>0&&(r=e.map(i=>null==i?void 0:i.getObjectId()).toArray()),r=null==(t=r)?void 0:t.filter(i=>null!=i),r&&r.length?(this._addHighlight(r),{remove:()=>this._removeHighlight(r)}):{remove:()=>{}}}hasHighlight(){return!!this._highlightIds.size}hitTest(e,t){var r=this;return(0,o.Z)(function*(){if(!r.tileRenderer)return null;const i=yield r.tileRenderer.hitTest(t);if(0===i.length)return null;const{features:s,aggregates:a}=yield r._proxy.getFeatures(i);return[...a.map(d=>r._createHittestResult(L.fromJSON(d))),...s.map(d=>r._createHittestResult(D.Z.fromJSON(d)))]})()}queryAggregates(){var e=this;return(0,o.Z)(function*(){return(yield e._proxy.getAggregates()).map(t=>L.fromJSON(t))})()}queryStatistics(){return this._proxy.queryStatistics()}querySummaryStatistics(e,t,r){var i=this;return(0,o.Z)(function*(){const s=Y(q({},t),{scale:i.view.scale});return i._proxy.querySummaryStatistics(i._cleanUpQuery(e),s,r)})()}queryUniqueValues(e,t,r){var i=this;return(0,o.Z)(function*(){const s=Y(q({},t),{scale:i.view.scale});return i._proxy.queryUniqueValues(i._cleanUpQuery(e),s,r)})()}queryClassBreaks(e,t,r){var i=this;return(0,o.Z)(function*(){const s=Y(q({},t),{scale:i.view.scale});return i._proxy.queryClassBreaks(i._cleanUpQuery(e),s,r)})()}queryHistogram(e,t,r){var i=this;return(0,o.Z)(function*(){const s=Y(q({},t),{scale:i.view.scale});return i._proxy.queryHistogram(i._cleanUpQuery(e),s,r)})()}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then(r=>{const i=ne.default.fromJSON(r);return i.features.forEach(s=>this._setLayersForFeature(s)),i})}queryVisibleFeatures(e,t){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e),t).then(r=>{const i=ne.default.fromJSON(r);return i.features.forEach(s=>this._setLayersForFeature(s)),i})}queryFeaturesJSON(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}queryObjectIds(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}queryFeatureCount(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}queryExtent(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then(r=>({count:r.count,extent:Ae.Z.fromJSON(r.extent)}))}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:t,added:r,removed:i}=this._tileStrategy.update(e);(r.length||i.length)&&this._proxy.updateTiles({added:r,removed:i}),t&&this.requestUpdate(),this.notifyChange("updating")}attach(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._tileStrategy=new Fe({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add((0,b.YP)(()=>this.renderingConfigHash,()=>this._update(),b.nn),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",e=>this._edit(e)),"attach")}detach(){var e;this._commandsQueue.clear(),null==(e=this._proxy)||e.stop(),this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){var e;const t="renderer"in this.layer&&null!=this.layer.renderer,r=this._commandsQueue.updating,i=null!=this._updatingRequiredFieldsPromise,s=!this._proxy||!this._proxy.isReady,a=this._pipelineIsUpdating,d=null==this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),y=t&&(r||i||s||a||d);return(0,p.Z)("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${y}\n  -> hasRenderer ${t}\n  -> hasPendingCommand ${r}\n  -> updatingRequiredFields ${i}\n  -> updatingProxy ${s}\n  -> updatingPipeline ${a}\n  -> updatingTileRenderer ${d}\n`),y}_createClientOptions(){return{setUpdating:e=>{this._set("_pipelineIsUpdating",e)},emitEvent:e=>{this.emit(e.name,e.event)}}}_detectQueryMode(e){var t=this;return(0,o.Z)(function*(){var r;const s="editingInfo"in t.layer&&(null==(r=t.layer.editingInfo)?void 0:r.lastEditDate);if("path"in e&&("feature"===t.layer.type||"subtype-group"===t.layer.type)&&"point"===t.layer.geometryType&&t.layer.capabilities.query.supportsPagination&&!t.layer.capabilities.operations.supportsEditing&&(s||!t.layer.refreshInterval)&&(0,p.Z)("featurelayer-snapshot-enabled"))try{const y=yield t.layer.queryFeatureCount();if(y<=(0,p.Z)("featurelayer-snapshot-point-min-threshold"))return{mode:"snapshot",featureCount:y};const h=(0,p.Z)("featurelayer-snapshot-point-max-threshold"),v=(0,p.Z)("featurelayer-snapshot-point-coverage"),f=t.view.extent,E=(0,l.Wg)(t.layer.fullExtent),T=null==E?void 0:E.clone().intersection(f),S=(0,l.pC)(T)?T.width*T.height:0,B=(null==E?void 0:E.width)*(null==E?void 0:E.height),J=0===B?0:S/B;if(y<=h&&J>=v)return{mode:"snapshot",featureCount:y}}catch(y){ee.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:y})}return{mode:"on-demand"}})()}_createServiceOptions(){var e=this;return(0,o.Z)(function*(){var t;const r=e.layer;if("stream"===r.type)return null;const{capabilities:i,objectIdField:s}=r,a=r.fields.map(W=>W.toJSON()),d=(0,l.pC)(r.fullExtent)&&r.fullExtent.toJSON(),y=(0,xe.oq)(r.geometryType),h=r.timeInfo&&r.timeInfo.toJSON()||null,v=r.spatialReference?r.spatialReference.toJSON():null,f="feature"===r.type?r.globalIdField:null;let E;"ogc-feature"===r.type?E=r.source.getFeatureDefinition():Re(r.source)?E=yield r.source.openPorts():r.parsedUrl&&(E=(0,x.d9)(r.parsedUrl),"dynamicDataSource"in r&&r.dynamicDataSource&&(E.query={layer:JSON.stringify({source:r.dynamicDataSource})}));const T="datesInUnknownTimezone"in e.layer&&e.layer.datesInUnknownTimezone,S=null!=(t="subtypeField"in e.layer&&e.layer.subtypeField)?t:null,{mode:B,featureCount:J}=yield e._detectQueryMode(E);let ue=e.layer.objectIdField;if("feature"===e.layer.type&&(0,l.pC)(e.layer.orderBy)&&e.layer.orderBy.length){const W=!e.layer.orderBy[0].valueExpression&&e.layer.orderBy[0].field;W&&(ue=W)}return{type:B,timeReferenceUnknownClient:T,subtypeField:S,featureCount:J,globalIdField:f,maxRecordCount:i.query.maxRecordCount,tileMaxRecordCount:i.query.tileMaxRecordCount,capabilities:i,fields:a,fullExtent:d,geometryType:y,objectIdField:s,source:E,timeInfo:h,spatialReference:v,orderByFields:ue}})()}_createMemoryServiceOptions(e){var t=this;return(0,o.Z)(function*(){const r=yield e.openPorts();return Y(q({},t._createServiceOptions()),{type:"memory",source:r})})()}_cleanUpQuery(e){const t=X.Z.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}_update(){var e=this;return(0,o.Z)(function*(){return e._commandsQueue.push({type:"update"})})()}_edit(e){var t=this;return(0,o.Z)(function*(){if(t._validateEdit(e))return t._commandsQueue.push({type:"edit",edits:e})})()}doRefresh(e){var t=this;return(0,o.Z)(function*(){return t._commandsQueue.push({type:"refresh",dataChanged:e})})()}_validateEdit(e){const t="globalIdField"in this.layer&&this.layer.globalIdField,r=e.deletedFeatures.some(s=>-1===s.objectId||!s.objectId),i=t&&this.availableFields.includes(t);return r&&!i?(ee.error(new w.Z("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected on the map`)),null):e}_doUpdate(){var e=this;return(0,o.Z)(function*(){try{if(e.destroyed||!e._hasRequiredSupport(e.layer)||!e._tileStrategy)return;const{featureEffectView:t,filter:r}=e;yield e._updateRequiredFields();const{renderer:i}=e._getEffectiveRenderer();e._set("_effectiveRenderer",i);const s=e._createSchemaConfig(),a=e._createConfiguration(s,r,t.filter),d=e._lastDefinitionExpression!==a.definitionExpression;e._lastDefinitionExpression=a.definitionExpression;const y=e._createTileRendererHash(i);if("snapshot"===e._serviceOptions.type&&(a.schema.source.featureCount=e._serviceOptions.featureCount),y!==e._tileRendererHash){yield e._initTileRenderer(i);const h=e._serviceOptions;e.tileRenderer.onConfigUpdate(i);const v=e.layer;"stream"!==v.type&&Re(v.source)&&(h.source=yield v.source.openPorts()),"stream"===v.type&&(yield e._initServiceOptions());const f={added:e._tileStrategy.tileKeys(),removed:[]};yield e._proxy.startup(e.view.featuresTilingScheme,a,h,f),e.hasHighlight()&&(yield e._proxy.setHighlight(Array.from(e._highlightIds.keys()))),yield e._onceTilesUpdated(),e.tileRenderer.onConfigUpdate(i)}else{"snapshot"===e._serviceOptions.type&&d&&(a.schema.source.featureCount=yield e.layer.queryFeatureCount());const h=yield e._proxy.update(a);(h.mesh||h.targets.aggregate)&&e._lockGPUUploads();try{yield e._proxy.applyUpdate(h)}catch(v){(0,_.D_)(v)||ee.error(v)}(h.mesh||h.targets.aggregate)&&e._unlockGPUUploads(),e.tileRenderer.onConfigUpdate(i),e._updateClusterSizeVariable(),e._forceAttributeTextureUpload()}e._tileRendererHash=y,e.tileRenderer.invalidateLabels(),e.requestUpdate()}catch(t){}})()}_doEdit(e){var t=this;return(0,o.Z)(function*(){try{yield t._proxy.onEdits(e)}catch(r){(0,_.D_)(r)}})()}_doRefresh(e){var t=this;return(0,o.Z)(function*(){t._lockGPUUploads();try{yield t._proxy.refresh(e)}catch(r){(0,_.D_)(r)}t._unlockGPUUploads()})()}_updateClusterSizeVariable(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}_createUpdateClusterSizeTask(e,t){var r=this;return this.watch("_aggregateValueRanges",function(){var i=(0,o.Z)(function*(s){r._updateClusterEffectiveRendererSizeVariable(e,t,s),r._needsClusterSizeUpdate=!0,r._uploadsLocked||r._updateClusterSizeVariable()});return function(s){return i.apply(this,arguments)}}())}_updateClusterEffectiveRendererSizeVariable(e,t,r){var i=this;return(0,o.Z)(function*(){if(e.dynamicClusterSize&&"visualVariables"in e&&e.visualVariables){const s=(0,K.os)(e.visualVariables);if((0,l.pC)(s)&&"cluster_count"===s.field){const a=e.visualVariables.indexOf(s);e.visualVariables[a]=(0,K.aV)(t,r);const d=e.clone();d.dynamicClusterSize=!0,i._set("_effectiveRenderer",d)}}})()}_getEffectiveRenderer(){const e="renderer"in this.layer&&this.layer.renderer,t=this.layer.featureReduction;if((0,l.pC)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&(0,K.yR)(e)){const r=t,i=[],s=(0,K.S1)(i,e,r,this._aggregateValueRanges);return(0,l.yw)(this._updateClusterSizeTask,a=>a.remove()),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(s,r),{renderer:s,aggregateFields:i,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(e){const t=this.tileRenderer.acquireTile(e);return t.once("attach",()=>{this.requestUpdate()}),t}_releaseTile(e){this.tileRenderer.releaseTile(e)}_initTileRenderer(e){var t=this;return(0,o.Z)(function*(){const r=yield function G(e,t){return te.apply(this,arguments)}(e,{layerView:t,tileInfoView:t.view.featuresTilingScheme,layer:t.layer});return t.tileRenderer&&(t._tileStrategy.clear(),t.tileRenderer.uninstall(t.container),t.tileRenderer.destroy(),t.tileRenderer=null),t.destroyed?null:(t._proxy.tileRenderer=r,t._set("tileRenderer",r),t.tileRenderer.install(t.container),t.tileRenderer.onConfigUpdate(e),t.requestUpdate(),t.tileRenderer)})()}_createTileRendererHash(e){return"heatmap"===e.type?"heatmap":"symbol"}get hasFilter(){return!!(this.filter||"floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length||this._visibilityOverrides.size||this.timeExtent)}_injectOverrides(e){const t=(0,l.pC)(e)?e.timeExtent:null,r=(0,l.pC)(this.timeExtent)&&(0,l.pC)(t)?this.timeExtent.intersection(t):this.timeExtent||t;let i=null;const s="floorInfo"in this.layer&&this.layer.floorInfo;if(s){const d=(0,l.pC)(e)&&e.where;i=this._addFloorFilterClause(d)}if(!this._visibilityOverrides.size&&!r&&!s)return(0,l.pC)(e)?e.toJSON():null;(e=(0,l.pC)(e)&&e.clone()||new se.Z).timeExtent=r,i&&(e.where=i);const a=e.toJSON();return a.hiddenIds=Array.from(this._visibilityOverrides),a}_addFloorFilterClause(e){const t=this.layer;let r=e||"";if("floorInfo"in t&&t.floorInfo){var i;let s=this.view.floors;if(!s||!s.length)return r;null!=(i=t.floorInfo.viewAllLevelIds)&&i.length&&(s=t.floorInfo.viewAllLevelIds);const a=s.filter(h=>""!==h).map(h=>"'"+h+"'");a.push("''");const d=t.floorInfo.floorField;let y="("+d+" IN ({ids}) OR "+d+" IS NULL)";if(y=y.replace("{ids}",a.join(", ")),(0,l.pC)(r)&&r.includes(d)){let h=new RegExp("AND \\("+d+".*NULL\\)","g");r=r.replace(h,""),h=new RegExp("\\("+d+".*NULL\\)","g"),r=r.replace(h,""),r=r.replace(/\s+/g," ").trim()}r=""!==r?"("+r+") AND "+y:y}return""!==r?r:null}_createConfiguration(e,t,r){const i="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,s="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(ce.m4),d=this._injectOverrides(t);a[0]=d,a[1]=(0,l.pC)(r)?r.toJSON():null;const y=(0,pe.Ew)(e);if((0,l.Wi)(y))return null;const h=(0,Ee.Y)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:s,historicMoment:i,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:y,supportsTextureFloat:h.supportsTextureFloat,maxTextureSize:h.maxTextureSize}}_hasRequiredSupport(e){var t;return!("renderer"in e&&"dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!(0,Ee.Y)().supportsTextureFloat&&(ee.error(new w.Z("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}_onceTilesUpdated(){return this.requestUpdate(),(0,b.N1)(()=>!this._pipelineIsUpdating)}_lockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}_unlockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_createSchemaConfig(){return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:"feature"===this.layer.type?this.layer.historicMoment:null,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:"feature"===this.layer.type?this.layer.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:Y(q({},"customParameters"in this.layer?this.layer.customParameters:void 0),{token:"apiKey"in this.layer?this.layer.apiKey:void 0})}}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const r=this._highlightIds.get(t);this._highlightIds.set(t,r+1)}else this._highlightIds.set(t,1);this._updateHighlight().catch(t=>{(0,_.D_)(t)||ee.error(t)})}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const r=this._highlightIds.get(t)-1;0===r?this._highlightIds.delete(t):this._highlightIds.set(t,r)}this._updateHighlight().catch(t=>{(0,_.D_)(t)||ee.error(t)})}_setLayersForFeature(e){const t=this.layer;e.layer=t,e.sourceLayer=t}_createHittestResult(e){return this._setLayersForFeature(e),(0,l.pC)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}};(0,u._)([(0,c.Cb)()],M.prototype,"_serviceOptions",void 0),(0,u._)([(0,c.Cb)()],M.prototype,"_proxy",void 0),(0,u._)([(0,c.Cb)()],M.prototype,"_pipelineIsUpdating",void 0),(0,u._)([(0,c.Cb)()],M.prototype,"_effectiveRenderer",void 0),(0,u._)([(0,c.Cb)()],M.prototype,"_aggregateValueRanges",void 0),(0,u._)([(0,c.Cb)()],M.prototype,"_commandsQueue",void 0),(0,u._)([(0,c.Cb)()],M.prototype,"featureEffectView",void 0),(0,u._)([(0,c.Cb)()],M.prototype,"labelsVisible",null),(0,u._)([(0,c.Cb)({readOnly:!0})],M.prototype,"queryMode",null),(0,u._)([(0,c.Cb)()],M.prototype,"renderingConfigHash",null),(0,u._)([(0,c.Cb)()],M.prototype,"tileRenderer",void 0),(0,u._)([(0,c.Cb)()],M.prototype,"updating",void 0),M=(0,u._)([(0,I.j)("esri.views.2d.layers.FeatureLayerView2D")],M);const Me=M},37384:(Z,R,n)=>{n.d(R,{y:()=>ye});var o=n(17626),u=n(48701),D=n(89726),c=n(26584),m=n(32917),p=n(77712),L=(n(85931),n(8314),n(90912),n(76898)),H=n(1011),N=n(86810);n(63290),n(82255);let z=class extends N.wq{};z=(0,o._)([(0,L.j)("esri.views.layers.support.ClipArea")],z);const l=z;var _;let b=_=class extends l{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new _({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};(0,o._)([(0,p.Cb)({type:[Number,String],json:{write:!0}})],b.prototype,"left",void 0),(0,o._)([(0,p.Cb)({type:[Number,String],json:{write:!0}})],b.prototype,"right",void 0),(0,o._)([(0,p.Cb)({type:[Number,String],json:{write:!0}})],b.prototype,"top",void 0),(0,o._)([(0,p.Cb)({type:[Number,String],json:{write:!0}})],b.prototype,"bottom",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],b.prototype,"version",null),b=_=(0,o._)([(0,L.j)("esri.views.layers.support.ClipRect")],b);const ie=b;n(29132);var X,V=n(21674),he=n(91179),se=n(2004),ne=n(37118);const ce={base:V.Z,key:"type",typeMap:{extent:se.Z,polygon:ne.Z}};let Q=X=class extends l{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new X({geometry:this.geometry.clone()})}};(0,o._)([(0,p.Cb)({types:ce,json:{read:he.im,write:!0}})],Q.prototype,"geometry",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],Q.prototype,"version",null),Q=X=(0,o._)([(0,L.j)("esri.views.layers.support.Geometry")],Q);const pe=Q;let G=class extends l{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};(0,o._)([(0,p.Cb)({type:[[[Number]]],json:{write:!0}})],G.prototype,"path",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],G.prototype,"version",null),G=(0,o._)([(0,L.j)("esri.views.layers.support.Path")],G);const K=u.Z.ofType({key:"type",base:l,typeMap:{rect:ie,path:G,geometry:pe}}),ye=re=>{let F=class extends re{constructor(){super(...arguments),this.attached=!1,this.clips=new K,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1}initialize(){var C,P,j,$;const fe=null==(C=null==(P=this.view)?void 0:P.spatialReferenceLocked)||C;(null==(j=this.view)?void 0:j.spatialReference)&&fe&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new c.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new H.W),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([(0,m.YP)(()=>this.suspended,A=>{this.container&&(this.container.visible=!A),this.view&&!A&&this.updateRequested&&this.view.requestUpdate()},m.tX),(0,m.YP)(()=>{var A,oe;return null!=(A=null==(oe=this.layer)?void 0:oe.opacity)?A:1},A=>{this.container&&(this.container.opacity=A)},m.tX),(0,m.YP)(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",A=>{this.container&&(this.container.blendMode=A)},m.tX),(0,m.YP)(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,A=>{this.container&&(this.container.effect=A)},m.tX),(0,m.on)(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),null!=($=this.view)&&$.whenLayerView?this.view.whenLayerView(this.layer).then(A=>{A===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var C;const P=null==(C=this.view)?void 0:C.spatialReference;return null==P||this.supportsSpatialReference(P)}get updating(){var C;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null==(C=this.updatingHandles)||!C.updating))}get visibleAtCurrentScale(){return this.isVisibleAtScale(this.view.scale)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)}isVisibleAtScale(C){const P=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!P)return!0;const{minScale:j,maxScale:$}=P;return(0===j||C<=j)&&(0===$||C>=$)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(C){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",C),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(C))):this.updateRequested=!1}hitTest(C,P){return Promise.resolve(null)}supportsSpatialReference(C){return!0}isUpdating(){return!1}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const C=super.getSuspendInfo(),P=!this.spatialReferenceSupported,j=this.visibleAtCurrentScale;return P&&(C.spatialReferenceNotSupported=P),j&&(C.outsideScaleRange=j),C}};return(0,o._)([(0,p.Cb)()],F.prototype,"attached",void 0),(0,o._)([(0,p.Cb)({type:K,set(C){const P=(0,D.Z)(C,this._get("clips"),K);this._set("clips",P)}})],F.prototype,"clips",void 0),(0,o._)([(0,p.Cb)()],F.prototype,"container",void 0),(0,o._)([(0,p.Cb)()],F.prototype,"moving",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],F.prototype,"spatialReferenceSupported",null),(0,o._)([(0,p.Cb)({readOnly:!0})],F.prototype,"updateParameters",void 0),(0,o._)([(0,p.Cb)()],F.prototype,"updateRequested",void 0),(0,o._)([(0,p.Cb)()],F.prototype,"updating",null),(0,o._)([(0,p.Cb)()],F.prototype,"view",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],F.prototype,"visibleAtCurrentScale",null),F=(0,o._)([(0,L.j)("esri.views.2d.layers.LayerView2D")],F),F}},45611:(Z,R,n)=>{n.d(R,{Z:()=>z});var o=n(17626),u=n(14517),D=n(61885),c=n(80542),m=n(61996),p=n(63290),g=n(62208),I=n(60330),O=n(77712),w=(n(85931),n(8314),n(90912),n(76898));let x=class extends((0,c.p)((0,m.I)((0,I.v)(D.Z.EventedMixin(u.Z))))){constructor(l){super(l),this.layer=null,this.parent=null}initialize(){this.when().catch(l=>{if("layerview:create-error"!==l.name){const _=this.layer&&this.layer.id||"no id",b=this.layer&&this.layer.title||"no title";throw p.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${b}', id: '${_}')`,l),l}})}get fullOpacity(){return(0,g.Pt)(this.get("layer.opacity"),1)*(0,g.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){var l;return!!(null!=(l=this.updatingHandles)&&l.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var l;return!0===(null==(l=this.layer)?void 0:l.visible)}set visible(l){void 0!==l?this._override("visible",l):this._clearOverride("visible")}canResume(){var l,_,b;return this.visible&&(null==(l=this.layer)?void 0:l.loaded)&&!(null!=(_=this.parent)&&_.suspended)&&(null==(b=this.view)?void 0:b.ready)||!1}getSuspendInfo(){const l=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(l.viewNotReady=!0),this.layer&&this.layer.loaded||(l.layerNotLoaded=!0),this.visible||(l.layerInvisible=!0),l}isUpdating(){return!1}};(0,o._)([(0,O.Cb)()],x.prototype,"fullOpacity",null),(0,o._)([(0,O.Cb)()],x.prototype,"layer",void 0),(0,o._)([(0,O.Cb)()],x.prototype,"parent",void 0),(0,o._)([(0,O.Cb)({readOnly:!0})],x.prototype,"suspended",null),(0,o._)([(0,O.Cb)({readOnly:!0})],x.prototype,"suspendInfo",null),(0,o._)([(0,O.Cb)({readOnly:!0})],x.prototype,"legendEnabled",null),(0,o._)([(0,O.Cb)({type:Boolean,readOnly:!0})],x.prototype,"updating",null),(0,o._)([(0,O.Cb)({readOnly:!0})],x.prototype,"updatingProgress",null),(0,o._)([(0,O.Cb)()],x.prototype,"visible",null),(0,o._)([(0,O.Cb)()],x.prototype,"view",void 0),x=(0,o._)([(0,w.j)("esri.views.layers.LayerView")],x);const z=x},94421:(Z,R,n)=>{n.d(R,{y:()=>L});var o=n(17626),u=n(63290),D=n(10699),c=n(32917),m=n(77712),O=(n(85931),n(8314),n(90912),n(76898));const L=H=>{let N=class extends H{initialize(){this.handles.add((0,c.on)(()=>this.layer,"refresh",w=>{this.doRefresh(w.dataChanged).catch(x=>{(0,D.D_)(x)||u.Z.getLogger(this.declaredClass).error(x)})}),"RefreshableLayerView")}};return(0,o._)([(0,m.Cb)()],N.prototype,"layer",void 0),N=(0,o._)([(0,O.j)("esri.layers.mixins.RefreshableLayerView")],N),N}},10023:(Z,R,n)=>{n.d(R,{V:()=>p,e:()=>c});var o=n(15861),u=n(62208),D=n(36630);function c(g){return m.apply(this,arguments)}function m(){return(m=(0,o.Z)(function*(g,I=g.popupTemplate){if(!(0,u.pC)(I))return[];const O=yield I.getRequiredFields(g.fieldsIndex),{lastEditInfoEnabled:L}=I,{objectIdField:H,typeIdField:N,globalIdField:w,relationships:x}=g;if(O.includes("*"))return["*"];const z=L?yield(0,D.CH)(g):[],l=(0,D.Q0)(g.fieldsIndex,[...O,...z]);return N&&l.push(N),l&&H&&g.fieldsIndex.has(H)&&-1===l.indexOf(H)&&l.push(H),l&&w&&g.fieldsIndex.has(w)&&-1===l.indexOf(w)&&l.push(w),x&&x.forEach(_=>{const{keyField:b}=_;l&&b&&g.fieldsIndex.has(b)&&-1===l.indexOf(b)&&l.push(b)}),l})).apply(this,arguments)}function p(g,I){return g.popupTemplate?g.popupTemplate:(0,u.pC)(I)&&I.defaultPopupTemplateEnabled&&(0,u.pC)(g.defaultPopupTemplate)?g.defaultPopupTemplate:null}},79530:(Z,R,n)=>{function o(m){var p;const g=m.layer;return"floorInfo"in g&&null!=(p=g.floorInfo)&&p.floorField&&"floors"in m.view?c(m.view.floors,g.floorInfo.floorField):null}function u(m,p){var g;return"floorInfo"in p&&null!=(g=p.floorInfo)&&g.floorField?c(m,p.floorInfo.floorField):null}function D(m,p){const{definitionExpression:g}=p;return m?g?`(${g}) AND (${m})`:m:g}function c(m,p){if(null==m||!m.length)return null;const g=m.filter(I=>""!==I).map(I=>`'${I}'`);return g.push("''"),`${p} IN (${g.join(",")}) OR ${p} IS NULL`}n.d(R,{Hp:()=>D,cx:()=>o,ff:()=>u})}}]);